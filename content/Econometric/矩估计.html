---
author:
  - 韭菜
title: '矩估计'
categories:
  - R
  - Stata
  - 广义矩估计
  - 矩估计
  - GMM
tags:
  - R
  - Stata
  - 广义矩估计
  - 矩估计
  - GMM
date: 2021-04-21
slug: MM
weight: 001
description: <font face="思源宋体 CN" >广义矩估计 (Generalized Method of Moment, 简称 GMM) 是一种构造估计量的方法，类似于极大似然法 (MLE) 。MLE 通过假设随机变量服从特定的分布，进而将待估参数嵌入似然函数，通过极大化联合概率密度函数得到参数的估计值。GMM 则是以随机变量遵循特定矩的假设，而不是对整个分布的假设，这些假设被称为矩条件。这使得 GMM 比 MLE 更稳健，但会导致估计量的有效性有所降低 (估计出的标准误比较大)</font>
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><font face="思源宋体 CN" ></p>
<p>　　<strong>几个重要的计量经济学方法的提出时间顺序：</strong></p>
<ul>
<li>IV，Philip Green Wright<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>，1928；Henri Theil，Olav Reiersøl，1945；</li>
</ul>
<ul>
<li>GLS，Alexander Aitken<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>，1935.</li>
</ul>
<ul>
<li><p>2SLS，Henri Theil<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>，1953.</p></li>
<li><p>3SLS，Henri Theil<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>，1962，<font color=blue >模型是被用的，而不是被信的。</font></p></li>
</ul>
<ul>
<li>MM，Karl Pearson1<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>，1894.</li>
</ul>
<ul>
<li>GMM，Lars Peter Hansen<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>，1982.</li>
</ul>
<div id="为何要使用-gmm" class="section level1">
<h1>为何要使用 GMM ？</h1>
<div id="过度识别且存在异方差" class="section level2">
<h2>过度识别且存在异方差</h2>
<p>　　传统的工具变量法2SLS，因为它操作方便，且同时适用于恰好识别与过度识别的情形。然而，<font color=blue >2SLS仅在扰动项同方差的情况下，才是最有效率的</font>。理由很简单，如果每位个体的扰动项方差不相同（比如，大企业的方差一般不同于小企业的方差），则方差小的个体观测值所包含的信息量更大，而2SLS却对所有数据等量齐观地进行处理，故在异方差的情况下不是最有效率的<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>。</p>
<p>　　在过度识别且存在异方差的情况下，更有效率的做法是“广义矩估计”（Generalized Method of Moments，简记 GMM）。该方法由芝加哥大学的 Lars Peter Hansen 教授所提出 (Hansen, 1982)，已成为最流行的计量方法之一，Hansen也因此获得 2013年的诺贝尔经济学奖。顾名思义，广义矩估计为矩估计的推广，故先介绍矩估计。</p>
<p>　　假设待估参数的个数为<span class="math inline">\(K\)</span>，矩条件的个数为<span class="math inline">\(L\)</span> 。当<span class="math inline">\(L=K\)</span>时，称为“恰好识别”，当<span class="math inline">\(L&gt;K\)</span>时，称为 “过度识别”。</p>
<p>　　GMM是矩估计（MM）的推广。在恰好识别情况下，目标函数的最小值等于 0 ，GMM 估计量与 MM 估计量等价；然而在过度识别情况下，MM 不再适用，GMM 可以有效地组合矩条件，使 GMM 比 MM 更有效。GMM 建立在期望值和样本平均值的基础上。矩条件是用真实矩指定模型参数的期望值。</p>
</div>
<div id="动态面板数据" class="section level2">
<h2>动态面板数据</h2>
<p>　　GMM的经典用法在动态面板数据(Dynamic Panel data, DPD)分析中，所指的是分析中采用如下的回归方程：
<span class="math display">\[
Y_{i, t}=\alpha Y_{i, t-1}+\beta X_{i t}+u_{i}+\varepsilon_{i t} \tag{1}
\]</span></p>
<p>　　 其中，<span class="math inline">\(Y_{i,t-1}\)</span>是因变量的滞后项，<span class="math inline">\(u_{i}\)</span>是个体<span class="math inline">\(i\)</span>的固定效应。<font color=blue> 因变量的滞后项和固定效应同时存在，是动态面板数据分析特殊性的关键。</font>如果固定效应不存在，那么回归方程变为:
<span class="math display">\[
Y_{i, t}=\alpha Y_{i, t-1}+\beta X_{i t}+\varepsilon_{i t}  \tag{2}
\]</span>
　　 这时，用OLS或者随机效应模型回归分析即可。如果因变量的滞后项 <span class="math inline">\(\alpha Y_{i,t-1}\)</span>不存在，那么回归方程变为：<br />
<span class="math display">\[
Y_{i, t}=\beta X_{i t}+u_{i}+\varepsilon_{i t} \tag{3}
\]</span></p>
<p>　　 对于该模型，用固定效应模型分析即可。如果因变量的滞后项和固定效应都存在，那么对于（1）式这样的回归方程，如果采用<font color=blue ><strong>OLS或者FE均存在内生性问题（即系数的估计值是有偏的）</strong></font>。如果使用OLS估计，由于以下公式（4）和公式（1）均存在固定项<span class="math inline">\(u_{i}\)</span>,即存在内生性：
　　
<span class="math display">\[
Y_{i, t-1}=\beta X_{i t-1}+u_{i}+\varepsilon_{i t-1} \tag{4}
\]</span></p>
<p>　　 如果采用差分方法去掉固定效应，会得到如下的结果:
<span class="math display">\[
\Delta Y_{i,t}=\alpha \Delta Y_{i,t-1}+\beta\Delta X_{i,t}+\Delta \epsilon_{i,t}  \tag{5}
\]</span>
　　 其中，<span class="math inline">\(\Delta Y_{i, t}=Y_{i, t}-Y_{i, t-1}\)</span>, <span class="math inline">\(\quad \Delta Y_{i, t-1}=Y_{i, t-1}-Y_{i, t-2}\)</span>, <span class="math inline">\(\quad \Delta X_{i, t}=X_{i, t}-X_{i, t-1}\)</span>, <span class="math inline">\(\quad \Delta \varepsilon_{i, t}=\varepsilon_{i, t}-\varepsilon_{i, t-1}\)</span>。如果（1）式代表了真实的变量之间关系，那么<span class="math inline">\(\Delta Y_{i, t-1}\)</span>和<span class="math inline">\(\Delta \varepsilon_{i, t}\)</span>之间必有相关性，因为：
<span class="math display">\[
\Delta Y_{i, t-1}=Y_{i, t-1}-Y_{i, t-2}=(\alpha-1) Y_{i, t-2}+\beta X_{i, t-1}+\varepsilon_{i, t-1}\tag{6}
\]</span>
　　 <span class="math inline">\(cov(\Delta Y_{i,t-1},\Delta \epsilon_{i,t})\)</span>显然不会等于0，因为两者都有<span class="math inline">\(\varepsilon_{i, t-1}\)</span>这一项。通常所用的固定效应模型实际上就是对（1）式差分，得到类似于（5）式的差分回归方程，然后做OLS。对于现在的情况，由于<span class="math inline">\(\Delta Y_{i, t-1}\)</span>和<span class="math inline">\(\Delta \varepsilon_{i, t}\)</span>之间的相关性，再用OLS只会得到有偏误的回归系数。所以传统的统计方法无法实现对此类方程的估计，需要用GMM方法。</p>
<blockquote>
<p>　　<font face="思源宋体 CN" >需要注意的是（2）的模型（包含滞后项的OLS）和（3）的模型（不包含滞后项的FE，固定效应）尽管都有偏误,但好处是一个偏大,一个偏小(具体哪个大,哪个小要看变量之间的关系),所以这两个估计系数应该界定了真实参数的范围（Angrist and Pischke，2009:246页；Roodman，2009）。也就是说，你最后用GMM方法估计出来的参数应该落到这个区间。</font></p>
</blockquote>
<p>　　</p>
</div>
</div>
<div id="基本思想" class="section level1">
<h1>基本思想</h1>
<p>　　广义矩估计 (Generalized Method of Moment, 简称 GMM) 是一种构造估计量的方法，类似于极大似然法 (MLE) 。MLE 通过假设随机变量服从特定的分布，进而将待估参数嵌入似然函数，通过极大化联合概率密度函数得到参数的估计值。<font color=blue>GMM 则是以随机变量遵循特定矩的假设，而不是对整个分布的假设，这些假设被称为矩条件</font>。这使得 GMM 比 MLE 更稳健，但会导致估计量的有效性有所降低 (估计出的标准误比较大)<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>。</p>
</div>
<div id="矩-moment" class="section level1">
<h1>矩 (Moment)</h1>
<p>　　何为矩？简单说，矩就是<font color = blue>随机变量之函数的期望</font>。比如，对于随机变量 ，其一阶原点矩为其期望<span class="math inline">\(E(x)\)</span> ，二阶中心矩为其方差<span class="math inline">\(\operatorname{Var} \equiv \mathrm{E}[x-\mathrm{E}(x)]^{2}\)</span>，以此类推。</p>
<p>　　更一般地，考虑随机变量<span class="math inline">\(x\)</span>的函数<span class="math inline">\(f(x)\)</span>。显然，<span class="math inline">\(f(x)\)</span>仍为随机变量，其期望<span class="math inline">\(E[f(x)]\)</span>
也称为“矩”（moment）。</p>
<p>　　进一步推广，随机向量<span class="math inline">\(x\)</span>的函数<span class="math inline">\(f(x)\)</span>之期望<span class="math inline">\(E[f(x)]\)</span>，也称为 “矩”。总之，矩可以视为随<font color = blue>机变（向）量的某种特征</font></p>
</div>
<div id="矩估计量mm估计量" class="section level1">
<h1>矩估计量（MM估计量）</h1>
<div id="期望与方差的矩估计" class="section level2">
<h2>期望与方差的矩估计</h2>
<p><span class="math display">\[
E(\mathrm{y}-\mu)=0 \rightarrow \frac{1}{N} \sum_{i=1}^{N}\left(y_{i}-\hat{\mu}\right)=0 \rightarrow \hat{\mu}=\frac{1}{N} \sum_{i=1}^{N} y_{i}\tag{7}
\]</span></p>
<p>　　其中， <span class="math inline">\(N\)</span>表示样本数， <span class="math inline">\(y_{i}\)</span>表示 <span class="math inline">\(y\)</span> 的第 <span class="math inline">\(i\)</span> 个观察值 。此处，估计量<span class="math inline">\(\hat{\mu}\)</span> 被称为矩估计量( the method of moments estimator )，简称 MM 估计量。这是因为，该估计量的构造以母体矩条件( population moment condition )为基础，进而用其样本矩条件（依赖于我们使用的数据）做等价代换。因为我们从总体矩条件开始，然后运用类比原理得到一个依赖于观测数据的估计量。
我们想要估计随机变量 <span class="math inline">\({Y}\)</span>的均值，即 <span class="math inline">\(\mu=E[\mathrm{y}]\)</span>，其中“母体矩条件( PMC )”为：
<span class="math display">\[
 E[\mathrm{y}]-\mu=0  \tag{8}
\]</span></p>
<p>　　<span class="math inline">\(\left\{y_{1}, y_{2}, \dots, y_{n}\right\}\)</span>为从这个母体中随机抽取的一组样本观察值，则对应的“样本矩条件( SMC )”为
<span class="math display">\[
\frac{1}{N} \sum_{i=1}^{N} y_{i}-\hat{\mu}=0 \tag{9}
\]</span>
　　因此，我们可知母体矩条件的样本均值估计为： <span class="math inline">\(\mu=E[\mathrm{y}]\)</span> ，样本矩条件的样本均值估计为： <span class="math inline">\(\hat{\mu}=\frac{1}{N} \sum_{i=1}^{N} y_{i}\)</span> 。</p>
<blockquote>
<p>例子：</p>
</blockquote>
<p>　　自由度为 <span class="math inline">\(k\)</span>的 <span class="math inline">\(\chi^{2}\)</span> 随机变量的均值为 <span class="math inline">\(k\)</span>，方差为 <span class="math inline">\(2k\)</span>，因此两个母体矩条件( PMC )如下：
<span class="math display">\[
E[Y-k]=0 \qquad \tag{10a}
\]</span></p>
<p><span class="math display">\[
E\left[(Y-k)^{2}-2 k\right]=0 \qquad \tag{10b}
\]</span></p>
<p>　　这个母体中随机抽取的一组样本观察值 <span class="math inline">\(\left\{y_{1}, y_{2}, \ldots, y_{n}\right\}\)</span>，对应的样本矩条件( SMC )为：
<span class="math display">\[
\frac{1}{N} \sum_{i=1}^{N}\left(y_{i}-\hat{k}\right)=0 \quad \tag{11a}
\]</span></p>
<p><span class="math display">\[
\frac{1}{N} \sum_{i=1}^{N}\left[\left(y_{i}-\hat{k}\right)^{2}-2 \hat{k}\right]=0 \tag{11b}
\]</span></p>
<blockquote>
<p>　　矩估计法是用样本的 <span class="math inline">\(k\)</span>阶矩作为总体的 <span class="math inline">\(k\)</span>阶矩的估计量，建立含待估计参数的方程，从而可解出待估计参数。一般地，不论总体服从什么分布，总体期望 <span class="math inline">\(\mu\)</span> 与方差 <span class="math inline">\(\sigma^{2}\)</span> 存在，则根据据估计法，它们的矩估计量分别为：</p>
</blockquote>
<p><span class="math display">\[
\hat{\mu}=\frac{1}{n} \sum_{i=1}^{n} X_{i}=\overline{X} \tag{12a}
\]</span></p>
<p><span class="math display">\[
\hat{\sigma}^{2}=\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2} \tag{12b}
\]</span></p>
</div>
<div id="简单线性回归的矩估计" class="section level2">
<h2>简单线性回归的矩估计</h2>
<div id="简单线性回归的矩条件" class="section level3">
<h3>简单线性回归的矩条件</h3>
<p>　　OLS 估计可以视为矩估计的一个特例。OLS 估计的公式为：
<span class="math display">\[
y_{i}=\beta x_{i}+\mu_{i} \tag{13}
\]</span>
　　其中，<span class="math inline">\(x_{i}\)</span>与 <span class="math inline">\(\mu_{i}\)</span>不相关，则有 <span class="math inline">\(E\left[\mu_{i} | x_{i}\right]=0\)</span>。因此，
<span class="math display">\[
E\left[\mu_{i} | x_{i}\right]=0 \rightarrow E\left[y_{i}-\beta x_{i} | x_{i}\right]=0 \rightarrow E\left[x_{i}\left(y_{i}-\beta x_{i}\right)\right]=0 \tag{14}
\]</span>
　　其中，<span class="math inline">\(E\left[x_{i}\left(y_{i}-\beta x_{i}\right)\right]=0\)</span> 是母体矩条件，对应的样本矩条件为：
<span class="math display">\[
\frac{1}{N} \sum_{i=1}^{N}\left[x_{i}\left(y_{i}-\hat{\beta}^{M M} x_{i}\right)\right]=0 \tag{15}
\]</span>
　　求解即可得到 OLS 估计下的 <span class="math inline">\(\hat{\beta}^{M M}\)</span> 。</p>
</div>
<div id="stata实现" class="section level3">
<h3>Stata实现</h3>
<ul>
<li>OLS估计</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
regress mpg gear_ratio turn,vce(robust)
</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . regress mpg gear_ratio turn,vce(robust)
## 
## Linear regression                               Number of obs     =         74
##                                                 F(2, 71)          =      47.92
##                                                 Prob &gt; F          =     0.0000
##                                                 R-squared         =     0.5483
##                                                 Root MSE          =     3.9429
## 
## ------------------------------------------------------------------------------
##              |               Robust
##          mpg |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##   gear_ratio |   3.032884   1.533061     1.98   0.052     -.023954    6.089721
##         turn |  -.7330502   .1204386    -6.09   0.000    -.9731979   -.4929025
##        _cons |   41.21801     8.5723     4.81   0.000     24.12533    58.31069
## ------------------------------------------------------------------------------
## 
## .</code></pre>
<ul>
<li>GMM估计</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
gmm (mpg - {b1}*gear_ratio - {b2}*turn - {b0}),instruments(gear_ratio turn)
</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . gmm (mpg - {b1}*gear_ratio - {b2}*turn - {b0}),instruments(gear_ratio turn)
## 
## Step 1
## Iteration 0:   GMM criterion Q(b) =  471.67875  
## Iteration 1:   GMM criterion Q(b) =  3.058e-21  
## Iteration 2:   GMM criterion Q(b) =  2.545e-31  
## 
## Step 2
## Iteration 0:   GMM criterion Q(b) =  1.691e-32  
## Iteration 1:   GMM criterion Q(b) =  1.691e-32  (backed up)
## 
## note: model is exactly identified
## 
## GMM estimation 
## 
## Number of parameters =   3
## Number of moments    =   3
## Initial weight matrix: Unadjusted                 Number of obs   =         74
## GMM weight matrix:     Robust
## 
## ------------------------------------------------------------------------------
##              |               Robust
##              |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          /b1 |   3.032884   1.501664     2.02   0.043     .0896757    5.976092
##          /b2 |  -.7330502    .117972    -6.21   0.000    -.9642711   -.5018293
##          /b0 |   41.21801   8.396739     4.91   0.000     24.76071    57.67532
## ------------------------------------------------------------------------------
## Instruments for equation 1: gear_ratio turn _cons
## 
## .</code></pre>
<ul>
<li>利用线性组合的简单线性GMM估计</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
gmm (mpg - {xb:gear_ratio turn} - {b0}), instruments(gear_ratio turn)
</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . gmm (mpg - {xb:gear_ratio turn} - {b0}), instruments(gear_ratio turn)
## 
## Step 1
## Iteration 0:   GMM criterion Q(b) =  471.67875  
## Iteration 1:   GMM criterion Q(b) =  3.058e-21  
## Iteration 2:   GMM criterion Q(b) =  4.073e-31  
## 
## Step 2
## Iteration 0:   GMM criterion Q(b) =  3.566e-32  
## Iteration 1:   GMM criterion Q(b) =  3.566e-32  (backed up)
## 
## note: model is exactly identified
## 
## GMM estimation 
## 
## Number of parameters =   3
## Number of moments    =   3
## Initial weight matrix: Unadjusted                 Number of obs   =         74
## GMM weight matrix:     Robust
## 
## ------------------------------------------------------------------------------
##              |               Robust
##              |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##   gear_ratio |   3.032884   1.501664     2.02   0.043     .0896757    5.976092
##         turn |  -.7330502    .117972    -6.21   0.000    -.9642711   -.5018293
## -------------+----------------------------------------------------------------
##          /b0 |   41.21801   8.396739     4.91   0.000     24.76071    57.67532
## ------------------------------------------------------------------------------
## Instruments for equation 1: gear_ratio turn _cons
## 
## .</code></pre>
</div>
</div>
<div id="工具变量法的mm与gmm估计" class="section level2">
<h2>工具变量法的MM与GMM估计</h2>
<div id="工具变量法的原理" class="section level3">
<h3>工具变量法的原理</h3>
<p>　　工具变量的思想其实很简单。虽然内生变量<span class="math inline">\(x\)</span>是“坏”的变量（与扰动项相关），但仍可能有“好”的部分（与扰动项不相关的部分），正如坏人通常也有好的一面。如果能将内生变量<em><span class="math inline">\(x\)</span></em>分解为内生部分与外生部分之和，则可能使用其外生部分得到一致估计<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>。</p>
<p>　　而要实现这种分离，通常需要借助另一变量，比如<strong><span class="math inline">\(z\)</span></strong>，称为 “工具变量”（Instrumental Variable，简记 IV），因为它起着工具性的作用。</p>
<p>　　显然，并非任何变量都可以作为工具变量。首先，变量<span class="math inline">\(z\)</span>要能够帮助内生变量<span class="math inline">\(x\)</span>分离出一个外生部分，则变量<span class="math inline">\(z\)</span>自身必须是“干净”的，即满足“外生性”（<span class="math inline">\(z\)</span>与扰动项<span class="math inline">\(\varepsilon\)</span>不相关）：<br />
<span class="math display">\[
Cov(z_{i},\varepsilon_{i})=0 \tag{16}
\]</span>
　　其次，变量<span class="math inline">\(z\)</span>还须与<span class="math inline">\(x\)</span>有一定关系，即满足“相关性”:<br />
<span class="math display">\[
Cov(z_{i},x_{i})\not =0  \tag{17}
\]</span></p>
<p>　　<strong>工具变量法中，假设待估参数的个数为<span class="math inline">\(k\)</span>，矩条件的个数为<span class="math inline">\(l\)</span>：</strong></p>
<ul>
<li><p>1.无法识别（unidentified）：当 <span class="math inline">\(k &gt; l\)</span> 时，即工具变量个数少于内生变量个数，则无法进行2SLS 估计，称为“不可识别”（unidentified），因为无法得到对模型参数的一致估计；</p></li>
<li><p>2.恰好识别( just or exactly identified )：当 <span class="math inline">\(k = l\)</span> 时；</p></li>
<li><p>3.过度识别( overidentified )：当 <span class="math inline">\(k &lt; l\)</span>时，即待估参数个数小于工具变量的个数。</p></li>
</ul>
</div>
<div id="工具变量法两阶段最小二乘估计2sls" class="section level3">
<h3>工具变量法：两阶段最小二乘估计（2SLS）</h3>
<p>　　<strong>两阶段最小二乘法其本质上是属于工具变量，回归分两个阶段进行，因此而得名。具体机理是：<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></strong></p>
<ul>
<li><p>第一步，将结构方程先转换为简化式模型（约简型方程），简化式模型里的每一个方程都不存在随机解释变量问题，可以直接采用普通最小二乘法进行估计。</p></li>
<li><p>第二步，由第一步得出的 <span class="math inline">\(\hat{Y}\)</span>的估计量替换 <span class="math inline">\(Y\)</span>。该方程中不存在随机解释变量问题，也可以直接用普通最小二乘法进行估计。</p></li>
</ul>
<p>　　例子：一般 IV 回归模型为：
<span class="math display">\[
Y_{i}=\beta_{0}+\beta_{1} X_{1 i}+\ldots+\beta_{k} X_{k i}+\beta_{k+1} W_{1 i}+\ldots+\beta_{k+r} W_{r i}+u_{i} (i=1,2, \ldots, n) \tag{18}
\]</span></p>
<ul>
<li>其中：
<ul>
<li><span class="math inline">\(Y_{i}\)</span>为因变量；</li>
<li><span class="math inline">\(u_{i}\)</span>为误差项，表示测量误差和/或遗漏因素；</li>
<li><span class="math inline">\(X_{1 i} , X_{2 i} , \ldots , X_{k i}\)</span>表示k个内生回归变量，可能与 <span class="math inline">\(u_{i}\)</span>相关；</li>
<li><span class="math inline">\(W_{1 i} , W_{2 i}, \ldots , W_{r i}\)</span> 表示 r 个包含的外生变量，与 <span class="math inline">\(u_{i}\)</span> 不相关；</li>
<li><span class="math inline">\(\beta_{0} , \beta_{1} , \ldots , \beta_{k+r}\)</span> 为未知回归系数；</li>
<li><span class="math inline">\(Z_{1 i} , Z_{2 i} , \ldots , Z_{m i}\)</span>为 <span class="math inline">\(m\)</span> 个工具变量。</li>
</ul></li>
</ul>
<p>　　以单内生回归变量的 2SLS 为例，当只有一个内生回归变量 <span class="math inline">\(X\)</span>和一些其他的包含的外生变量时，感兴趣的方程为：
<span class="math display">\[
Y_{i}=\beta_{0}+\beta_{1} X_{i}+\beta_{2} W_{1 i}+\ldots+\beta_{k+r} W_{r i}+u_{i} \tag{19}
\]</span>
　　其中同前 <span class="math inline">\(X_{i}\)</span> 可能与误差项相关，但 <span class="math inline">\(W_{1 i}, W_{2 i}, \ldots, W_{r i}\)</span>与误差项不相关。</p>
<p>　　2SLS 的总体第一阶段回归将 <span class="math inline">\(X\)</span> 与外生变量 <span class="math inline">\(W\)</span>和工具变量（<span class="math inline">\(Z\)</span>）联系在了一起：
<span class="math display">\[
X_{i}=\pi_{0}+\pi_{1} Z_{1 i}+\ldots+\pi_{m} Z_{m i}+\pi_{m+1} W_{1 i}+\ldots+\pi_{m+r} W_{r i}+v_{i}  \tag{20}
\]</span>
　　其中 <span class="math inline">\(\pi_{0} , \pi_{1} , \ldots , \pi_{m}\)</span>为未知回归系数， <span class="math inline">\(v_{i}\)</span>为误差项。</p>
<p>　　在 2SLS 的第一阶段中，可用 OLS 估计（ 20）式中的未知系数，并记由该回归得到的预测值为<span class="math inline">\(\hat{X}_{1}, \hat{X}_{2}, \ldots, \hat{X}_{n}\)</span> 。</p>
<p>　　在 2SLS 的第二阶段中，用 OLS 估计的 <span class="math inline">\(X_{i}\)</span> 的预测值替换（19）式。也就是用 OLS 估计 <span class="math inline">\(Y_{i}\)</span>关于 <span class="math inline">\(\hat{X}_{i}\)</span>，<span class="math inline">\(W_{1 i}, W_{2 i}, \ldots, W_{r i}\)</span>的回归。得到的 <span class="math inline">\(\beta_{0}, \beta_{1}, \ldots, \beta_{1+r}\)</span>估计量就是 2SLS 估计量。</p>
<p>　　当存在多个内生回归变量 <span class="math inline">\(X_{1 i}, X_{2 i}, \dots, X_{k i}\)</span>时，除了每个内生回归变量都需要自己的第一阶段回归以外， 2SLS 的算法是类似的。其中每个内生回归变量的第一阶段回归形式同（20）式，即因变量是某个 <span class="math inline">\(X\)</span>，回归变量是所有工具变量（ <span class="math inline">\(Z\)</span>）和所有包含的外生变量（<span class="math inline">\(W\)</span>）。所有这些第一阶段回归一起得到了每个内生回归变量的预测值。</p>
<p>　　在 2SLS 的第二阶段中，用 OLS 估计内生回归变量（<span class="math inline">\(X\)</span>），分别用其预测值（<span class="math inline">\(\hat{X}\)</span>）替换后的（18）式。得到的<span class="math inline">\(\beta_{0}, \beta_{1}, \beta_{2}, \dots, \beta_{k+r}\)</span>估计量即为2SLS估计量。</p>
<p>　　<font color=blue >如果扰动项为球形扰动项（满足同方差、无自相关），则2SLS为最有效率的工具变量法。如果担心扰动项存在异方差，则依然可使用稳健标准误（robust standard errors）进行统计推断。</font></p>
</div>
<div id="工具变量法的矩估计mm" class="section level3">
<h3>工具变量法的矩估计（MM）</h3>
<p>　　在恰好识别的情况下，可将矩估计运用于工具变量法<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>。考虑以下多元回归模型，共有个<span class="math inline">\(K\)</span>个未知参数，</p>
<p>　　
<span class="math display">\[
\mathrm{y}_{i}=\beta_{1} x_{i 1}+\cdots+\beta_{\mathrm{K}} x_{i \mathrm{k}}+\varepsilon_{i} \quad(i=1, \ldots, n) \tag{21}
\]</span></p>
<p>　　 其中，第一个解释变量一般为常数项，即<span class="math inline">\(x_{i,t}\equiv1\)</span>。更紧凑地，此方程可写为：
<span class="math display">\[
\mathbf{y_{i}}=\mathbf{x_{i}}^{&#39;} \boldsymbol{\beta}+\boldsymbol{\varepsilon_{i}} \tag{22}
\]</span>
　　其中，<span class="math inline">\(\mathbf{x_{i}}^{\prime}\)</span>与<span class="math inline">\(\boldsymbol{\beta}\)</span>均为<span class="math inline">\(K\)</span>维列向量。在恰好识别的情况下，记由所有工具变量所构成的向量为<span class="math inline">\(\mathbf{z_{i}}^{&#39;}\)</span>（可以与<span class="math inline">\(\mathbf{x_{i}}^{\prime}\)</span>有重叠，即外生变量作为自己的工具变量），也是<span class="math inline">\(K\)</span>维列向量。由这些工具变量所提供的识别模型的总体矩条件为：</p>
<p><span class="math display">\[
\mathrm{E}\left(\mathbf{z}_{i} \varepsilon_{i}\right)=\mathrm{E}\left[\left(\begin{array}{c}
z_{11} \\
\vdots \\
z_{i k}
\end{array}\right) \varepsilon_{i}\right]=\left(\begin{array}{c}
0 \\
\vdots \\
0
\end{array}\right)=0    \tag{23}
\]</span>
　　 此<font color=blue >总体矩条件也被称为“正交条件”（orthogonality conditions）</font>在数理统计中，如果两个随机变量的乘积之期望为0，则称这两个随机变量正交。</p>
<p>　　 显然，<font color=blue >如果两个随机变量中包含一个随机扰动项，则 “两个随机变量不相关” 就等价于 “两个随机变量正交”</font>，比如：<br />
<span class="math display">\[
0=\operatorname{Cov}\left(z_{i }, \varepsilon_{i}\right)=\mathrm{E}\left(z_{i } \varepsilon_{i}\right)-\mathrm{E}\left(z_{i }\right) \underbrace{\mathrm{E}\left(\varepsilon_{i}\right)}_{=0}=\mathrm{E}\left(z_{i } \varepsilon_{i}\right)=0
\]</span>
　　其中，扰动项<span class="math inline">\(\varepsilon_{i}\)</span>的期望为0（只要回归方程有常数项，总可以将扰动项的非零期望归入常数项）。由于<span class="math inline">\(\varepsilon_{i}={y_{i}}-\mathbf{x_{i}}^{&#39;} \boldsymbol{\beta}\)</span>，将此表达式代入上式的正交条件，可得更便于估计的总体矩条件：
<span class="math display">\[
\mathrm{E}\left[\mathbf{z}_{i}\left(y_{i}-\mathbf{x}_{i}^{\prime} \beta\right)\right]=\mathbf{0} \tag{24}
\]</span>
　　以样本矩替代总体矩可得：
<span class="math display">\[
\mathbf{g}_{n}(\hat{\beta}) \equiv \frac{1}{n} \sum_{i=1}^{n}\left[\mathbf{z}_{i}\left(y_{i}-\mathbf{x}_{i}^{\prime} \hat{\beta}\right)\right]=\mathbf{0}  \tag{25}
\]</span>
　　这是一个由<span class="math inline">\(K\)</span>个方程（<span class="math inline">\(\mathbf{z_{i}}\)</span>的维度）、<span class="math inline">\(K\)</span>个未知数（<span class="math inline">\(\beta\)</span>的维度）所构成的线性联立方程组，故一般情况下存在唯一解，即矩估计量（Method of Moments，简记MM）。<font color=blue> 可以证明，此MM 估计量等价于2SLS。</font></p>
</div>
<div id="工具变量法的广义矩估计gmm" class="section level3">
<h3>工具变量法的广义矩估计（GMM）</h3>
<blockquote>
<p>　　在恰好识别情况下，目标函数的最小值等于 0 ，GMM 估计量与 MM 估计量等价；然而，在过度识别的情况下，却无法使用传统的矩估计。这是因为，此时<span class="math inline">\(\mathbf{z_{i}}\)</span>的维度大于<span class="math inline">\(\beta\)</span>的维度，对参数向量<span class="math inline">\(\beta\)</span>有过多的约束，使得方程个数大于未知数个数，导致此线性方程组无解。</p>
</blockquote>
<blockquote>
<p>　　由于在恰好识别的情况下，矩估计等价于2SLS；而在过度识别的情况下，矩估计不适用而2SLS依然可行，故传统上工具变量法一般用2SLS。</p>
</blockquote>
<blockquote>
<p><font color=blue> 　　然而在过度识别情况下，MM 不再适用，GMM 可以有效地组合矩条件，使 GMM 比 MM 更有效。</font></p>
</blockquote>
<div id="lars-hansen的脑筋急转弯" class="section level4">
<h4>Lars Hansen的脑筋急转弯</h4>
<p>　　看似已走入死胡同的矩估计，却被 Lars Hansen起死回生了。假设工具变量<span class="math inline">\(\mathbf{z_{i}}\)</span>的维度<span class="math inline">\(L\)</span>，且严格大于参数向量<span class="math inline">\(\beta\)</span><span class="math inline">\(\beta\)</span>的维度 。如上所述，此时样本矩的线性方程组无解。这意味着，找不到<span class="math inline">\(\hat{\beta}\)</span>，能够使得上述样本矩等于0向量。　　</p>
<p>　　但Lars Hansen来了个脑筋急转弯：虽然无法找到<span class="math inline">\(\hat{\beta}\)</span>，使得样本矩等于0，但总可以让样本矩尽量接近于0。由于样本矩<span class="math inline">\(\mathbf{g}_{n}(\hat{\beta})\)</span>为<span class="math inline">\(L\)</span>维列向量，故可用二次型来衡量它到0向量的距离，比如最小化如下目标函数：　　</p>
<p><span class="math display">\[
\min _{\hat{\beta}}\left(\mathbf{g}_{i}(\beta)\right)\left(\mathbf{g}_{n}(\beta)\right) \tag{26}
\]</span>
　　这个脑筋急转弯价值不菲，三十多年后为Lars　Hansen带来了诺贝尔奖。更一般地，可用一个“权重矩阵”（weightingmatrix）（可依赖于样本）来构成二次型，定义最小化的目标函数为：<br />
　　
<span class="math display">\[
\min _{\tilde{\beta}} J(\beta, \mathbf{W}) \equiv n\left(\mathbf{g}_{n}(\beta)\right) \mathbf{W}\left(\mathbf{g}_{n}(\beta)\right) \tag{27}
\]</span>
　　其中，因子<span class="math inline">\(n\)</span>不影响最小化。这是一个无约束的最优化问题，目标函数<span class="math inline">\(J(\hat{\beta}, \widehat{\mathbf{W}})\)</span>是<span class="math inline">\(\hat{\beta}\)</span>的二次（型）函数，故可得到其解析解（推导方法类似于 OLS），即 “GMM估计量”。</p>
<p>　　在恰好识别的情况下，目标函数的最小值正好为0，故GMM估计量等价于MM估计量（故也等价于 2SLS），因此 GMM 确实是 MM 的推广。</p>
</div>
<div id="矩条件的强弱" class="section level4">
<h4>矩条件的强弱</h4>
<p>　　显然，GMM 估计量取决于权重矩阵。对于<span class="math inline">\(\widehat{\mathbf{W}}\)</span>的灵活选择是GMM 的最大优点之一，因为不同矩条件的强弱程度一般不同。矩条件只是说明<span class="math inline">\(\mathrm{E}(z_{i } \varepsilon_{i})=0\)</span>，但每个矩条件的方差<span class="math inline">\(\mathrm{Var}(z_{i } \varepsilon_{i})\)</span>可以不同，参见右图<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>。</p>
<p><span class="math display">\[
\mathbf{Y}=\mathbf{X} \boldsymbol{\beta}+\boldsymbol{\varepsilon}
\]</span>
一个强的矩条件意味着其对应的方差较小（上图实线，矩条件1），是一个比较紧的约束，包含更大的信息量，故会通过<span class="math inline">\(\widehat{\mathbf{W}}\)</span> 得到较大的权重，使得GMM估计量更有效率。具体来说，矩条件的协方差矩阵可写为：</p>
<p><span class="math display">\[
\mathbf{S} \equiv \operatorname{Var}\left(\mathbf{z}_{i} \varepsilon_{i}\right)=\mathrm{E}\left(\varepsilon_{i}^{2} \mathbf{z} \mathbf{z}_{i}^{\prime}\right) \tag{28}
\]</span>
以残差（比如<span class="math inline">\(e_{i}\)</span>，2SLS残差，因为2SLS也是一致的）替代上式的扰动项<span class="math inline">\(\varepsilon_{i}\)</span>，并以样本均值替代总体期望，可得对此协方差矩阵的一致估计
<span class="math display">\[
\hat{\mathbf{S}} \equiv \frac{1}{n} \sum_{i=1}^{n} e_{i}^{2} \mathbf{z} \mathbf{z}_{i} \tag{29}
\]</span>
Hansen (1982)证明，如果让<span class="math inline">\(\widehat{\mathbf{W}}=\hat{\mathbf{S}}^{-1}\)</span> （方差矩阵的逆矩阵或“倒数”），则可使得 GMM 估计量的渐近方差最小化，其相应的GMM估计量称为“最优GMM”（optimal GMM）。自然地，既然存在最优GMM，一般就不会使用其他的权重矩阵了，故一般所说的GMM估计量默认就是最优GMM。</p>
<ul>
<li>更详细的解释：</li>
</ul>
<p><span class="math display">\[
\mathbf{Y}=\mathbf{X} \boldsymbol{\beta}+\boldsymbol{\varepsilon}  \tag{30}
\]</span></p>
<p>　　其中， <span class="math inline">\(Z\)</span>是工具变量，<span class="math inline">\(E(\varepsilon|Z）=0。X=(x_{1},x_{2},...,x_{k}))\)</span> ，是 <span class="math inline">\(k\)</span>个自变量向量，<span class="math inline">\(Z=(z_{1},z_{2},...,z_{k})\)</span>是 个工具变量向量。相应的，待估计的系数 <span class="math inline">\(\beta\)</span>是<span class="math inline">\(k\)</span>维向量。定义<span class="math inline">\(E=Y-X\beta\)</span>为误差向量，对于任意估计出来的参数 <span class="math inline">\(\hat{\beta}\)</span> ，残差项为<span class="math inline">\(\hat{E}=Y-X\hat{\beta}\)</span>。</p>
<p>　　根据工具变量的含义，它应该和误差项<span class="math inline">\(\epsilon\)</span>独立：<span class="math inline">\(E(Z^{&#39;}\varepsilon)=0\)</span>，这就是我们需要的矩条件。计算的时候，理论上应该利用 <span class="math inline">\(E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right) \equiv \frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}=0\)</span>求解，注意到，我们有<span class="math inline">\(j\)</span> 个工具变量，也就是<span class="math inline">\(j\)</span>个矩条件（<span class="math inline">\(j\)</span>个方程）。理论上，需要根据这<span class="math inline">\(j\)</span>个方程求解<span class="math inline">\(k\)</span>个待估计的参数。但是不幸的是，如果工具变量的数量 小于待估计的参数数量 ，方程是不可识别的——通常不可能通过2个方程解出3个未知数。如果工具变量等于待估计的参数，是恰好可识别的，但这种情况在GMM中很难碰到。最常见的是工具变量多于待估计的参数，即 <span class="math inline">\(j&gt;k\)</span>，这意味着要找<span class="math inline">\(k\)</span>个参数，让<span class="math inline">\(j\)</span>个方程同时等于零。这难度相当大，实际上大多数时候找不到，怎么办呢？在矩估计里面，采用的办法是，找<span class="math inline">\(k\)</span>个参数，让<span class="math inline">\(E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right) \equiv \frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\)</span>和零之间的距离最小。实际计算的时候，需要借助一个半正定的矩阵 <span class="math inline">\(A\)</span>，计算向量 <span class="math inline">\(E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right) \equiv \frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\)</span>的模：
<span class="math display">\[
\left\|E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right)\right\|_{\mathbf{A}} \equiv\left\|\frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\right\|_{\mathbf{A}}=N\left(\frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\right)^{\prime} \mathbf{A}\left(\frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\right)=\frac{1}{N} \hat{\mathbf{E}}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z}^{\prime} \hat{\mathbf{E}}  \tag{31}
\]</span>
　　目标变成，寻找参数向量<span class="math inline">\(\hat{\boldsymbol{\beta}}_{\mathbf{A}}=\arg \min \left\|E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right)\right\|_{\mathbf{A}}\)</span>，这就要用到一阶条件等于零：
<span class="math display">\[
\frac{d\left\|E_{N}\left(\mathbf{Z}^{\prime} \varepsilon\right)\right\|_{A}}{d \hat{\beta}}=\ldots=\frac{2}{N} \hat{\mathbf{E}}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z}^{\prime}(-\mathbf{X})=0  \tag{32}
\]</span>
　　计算的过程利用到了连锁规则和向量求导的公式。继续推导，把<span class="math inline">\(\hat{E}=Y-X\hat{\beta}\)</span>带入，得</p>
<p>到：
<span class="math display">\[
\begin{array}{c}
0=\hat{\mathbf{E}}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z} \mathbf{X}=(\mathbf{Y}-\mathbf{X} \hat{\boldsymbol{\beta}})^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z} \mathbf{X}=\mathbf{Y}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z}^{\prime} \mathbf{X}-\hat{\boldsymbol{\beta}}^{\prime} \mathbf{X}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z} \mathbf{X} \\
\hat{\boldsymbol{\beta}}_{\mathbf{A}}=\left(\mathbf{X}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z} \mathbf{X}\right)^{-1} \mathbf{X}^{\prime} \mathbf{Z} \mathbf{A} \mathbf{Z}^{\prime} \mathbf{Y}
\end{array}  \tag{33}
\]</span>
　　这就是<span class="math inline">\(\beta\)</span>的GMM估计量，这个估计量是有偏的，它的期望值不等于真实的<span class="math inline">\(\beta\)</span>；然而它是一致的，当样本量足够大的时候，它会接近真实的<span class="math inline">\(\beta\)</span>。这个估计量和<span class="math inline">\(A\)</span>有关，但是<span class="math inline">\(A\)</span>只影响参数估计的有效性——不同的A对应的参数 <span class="math inline">\(\hat{\boldsymbol{\beta}}_{\mathbf{A}}\)</span>收敛的速度不同。这里的A其实是对不同的矩条件加以不同的权重，可以找到一个收敛最快的A，称为 <span class="math inline">\(A_{EGMM}\)</span>，可以证明：<span class="math inline">\(\mathbf{A}_{E G M M}=\operatorname{Var}(\mathbf{z} \varepsilon)^{-1}\)</span>。</p>
<p>　　对于工具变量法常用的两阶段最小二乘法（2SLS），如果假定误差项是独立同分布，那么<span class="math inline">\(\mathbf{A}_{E G M M}=\operatorname{Var}(\mathbf{z} \varepsilon)^{-1}=(Z^{&#39;}Z)^{-1}\)</span>，此时
<span class="math display">\[
\hat{\boldsymbol{\beta}}_{G M M}=\left(\mathbf{X}^{\prime} \mathbf{Z}(\mathbf{Z} \mathbf{Z})^{-1} \mathbf{Z} \mathbf{X}\right)^{-1} \mathbf{X}^{\prime} \mathbf{Z}(\mathbf{Z} \mathbf{Z})^{-1} \mathbf{Z}^{\prime} \mathbf{Y} \tag{34}
\]</span>
　　这实际上就是传统通过两阶段最小二乘法（2SLS）估计出来的参数，殊途同归。</p>
</div>
</div>
<div id="工具变量法的过度识别检验" class="section level3">
<h3>工具变量法的过度识别检验</h3>
<blockquote>
<p>在过度识别的情况下，则可以进行 “过度识别检验”（overidentification test）。考虑以下原假设：
<span class="math display">\[
H_{0}:所有工具变量都是外生
\]</span>
其实，这就是检验总体矩条件是否成立：
<span class="math display">\[
H_{0}:\mathrm{E}\left(z_{i } \varepsilon_{i}\right)=0
\]</span></p>
</blockquote>
<div id="sls过度识别检验" class="section level4">
<h4>2SLS过度识别检验</h4>
<ul>
<li>Sargan统计量　　</li>
</ul>
<p>　　上面提到了，只有恰好识别和过度识别才能用 IV 方法估计。假设待估参数的个数为 <span class="math inline">\(k\)</span>，矩条件的个数为 <span class="math inline">\(l\)</span>。当 <span class="math inline">\(k=l\)</span> 时，称为“恰好识别”，当 <span class="math inline">\(k&lt;l\)</span>时，称为 “过度识别”。</p>
<p><font color=blue>　　一个很重要的命题是：只有过度识别情况下才能检验工具变量的外生性，而恰好识别情况下无法检验。</font></p>
<p>　　具体思路如下：工具变量的外生性意味着它们和 <span class="math inline">\(\mathrm{u}_{\mathrm{i}}\)</span>不相关。这表明工具变量和 <span class="math inline">\(\hat{\mathrm{u}}_{\mathrm{i}}^{2 \mathrm{SLS}}\)</span> 近似不相关，其中
<span class="math display">\[
\hat{\mathrm{u}}_{\mathrm{i}}^{2 S L S}=Y_{i}-\left(\hat{\beta}_{0}^{2 S L S}+\hat{\beta}_{1}^{2 S L S} X_{1 i}+\ldots+\hat{\beta}_{k+r}^{2 S L S} X_{r i}\right) \tag{35}
\]</span>
　　为基于所有工具变量的 2SLS 回归估计残差（由于抽样变异性因此是近似的而不是精确地，注意到这些残差是利用 <span class="math inline">\(X\)</span> 值而不是用其第一阶段的预测值得到的。）</p>
<p>　　于是，如果工具变量事实上是外生的，那么 <span class="math inline">\(\hat{\mathrm{u}}_{\mathrm{i}}^{2 \mathrm{SLS}}\)</span> 关于工具变量和包含的外生变量回归中工具变量的系数都应该等于零，而这个假设是可以检验的。</p>
<p>　　过度识别约束检验（ J 统计量），又称为 Sargan 统计量。令 <span class="math inline">\(\hat{\mathrm{u}}_{\mathrm{i}}^{2 \mathrm{SLS}}\)</span>为来自（22）式 2SLS 估计的残差。</p>
<p>　　利用 OLS 估计下面的回归系数：
<span class="math display">\[
\hat{u}_{i}^{2 S L S}=\delta_{0}+\delta_{1} Z_{1 i}+\ldots+\delta_{m} Z_{m i}+\delta_{n t+1} W_{1 i}+\ldots+\delta_{m+r} W_{n}+e_{i}  \tag{36}
\]</span></p>
<blockquote>
<p>　　其中， <span class="math inline">\(e_{i}\)</span>为回归误差项。令 F表示检验假设<span class="math inline">\(\delta_{1}=\ldots=\delta_{m}=0\)</span>的同方差适用 F 统计量。则过度识别约束检验统计量为 <span class="math inline">\(J=mF\)</span>。如果 <span class="math inline">\(e_{i}\)</span> 是同方差的，则在所有工具变量都是外生的原假设下， <span class="math inline">\(J\)</span>服从 <span class="math inline">\(\chi_{m-k}^{2}\)</span>分布，其中 <span class="math inline">\(m-k\)</span> 为“过度识别度”，也就是工具变量的个数减去内生回归变量的个数。</p>
</blockquote>
<ul>
<li>沃尔德检验（Wald Test）</li>
</ul>
<p>　　记所有工具变量所构成的向量为<span class="math inline">\(\mathbf{z_{i}}\)</span>（包含工具变量与外生解释变量），则所有工具变量皆外生的原假设可写为以下“总体矩条件”（population moment conditions）：
<span class="math display">\[
H_{0}:\mathrm{E}\left(z_{i } \varepsilon_{i}\right)=0 \tag{37}
\]</span>
　　即工具变量<span class="math inline">\(\mathbf{z_{i}}\)</span>与扰动项<span class="math inline">\(\varepsilon_{i}\)</span>正交。根据样本数据，可得其相应的“样本矩”（sample moments），记为<span class="math inline">\(\mathbf{g}_{n}\)</span>其中下标<span class="math inline">\(n\)</span>表示样本容量；而且如果总体矩条件正确，则样本矩也应该离0向量不远：
<span class="math display">\[
\mathbf{g}_{n} \equiv \frac{1}{n} \sum_{i=1}^{n} \mathbf{z}_{i} e_{i} \approx \mathbf{0} \tag{38}
\]</span>
　　为了度量此距离，可构造如下二次型来检验原假设：
<span class="math display">\[
\mathbf{g}_{n}^{\prime}\left[\widehat{\operatorname{Var}\left(\mathbf{g}_{\mathrm{n}}\right)}\right]^{-1} \mathbf{g}_{n} \rightarrow \chi^{2}(L-K) \tag{39}
\]</span>
　　其中，二次型矩阵为样本矩<span class="math inline">\(\mathbf{g}_{n}\)</span>之协方差矩阵估计量的逆矩阵。</p>
<blockquote>
<p>　　事实上，在过度识别的情况下，通常使用更有效率的广义矩估计（Generalized Method of Moments，简记 GMM）。故现在一般使用GMM的Hansen’s J统计量来进行过度识别检验，原理与上述Wald检验类似。<br />
　　需要特别说明的是，无论使用何种过度识别检验，都有一个不检验的大前提（maintained hypothesis），即模型至少是恰好识别的。因此，即使检验结果接受了“所有工具变量皆外生”的原假设，也并不表示就证明了所有工具变量的外生性。它只是表明，在模型恰好识别的情况下，多余的那些工具变量也是外生的。<br />
　　总之，根据目前的计量经济学，工具变量的外生性在本质上依然是不可检验的，学者们仍需围绕“排他性约束”而进行定性讨论，甚至无休止的争论。</p>
</blockquote>
</div>
<div id="gmm方法的过度识别检验" class="section level4">
<h4>GMM方法的过度识别检验</h4>
<ul>
<li>Hansen统计量</li>
</ul>
<p>　　前文已经介绍，使用GMM方法的目标是选择参数，最小化<span class="math inline">\(E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right) \equiv \frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\)</span>和零之间的距离<span class="math inline">\(\left\|E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right)\right\|_{A}\)</span>。那么问题来了，多小算小呢？会不会是最小值也显著大于零？如果这样的话，方法的适用性就成问题。也就是说，根据你估计出来的参数，算出的残差项实际上和工具变量不是独立。Hansen检验和Sargan检验的逻辑就是，以<span class="math inline">\(\left\|E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right)\right\|_{A}\)</span>最小化为目标，估计出参数，然后把参数带入，看看它是否真的等于零。如果统计上不能拒绝它等于零，则所用工具变量可靠；如果统计上拒绝它等于零，则不可靠。</p>
<p>　　如果零假设成立（即 <span class="math inline">\(H_{0}\)</span>：工具变量是联合有效的），那么 <span class="math inline">\(E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right) \equiv \frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\)</span>应随机分布于零附近，它和零的距离应服从<span class="math inline">\(\chi^{2}\)</span>分布：<br />
<span class="math display">\[
\left\|E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right)\right\|_{\mathbf{A}_{\mathrm{EGMM}}} \equiv\left\|\frac{1}{N} \mathbf{Z}^{\prime} \hat{\mathbf{E}}\right\|_{\mathbf{A}_{\mathrm{EGM}}}=\frac{1}{N} \hat{\mathbf{E}}^{\mathbf{\prime}} \mathbf{Z} \mathbf{A}_{\mathrm{EGMM}} \mathbf{Z}^{\prime} \hat{\mathbf{E}} \sim \chi^{2}_{j-k} \tag{40}
\]</span>
　　这就是Hansen统计量，它服从自由度为<span class="math inline">\(j-k\)</span>的<span class="math inline">\(\chi^{2}\)</span>分布，这里自由度其实就是过度识别的维度。在实际使用中，不应该显著（p值小于0.1）；如果显著，则表明拒绝了零假设，工具变量不是联合有效的。</p>
<blockquote>
<p>　　 然而，需要注意的是，如果使用的工具变量太多，那么Hansen统计量会非常不显著，常常等于1。这是因为，<span class="math inline">\(j-k\)</span>越大，意味着分布显<span class="math inline">\(\chi^{2}\)</span>著的门槛越高（请查阅<span class="math inline">\(\chi^{2}\)</span>分布的表格）。也就是说，工具变量太多，会让Hansen检验的效果变弱，这是需要注意的。通常Hansen检验的p值大于0.25就要小心了，这时需要考虑减少工具变量的数量。</p>
</blockquote>
<ul>
<li>Sargan 检验的统计量</li>
</ul>
<p>　　 Sargan 检验的统计量类似，只不过把Hansen统计量中的<span class="math inline">\(A_{EGMM}\)</span> 替换成了 $( )^{-1} $，即
<span class="math display">\[
S=\left\|E_{N}\left(\mathbf{Z}^{\prime} \boldsymbol{\varepsilon}\right)\right\|_{\left(z^{\prime} z\right)^{-1}}=\frac{1}{N} \hat{\mathbf{E}}^{\prime} \mathbf{Z}(\mathbf{Z} \mathbf{Z})^{-1} \mathbf{Z}^{\prime} \hat{\mathbf{E}} \sim \chi_{j-k}^{2}\tag{41}
\]</span></p>
<blockquote>
<p>　　 然而，该统计量有时候是不一致的，如果在命令中要求报告稳健的Sargan统计量，软件会做两阶段GMM估计（先找任意合理的H，令 <span class="math inline">\(\mathbf{A}=\left(\mathbf{Z}^{\prime} \mathbf{H} \mathbf{Z}\right)^{-1}\)</span>，估计出第一步参数 <span class="math inline">\(\hat{\beta_{1}}\)</span>；再根据<span class="math inline">\(\hat{\beta_{1}}\)</span>，计算出残差项的方差-协方差矩阵<span class="math inline">\(\hat{\Omega}_{\hat{\beta}_{1}}\)</span> ，令 <span class="math inline">\(\mathbf{A}=\left(\mathbf{Z}^{\prime} \hat{\Omega}_{\hat{\beta}_{1}} \mathbf{Z}\right)^{-1}\)</span>，估计出第二部参数 <span class="math inline">\(\hat{\beta_{1}}\)</span>），根据第二步的参数结果，默默报告出Hansen统计量。整体上说，Hansen统计量好像更靠谱一点，所以报告的时候，更多关注Hansen统计量。</p>
</blockquote>
</div>
</div>
<div id="stata实现-1" class="section level3">
<h3>Stata实现</h3>
<div id="两阶段最小二乘估计一步gmm估计" class="section level4">
<h4>两阶段最小二乘估计(一步GMM估计)</h4>
<ul>
<li>两阶段最小二乘估计(2SLS)</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
*工具变量两阶段最小二乘(2SLS)
ivregress 2sls mpg gear_ratio (turn = weight length headroom)
*过度识别检验
estat overid</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . *工具变量两阶段最小二乘(2SLS)
## . ivregress 2sls mpg gear_ratio (turn = weight length headroom)
## 
## Instrumental variables (2SLS) regression          Number of obs   =         74
##                                                   Wald chi2(2)    =      90.94
##                                                   Prob &gt; chi2     =     0.0000
##                                                   R-squared       =     0.4656
##                                                   Root MSE        =     4.2007
## 
## ------------------------------------------------------------------------------
##          mpg |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##         turn |  -1.246426   .2012157    -6.19   0.000    -1.640801   -.8520502
##   gear_ratio |  -.3146499   1.697806    -0.19   0.853    -3.642288    3.012988
##        _cons |   71.66502    12.3775     5.79   0.000     47.40556    95.92447
## ------------------------------------------------------------------------------
## Instrumented:  turn
## Instruments:   gear_ratio weight length headroom
## 
## . *过度识别检验
## . estat overid
## 
##   Tests of overidentifying restrictions:
## 
##   Sargan (score) chi2(2) =  .675182  (p = 0.7135)
##   Basmann chi2(2)        =  .635359  (p = 0.7278)</code></pre>
<ul>
<li>一步GMM估计</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
gmm (mpg - {b1}*turn - {b2}*gear_ratio - {b0}), instruments(gear_ratio weight length headroom) onestep</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . gmm (mpg - {b1}*turn - {b2}*gear_ratio - {b0}), instruments(gear_ratio weight
## &gt;  length headroom) onestep
## 
## Step 1
## Iteration 0:   GMM criterion Q(b) =  475.42283  
## Iteration 1:   GMM criterion Q(b) =  .16100633  
## Iteration 2:   GMM criterion Q(b) =  .16100633  
## 
## GMM estimation 
## 
## Number of parameters =   3
## Number of moments    =   5
## Initial weight matrix: Unadjusted                 Number of obs   =         74
## 
## ------------------------------------------------------------------------------
##              |               Robust
##              |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          /b1 |  -1.246426   .1970566    -6.33   0.000    -1.632649   -.8602019
##          /b2 |  -.3146499   1.863079    -0.17   0.866    -3.966217    3.336917
##          /b0 |   71.66502   12.68722     5.65   0.000     46.79853    96.53151
## ------------------------------------------------------------------------------
## Instruments for equation 1: gear_ratio weight length headroom _cons</code></pre>
<blockquote>
<p>　　可以看到，两阶段最小二乘( <code>ivregress 2sls</code> )与GMM的一步估计（<code>gmm onestep</code>）结果完全相同。</p>
</blockquote>
</div>
<div id="工具变量gmm估计两步-gmm-估计" class="section level4">
<h4>工具变量GMM估计（两步 GMM 估计）</h4>
<ul>
<li>工具变量GMM估计</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
*工具变量GMM估计
ivregress gmm mpg gear_ratio (turn = weight length headroom)
*过度识别检验
estat overid</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . *工具变量GMM估计
## . ivregress gmm mpg gear_ratio (turn = weight length headroom)
## 
## Instrumental variables (GMM) regression           Number of obs   =         74
##                                                   Wald chi2(2)    =      97.83
##                                                   Prob &gt; chi2     =     0.0000
##                                                   R-squared       =     0.4769
## GMM weight matrix: Robust                         Root MSE        =     4.1559
## 
## ------------------------------------------------------------------------------
##              |               Robust
##          mpg |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##         turn |  -1.208549   .1882903    -6.42   0.000    -1.577591   -.8395071
##   gear_ratio |    .130328    1.75499     0.07   0.941     -3.30939    3.570046
##        _cons |   68.89218   12.05955     5.71   0.000     45.25589    92.52847
## ------------------------------------------------------------------------------
## Instrumented:  turn
## Instruments:   gear_ratio weight length headroom
## 
## . *过度识别检验
## . estat overid
## 
##   Test of overidentifying restriction:
## 
##   Hansen&#39;s J chi2(2) =  .54848 (p = 0.7601)</code></pre>
<ul>
<li>两步 GMM 估计</li>
</ul>
<pre class="stata"><code>sysuse auto,clear
gmm (mpg - {b1}*turn - {b2}*gear_ratio - {b0}),  ///
     instruments(gear_ratio weight length headroom) wmatrix(robust)</code></pre>
<pre><code>## 
## 
## . sysuse auto,cl(1978 Automobile Data)
## 
## . gmm (mpg - {b1}*turn - {b2}*gear_ratio - {b0}),  ///
## &gt;      instruments(gear_ratio weight length headroom) wmatrix(robust)
## 
## Step 1
## Iteration 0:   GMM criterion Q(b) =  475.42283  
## Iteration 1:   GMM criterion Q(b) =  .16100633  
## Iteration 2:   GMM criterion Q(b) =  .16100633  
## 
## Step 2
## Iteration 0:   GMM criterion Q(b) =  .00863899  
## Iteration 1:   GMM criterion Q(b) =  .00741189  
## Iteration 2:   GMM criterion Q(b) =  .00741189  
## 
## GMM estimation 
## 
## Number of parameters =   3
## Number of moments    =   5
## Initial weight matrix: Unadjusted                 Number of obs   =         74
## GMM weight matrix:     Robust
## 
## ------------------------------------------------------------------------------
##              |               Robust
##              |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          /b1 |  -1.208549   .1882903    -6.42   0.000    -1.577591   -.8395071
##          /b2 |    .130328    1.75499     0.07   0.941     -3.30939    3.570046
##          /b0 |   68.89218   12.05955     5.71   0.000     45.25589    92.52847
## ------------------------------------------------------------------------------
## Instruments for equation 1: gear_ratio weight length headroom _cons</code></pre>
<blockquote>
<p>可以看到，两阶段最小二乘的GMM估计( <code>ivregress gmm</code> )与GMM的二步估计（<code>gmm twostep</code>）结果完全相同。</p>
</blockquote>
</div>
</div>
<div id="gmm-过程的-stata-命令说明" class="section level3">
<h3>GMM 过程的 Stata 命令说明</h3>
<p>　　在 Stata 中， gmm 的一般命令形式为：</p>
<pre class="stata"><code> gmm  ([reqname1:]rexp_1)  ([reqname2:]rexp_2) . . . [if] [in] [weight] [,options]</code></pre>
<p>　　其中：</p>
<ul>
<li><code>reqname_j</code> 代表第 j 个剩余方程的表达式</li>
<li><code>rexp_j</code> 是第 j 个残差方程的可替换表达式</li>
</ul>
<p>GMM 的矩估计命令形式为：</p>
<pre class="stata"><code>gmm moment_pro [if] [in] [weight],
　　      {equations(namelist) | nequations(#)}
　　      {parameters(namelist) | nparameters(#)}  [options]
　　      [program_options]</code></pre>
<p>　　其中，<code>moment_prog</code> 是以矩条件为基础构造的<font color=blue> 矩估计表达式。</font></p>
<p>　　各个选项具体说明如下：</p>
<ul>
<li>Model 选项
<ul>
<li><code>derivative([reqname|#]/name=dexp_jk)</code> ：指定 <code>reqname （或 # ）</code> 对参数名的导数；可指定多于一次；</li>
<li><code>twostep</code> ：使用两步 GMM 估计；</li>
<li><code>onestep</code> ：使用一步 GMM 估计；</li>
<li><code>igmm</code> ：使用迭代 GMM 估计；</li>
<li><code>variables ( varlist )</code> ：在模型中指定变量；</li>
<li><code>nocommonesample</code> ：不要限制所有方程的估计样本都是相同的。</li>
</ul></li>
<li>Instruments 选项
<ul>
<li><code>instruments([reqlist:]varlist)[,noconstant])</code>： 是制定工具；可以被多次指定；</li>
<li><code>xtinstruments([reqlist:]varlist,lags(#_1/#_2))</code> ：是制定面板类工具变量；可以被多次指定。</li>
</ul></li>
<li>Weight matrix 选项
<ul>
<li><code>wmatrix(wmtype[,independent])</code> ：指定权重矩阵; <code>wmtype</code> 可以是<code>robust</code> ,<code>cluster</code> <code>clustvar</code> , <code>hac kernel [lags]</code> ，或者 <code>unadjusted</code>；</li>
<li><code>center</code>： 计算权重矩阵时的中心矩；</li>
<li><code>winitial(iwtype[, independent])</code>： 指定初始权重矩阵； <code>iwtype</code> 可以是<code>unadjested</code> , <code>identity</code> , <code>xt xtspec</code> ,或者 Stata 矩阵的名字。</li>
</ul></li>
<li>SE/Robust 选项
<ul>
<li><code>vce(vcetype[,independent])</code>： 其中 <code>vcetype</code> 可以是 <code>robust</code> , <code>cluster</code> <code>clustvar</code> , <code>bootstrap</code> , <code>jackknife</code> , <code>hac kernel lags</code> ,或者 <code>unadjusted</code></li>
<li><code>quickderivatives</code>：采用VCE数值导数的另一种计算方法。</li>
</ul></li>
<li>Reporting 选项
<ul>
<li><code>level(#)</code> ：设置置信水平;默认是水平( 95 ) ；</li>
<li><code>title(string)</code> ：将字符串显示为参数估计表上方的标题；</li>
<li><code>title2(string)</code> ：显示字符串作为副标题；</li>
<li><code>display_options</code> ：控制列与列格式、行间距、行宽、显示省略的变量、基单元格与空单元格，以及因子-变量标记。</li>
</ul></li>
<li>Optimization 选项
<ul>
<li><code>from(initial_values)</code> ：参数的指定初始值；</li>
<li><code>igmmiterate(#)</code> ：指定迭代 GMM 估计的最大迭代次数；</li>
<li><code>igmmeps</code> ：迭代的 GMM 参数收敛准则指定为 # ；默认为 igmmeps(1e-6)；</li>
<li><code>igmmweps( # )</code> ：迭代的 GMM 权重矩阵收敛准则指定为 # ;默认是 igmmweps (1e-6)；</li>
<li><code>optimization_options</code> ：控制优化过程；很少使用；</li>
<li><code>coeflegend</code> ：显示图例而不是统计数据。</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="动态面板数据模型fd-gmm与sys-gmm" class="section level1">
<h1>动态面板数据模型（FD-GMM与SYS-GMM）</h1>
<p>　　动态面板数据模型，是指通过在静态面板数据模型中引入滞后被解释变量以反映动态滞后效应的模型。这种模型的特殊性在于被解释变量的动态滞后项与随机误差组成部分中的个体效应相关，从而造成估计的内生性。</p>
<p>　　也就是说在动态面板模型允许使用过去的可观测值，考虑了过去结果对当前结果的影响。而实际上许多经济学问题本质上都是动态的，其中一些经济模型表明，当前的行为依赖于过去的行为，例如就业模型和公司投资问题<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>。</p>
<div id="模型基本形式" class="section level2">
<h2>模型基本形式</h2>
<div id="ar1-模型" class="section level3">
<h3>AR(1) 模型</h3>
<p><span class="math display">\[
y_{i,t}=\delta y_{i,t-1}+x&#39;_{i,t} \beta+\alpha_{i}+\varepsilon_{i,t} \tag{42}
\]</span></p>
<p><span class="math display">\[
i=1, \ldots, N \quad t=1, \ldots, T
\]</span></p>
<ul>
<li>基本设定
<ul>
<li><span class="math inline">\(y_{i,t}\)</span>是一个<span class="math inline">\(n_{i} \times 1\)</span>的向量,由时间t上的样本中每个空间单位的被解释变量的一个观测值，<span class="math inline">\(\delta\)</span>为其在时间上的滞后值<span class="math inline">\(y_{i,t-1}\)</span>的响应参数；</li>
<li><span class="math inline">\(x_{i,t}\)</span>是<span class="math inline">\(n_{i}\times k\)</span>的外生解释变量矩阵，<span class="math inline">\(\beta\)</span>为其响应参数向量；</li>
<li><span class="math inline">\(\alpha_{i}\)</span>是特定效应，且有<span class="math inline">\(\alpha_{i} \sim (0,\sigma_{\alpha}^2)\)</span>；</li>
<li><span class="math inline">\(\epsilon_{i,t}\)</span>是服从 <span class="math inline">\(i.i.d\)</span> 分布的干扰项，且有<span class="math inline">\(\epsilon_{i,t} \sim (0,\sigma_{\epsilon}^2)\)</span></li>
</ul></li>
</ul>
<p>　　这里就特定效应类型将模型分为两大类。</p>
</div>
<div id="固定效应模型fixed-effect" class="section level3">
<h3>固定效应模型(Fixed effect)</h3>
<p>　　通过消去特定效应项<span class="math inline">\(\alpha_{i}\)</span>得到
<span class="math display">\[
y_{i,t}-\overline{y}_{i}=\delta(y_{i,t-1}-\overline{y}_{i.-1})+(x_{i,t}-\overline{x}_{i})\beta+(\epsilon_{i,t}-\overline{\epsilon}_{i})\tag{43}
\]</span></p>
<p><span class="math display">\[
\overline{y}_{i,-1}=\sum_{t=2}^{T}\frac{y_{i,t-1}}{T-1}
\]</span></p>
<p>　　但是此时<span class="math inline">\((y_{i,t-1}-\overline{y}_{i.-1})\)</span>与<span class="math inline">\((\epsilon_{i,t}-\overline{\epsilon}_{i})\)</span>相关，尽管是在<span class="math inline">\(\epsilon_{i,t}\)</span>是序列不相关的的情况下。这是因为<span class="math inline">\(y_{i,-1}\)</span>与<span class="math inline">\(\overline{\epsilon}_{i}\)</span>相关，后一项的均值包含了<span class="math inline">\(\epsilon_{i,t-1}\)</span>这一项，明显与<span class="math inline">\(y_{i,t-1}\)</span>是相关的。这可以看出固定效应模型的估计是有偏的。</p>
</div>
<div id="随机效应模型random-effect" class="section level3">
<h3>随机效应模型(Random effect )</h3>
<p>　　若使用广义最小二乘法(GLS)，同理可知，<span class="math inline">\((y_{i,t-1}-\theta\overline{y}_{i.-1})\)</span>与<span class="math inline">\((\epsilon_{i,t}-\theta\overline{\epsilon}_{i})\)</span>是相关的。因此，可以看出，对于一个动态面板数据模型来说，若使用GLS估计方法，不管是固定效应模型还是随机效应模型，它的估计都是有偏且不一致连续的。且偏误<span class="math inline">\((bias)\)</span>的阶数是<span class="math inline">\(\frac{1}{T}\)</span>,仅当<span class="math inline">\(T\rightarrow \infty\)</span>时<span class="math inline">\(bias\rightarrow0\)</span>。但是当 <span class="math inline">\(T\)</span> 很小，<span class="math inline">\(N\rightarrow \infty\)</span>时可能会引起很大的偏误。</p>
<ul>
<li><p><strong>提出问题：为什么当 <span class="math inline">\(T\)</span>固定，<span class="math inline">\(N\rightarrow \infty\)</span>时会出现偏误和不一致连续的情况？</strong></p>
<ul>
<li>首先考虑没有外生向量的模型：
<span class="math display">\[
y_{i,t}=\delta y_{i,t-1}+\alpha_{i}+\epsilon_{i,t} \quad \left| \delta\right|&lt;1 \tag{44}
\]</span></li>
</ul></li>
</ul>
<p>　　假设，对于向量 <span class="math inline">\(y_{i,t}\)</span> 我们在 <span class="math inline">\(t=0,1,...,T\)</span> 时有观测值，则固定效应模型的估计量为
<span class="math display">\[
    \hat{\delta_{FE}}=\frac{\sum_{i=1}^{N}\sum_{t=1}^{T}(y_{i,t}-\bar{y_{i}})(y_{i,t-1}-\bar{y_{i,-1}})}{\sum_{i=1}^{N}\sum_{t=1}^{T}(y_{i,t-1}-\bar{y_{i,-1}})^2 }\tag{45}
    \]</span></p>
<p><span class="math display">\[
\bar{y_{i,t}}=\frac{1}{T}\sum_{t=1}^{T}y_{i,t-1}
\]</span>
<span class="math display">\[
\bar{y_{i,-1}}=\frac{1}{T}\sum_{t=1}^{T}y_{i,t-1}
\]</span></p>
<p>　　将等式(44)代入等式(45)中，可以得到估计量的特征：
<span class="math display">\[
\hat{\delta_{FE}}=\delta+\frac{\frac{1}{NT}\sum_{i=1}^{N}\sum_{t=1}^{T}(\epsilon_{i,t}-\bar{\epsilon_{i}})(y_{i,t-1}-\bar{y_{i,-1}})}{\frac{1}{NT}\sum_{i=1}^{N}\sum_{t=1}^{T}(y_{i,t-1}-\bar{y_{i,-1}})^2}\tag{46}
\]</span>
　　等式(46)中，当 <span class="math inline">\(T\)</span>固定，<span class="math inline">\(N\rightarrow \infty\)</span>的情况下，FE模型的估计值有偏且不一致。因为等式(46)右边最后一项的期望不为零，且在<span class="math inline">\(N\rightarrow \infty\)</span>的情况下不收敛到零。Nickell (1981) 和 Hsia (2003) 曾提出过：
<span class="math display">\[
plim_{n\rightarrow \infty}\frac{1}{NT}\sum_{i=1}^{N}\sum_{t=1}^{T}(\epsilon_{i,t}-\bar{\epsilon_{i}})(y_{i,t-1}-\bar{y_{i,-1}})=-\frac{\delta_{\epsilon}^2}{T^2}\times\frac{(T-1)-T_{\delta+\delta^T}}{(1-\delta)^2}\neq0 \tag{47}
\]</span>
　　因此，对于固定的 <span class="math inline">\(T\)</span>，我们有不一致的估计量，不过这与<span class="math inline">\(\alpha_{i}\)</span>无关，<span class="math inline">\(\alpha_{i}\)</span>已经在估计过程过被去掉了。这里的问题是被解释变量的动态滞后项与随机误差组成部分中的个体效应相关，如在等式(43)与(46)我们所遇到的问题，即<span class="math inline">\(y_{i,-1}\)</span>与<span class="math inline">\(\overline{\epsilon}_{i}\)</span>相关。但当<span class="math inline">\(T\rightarrow \infty\)</span>时，等式(47)收敛到零，此时当<span class="math inline">\(T\rightarrow \infty\)</span> 和<span class="math inline">\(N\rightarrow \infty\)</span>时，<span class="math inline">\(\delta_{FE}\)</span>的估计是一致的。</p>
</div>
</div>
<div id="估计方法" class="section level2">
<h2>估计方法</h2>
<div id="iv" class="section level3">
<h3>IV</h3>
<p>　　为了解决估计量不一致的问题，Anderson 和 Hsio (1981) 提出了<strong>工具变量估计(IV)</strong>。首先，我们考虑消去个体效应 <span class="math inline">\(\alpha_{i}\)</span>，对此，做差分得：
<span class="math display">\[
y_{i,t}-y_{i,t-1}=\delta(y_{i,t-1}-y_{i,t-2})+(\epsilon_{i,t}-\epsilon_{i,t-1}) \quad t=2,...,T\quad \tag{48}
\]</span></p>
<p>　　此处若使用最小二乘法(OSL)得到等式(48)的估计量是不一致的，尽管是在<span class="math inline">\(T\rightarrow \infty\)</span>的情况下，这是因为<span class="math inline">\(y_{i,t-1}\)</span>和<span class="math inline">\(\epsilon_{i,t-1}\)</span>相关。</p>
<ul>
<li>转换规范等式(48)给出一个IV估计的方法，例如，<span class="math inline">\(y_{i,t-2}\)</span>与<span class="math inline">\((y_{i,t-1}-y_{i,t-2})\)</span>相关，但与<span class="math inline">\(\epsilon_{i,t-1}\)</span>不相关，所以选取<span class="math inline">\(y_{i,t-2}\)</span>作为工具变量，给出了<span class="math inline">\(\delta\)</span>的一个IV估计：
<span class="math display">\[
\hat{y_{IV}}=\frac{\sum_{i=1}^{N}\sum_{t=2}^{T}y_{i,t-2}(y_{i,t}-y_{i,t-1})}{\sum_{i=1}^{N}\sum_{t=2}^{T}y_{i,t-2}(y_{i,t-1}-y_{i,t-2})} \tag{49}
\]</span></li>
</ul>
<p>　　对应的关于等式(49)的一致性条件为
<span class="math display">\[
plim_{N \rightarrow \infty}\frac{1}{N(T-1)}\sum_{i=1}^{N}\sum_{t=2}^{T}(\epsilon_{i,t}-\epsilon_{i,t-1})y_{i,t-2}=0 \quad \tag{50}
\]</span>
　　<span class="math inline">\(T\rightarrow \infty \ or \ N\rightarrow \infty \ or \ T\rightarrow \infty \ and \ N \rightarrow \infty\)</span>注意这里<span class="math inline">\((\epsilon_{i,t}-\epsilon_{i,t-1})\)</span>是MA(1)</p>
<p>　　Anderson 和 Hsio (1981)又给出了另一个IV估计的方案，这里选择将<span class="math inline">\((y_{i,t-2}-y_{i,t-3})\)</span>作为工具变量。
<span class="math display">\[
  \hat{y_{IV}}^{(2)}=\frac{\sum_{i=1}^{N}\sum_{t=3}^{T}(y_{i,t-2}-y_{i,t-3})(y_{i,t}-y_{i,t-1})}{\sum_{i=1}^{N}\sum_{t=3}^{T}(y_{i,t-2}-y_{i,t-3})(y_{i,t-1}-y_{i,t-2})} \tag{51}
  \]</span>
　　同理，得到等式(51)的一致性条件为:
<span class="math display">\[
  plim_{N \rightarrow \infty}\frac{1}{N(T-2)}\sum_{i=1}^{N}\sum_{t=3}^{T}(\epsilon_{i,t}-\epsilon_{i,t-1})(y_{i,t-2}-y_{i,t-3})=0 \tag{52}
  \]</span></p>
<p>　　且只要<span class="math inline">\(\epsilon_{i,t}\)</span>不是自相关的，等式(49)和(51)的一致性都得到了保障。</p>
<p>　　可以看出，等式(51)构建工具变量时比等式(49)多引入了一个滞后项，这导致缺失了一期的样本数据。这就又提出了一个问题，我们究竟是选择等式(49还是等式(51)的估计比较好？而矩估计(MM)法则不需要考虑这个问题，<font color=red >MM估计可以统一所有的估计量且消去样本容量减少的缺点。</font></p>
</div>
<div id="gmm" class="section level3">
<h3>GMM</h3>
<p>　　可得等式(49)的矩条件为:
<span class="math display">\[
plim_{N \rightarrow \infty}\frac{1}{N(T-1)}\sum_{i=1}^{N}\sum_{t=2}^{T}(\epsilon_{i,t}-\epsilon_{i,t-1})y_{i,t-2}=E[(\epsilon_{i,t}-\epsilon_{i,t-1})y_{i,t-2} ]=0 \tag{53}
\]</span>
　　同理，等式(51)的矩条件为
<span class="math display">\[
plim_{N \rightarrow \infty}\frac{1}{N(T-2)}\sum_{i=1}^{N}\sum_{t=3}^{T}(\epsilon_{i,t}-\epsilon_{i,t-1})(y_{i,t-2}-y_{i,t-3})\\=E[(\epsilon_{i,t}-\epsilon_{i,t-1})(y_{i,t-2}-y_{i,t-3})]=0 \tag{54}
\]</span>
　　这两个IV估计值都在估计中附加了一个矩条件。但是，据我们所知，附加更多的矩条件则能增加估计值的效率。</p>
<p>　　据此，Arellano 和 Bond (1991) 提出可以通过开发附加矩来扩大工具的列表并且使工具的数量随着 t 变化。首先，固定T，这里考虑 T=4。</p>
<ul>
<li><p>t = 2 时，矩条件变为：<span class="math inline">\(E[(\epsilon_{i,2}-\epsilon_{i,1})y_{i,0}]=0\)</span>
这意味着变量<span class="math inline">\(y_{i,0}\)</span>是有效的工具，因为它与<span class="math inline">\((y_{i,1}-y_{i,0})\)</span>高度相关而与<span class="math inline">\((\epsilon_{i,2}-\epsilon_{i,1})\)</span>不相关。</p></li>
<li><p>t = 3 时，同理可得，矩条件为：<span class="math inline">\(E[(\epsilon_{i,3}-\epsilon_{i,2})y_{i,1}\)</span>同时也满足<span class="math inline">\(E[(\epsilon_{i,2}-\epsilon_{i,1})y_{i,0}]=0\)</span>其中，<span class="math inline">\(y_{i,1}\)</span>与<span class="math inline">\((y_{i,2}-y_{i,1})\)</span>相关，而与<span class="math inline">\((\epsilon_{i,3}-\epsilon_{i,2})\)</span>不相关。<br />
　　</p></li>
<li><p>t = 4 时，我们将得到三组矩条件：<span class="math inline">\(E[(\epsilon_{i,2}-\epsilon_{i,1})y_{i,0}]=0\)</span>；<span class="math inline">\(E[(\epsilon_{i,3}-\epsilon_{i,2})y_{i,1}\)</span>； <span class="math inline">\(E[(\epsilon_{i,4}-\epsilon_{i, 3})y_{i,2}]=0\)</span></p></li>
</ul>
<p>　　一直继续这么添加矩条件之后，有效的工具集合变为<span class="math inline">\((y_{i0},y_{i1},y_{i2}...y_{i,T-2})\)</span>而所有的这些矩条件可以作为<strong>广义矩估计(GMM)</strong>的一个框架。对于一般的样本大小 T，所有差分后的误差项可排成一个向量：
<span class="math display">\[
\Delta \varepsilon_{i}=\left( \begin{array}{c}{\varepsilon_{i 2}-\varepsilon_{i 1}} \\ {\cdots} \\ {\varepsilon_{i, T}-\varepsilon_{i, T-1}}\end{array}\right) \tag{55}
\]</span>
　　由工具变量排成的矩阵为：
<span class="math display">\[
Z_{i} =\left( \begin{array}{ccccccc}{y_{i0}} &amp; {0} &amp; {0} &amp; {\ldots} &amp; {0} &amp; {\ldots} &amp; {0}\\ {0} &amp; {y_{i0}} &amp; {y_{i1}} &amp; {\ldots} &amp; {0} &amp; {\ldots} &amp; {0} \\ {\vdots} &amp; {\vdots} &amp; {\vdots} &amp; {\ldots} &amp; {\vdots} &amp; {\ddots} &amp; {\vdots} \\ {0} &amp; {0} &amp; {0} &amp; {\ldots} &amp; {y_{i0}} &amp; {\ldots} &amp; {y_{i, T-2}} \end{array}\right) \tag{56}
\]</span>
　　矩阵<span class="math inline">\(Z_{i}\)</span>的每一行都包含了给定时段所有有效工具。因此，所有矩条件的集合可写为：
<span class="math display">\[
E\left\{Z_{i}^{\prime} \Delta \varepsilon_{i}\right\}=0 \tag{57}
\]</span>
　　为了得到GMM估计，将等式(57)改写成
<span class="math display">\[
E\left\{Z_{i}^{\prime}\left(\Delta y_{i}-\gamma \Delta y_{i,-1}\right)\right\}=0 \tag{58}
\]</span></p>
<p>　　显然，矩条件的数量会增加未知参数的数量。 <span class="math inline">\(\gamma\)</span>这里我们通过最小化由等式(58)所对应的条件表达的二次型来估计参数<span class="math inline">\(\gamma\)</span>：
<span class="math display">\[
\min _{\gamma}\left[\frac{1}{N} \sum_{i=1}^{N} Z_{i}^{\prime}\left(\Delta y_{i}-\gamma \Delta y_{i,-1}\right)\right]^{\prime} W_{N}\left[\frac{1}{N} \sum_{i=1}^{N} Z_{i}^{\prime}\left(\Delta y_{i}-\gamma \Delta y_{i,-1}\right)\right] \tag{59}
\]</span></p>
<p>　　其中<span class="math inline">\(W_{i}\)</span>是定义的对称正定的权重矩阵。然后，通过对等式(59)关于<span class="math inline">\(\gamma\)</span>求微分并求解<span class="math inline">\(\gamma\)</span>得到GMM估计量：
<span class="math display">\[
\gamma_{G \hat{M} M}=\left(\left(\sum_{i=1}^{N} \Delta y_{i,-1}^{\prime} Z_{i}\right) W_{N}\left(\sum_{i=1}^{N} Z_{i}^{\prime} \Delta y_{i,-1}\right)\right)^{-1}\\ 
\times\left(\sum_{i=1}^{N} \Delta y_{i,-1}^{\prime} Z_{i}\right) W_{N}\left(\sum_{i=1}^{N} Z_{i}^{\prime} \Delta y_{i}\right) \tag{60}
\]</span></p>
<p>　　MM估计并不强制要求<span class="math inline">\(\varepsilon_{it}\)</span>关于个体与时间服从独立分布，但是需要注意的是，需要不存在自相关以保证矩条件有效。因此，在一个短面板（即T比较小），建议强制<span class="math inline">\(\epsilon_{it}\)</span>不存在自相关，并结合同方差性假设。 　</p>
<p>　　Alvarez 和 Arellano (2003) 表示，通常，GMM估计在<span class="math inline">\(T \rightarrow \infty , N \rightarrow \infty\)</span>的情况下仍然保持一致性。但是，对于<span class="math inline">\(T \rightarrow \infty\)</span>的情况下，GMM估计和FE估计会很接近，这给我们估计方法提供了一个更具有吸引力的选择。</p>
</div>
<div id="一阶差分gmm" class="section level3">
<h3>一阶差分GMM</h3>
<p>　　Arellano和Bond ( 1991) 提出了一阶差分GMM (FD-GMM)估计方法，主要做法是用变量的水平滞后值作为其一阶差分项的工具变量。具体来说：</p>
<p>　　由我们上文所考虑的没有外生向量的模型(44)的水平方程<span class="math inline">\(y_{i,t}=\delta y_{i,t-1}+\alpha_{i}+\varepsilon_{i,t}\)</span>，考虑它的差分方程
<span class="math display">\[
\Delta y_{it}=\delta \Delta y_{i,t-1} + \Delta \varepsilon_{it} \tag{61}
\]</span>
　　因为<span class="math inline">\(\Delta y_{i,t-1}\)</span>相关联，所以将<span class="math inline">\(y_{i,t-2}\)</span>作为<span class="math inline">\(\Delta y_{i,t-1}\)</span>的工具变量。这种估计方法就是FD-GMM。<font color=blue> 但是, Blundell和Bond (1998)曾指出,一阶差分GMM估计方法容易受到弱工具变量的影响而得到有偏的估计结果。</font>即由模型(44)的水平方程可得
<span class="math display">\[
\Delta y_{i,t-1}=(\delta-1)y_{i,t-2}+\alpha_{i}+\varepsilon_{i,t-1}\tag{62}
\]</span>
　　当<span class="math inline">\(\delta\)</span>接近1的时候，工具变量和外生变量的关系就会变的很弱，这就会产生“弱工具变量问题”。 为了克服弱工具变量的影响, Arellano和Bover (1995) 以及Blundell和Bond (1998)提出了另外一种更加有效的方法,即系统GMM (SYS-GMM)估计方法。其具体做法是将水平方程和差分方程结合起来进行估计,在这种估计方法中,<font color=blue >滞后水平作为一阶差分的工具变量,而一阶差分又作为水平变量的工具变量。</font>具体来说：在上述FD-GMM估计中，可以看作是应用了矩条件<span class="math inline">\(E(\Delta \varepsilon_{it}y_{i,t-2}=0)\)</span>，但是却有个矩条件被忽略了， 即：
<span class="math display">\[
E\left(\Delta y_{i, t-1}\left(\alpha_{i}+\varepsilon_{i t}\right)\right)=E\left(\Delta y_{i, t-1}\left(y_{i t}-\delta y_{i, t-1}\right)\right)=0\tag{63}
\]</span></p>
<p>　　 而SYS-GMM则是考虑到了这一点，利用了更多的有效信息，使得估计不受<span class="math inline">\(\delta\)</span>接近1时的影响。</p>
</div>
</div>
<div id="一些注意事项" class="section level2">
<h2>一些注意事项</h2>
<p>　　 动态面板数据模型，是指通过在静态面板数据模型中引入滞后被解释变量以反映动态滞后效应的模型。<font color=blue> 这种模型的特殊性在于被解释变量的动态滞后项与随机误差组成部分中的个体效应相关，从而造成估计的内生性。</font></p>
<p>　　也就是说在动态面板模型允许使用过去的可观测值，考虑了过去结果对当前结果的影响。而实际上许多经济学问题本质上都是动态的，其中一些经济模型表明，当前的行为依赖于过去的行为，例如<strong>就业模型</strong>和<strong>公司投资问题</strong>。</p>
<div id="模型的一些假设" class="section level3">
<h3>模型的一些假设</h3>
<ul>
<li>1、动态。模型中包含了因变量的滞后项；</li>
<li>2、有个体的固定效应；</li>
<li>3、可以有一些自变量是内生的；</li>
<li>4、除了固定效应之外的误差项<span class="math inline">\(\varepsilon_{i,t}\)</span>可以异方差，可以序列相关；</li>
<li>5、不同个体之间的误差项<span class="math inline">\(\varepsilon_{i,t}\)</span>和<span class="math inline">\(\varepsilon_{j,t}\)</span>不会相关。</li>
<li>6、可以有前定的（Predetermined）但不是完全外生的变量。</li>
<li>7、“大N，小T”，即个体数量要足够多，但时间不用太长。如果时间足够长的话，动态面板误差不会太大，用固定效应即可。</li>
</ul>
<p>　　从上述要求可以看出，GMM方法特别适合宏观的面板数据分析，因为宏观变量中，很难找出绝对外生的变量，变量之间多少会互相影响。而GMM方法可以“有一些自变量是内生的”，这可能也是GMM方法在文献中这么常用的原因。此前已经说过，不能用传统的OLS方法或者固定效应模型进行动态面板数据的分析，那样会得到有偏的估计量。先要对数据进行一定的变换，然后根据不同的矩条件设定开展矩估计。其中数据变换有两种方法，矩条件的设定也有两种方法。</p>
</div>
<div id="数据的变换方法" class="section level3">
<h3>数据的变换方法</h3>
<p>　　<strong>一阶差分还是垂直离差。</strong>为了消除动态面板数据中的固定效应，通常用的有两种方法：一阶差分(first difference)和垂直离差(orthogonal deviations)。一阶差分之前已经介绍过了，这种方法是difference GMM 中默认的方法。缺点是如果数据中有缺失值，那么最终的估计会缺失很多样本，原始数据缺一行往往会导致差分后的数据缺两行。一种替代的方案是用垂直离差（xtabond2 命令中用 orthogonal 选项实现），每个变量减去该变量未来所有观测值的平均值，即：<br />
　　
<span class="math display">\[
w_{i, t+1}^{\perp} \equiv c_{i t}\left(w_{i, t}-\frac{1}{T_{i t}} \sum_{s&gt;t} w_{i s}\right) \tag{64}
\]</span>
　　式子中（64），<span class="math inline">\(c_{i t}=\sqrt{T_{i t} /\left(T_{i t}+1\right)}\)</span>为调整权重变量， <span class="math inline">\(T_{i,t}\)</span>是从<span class="math inline">\(t\)</span>期开始以后观测值的数量。<font color=blue >对于非平衡面板，和数据有缺失的面板，这种方法避免了因缺失数据带来的样本损失，因为调整的时候只是把未来的平均值减去，样本数不会因缺失未来个别观测值而受损。然而，对于平衡面板数据，一阶差分和垂直离差估计出来的结果会完全一样。</font></p>
</div>
<div id="模型的选择" class="section level3">
<h3>模型的选择</h3>
<p>　　<strong>Different GMM还是 System GMM</strong>。令数据变换之后的回归方程变为:<br />
　　
<span class="math display">\[
Y_{i, t}^{*}=\alpha Y_{i, t-1}^{*}+\beta X_{i t}^{*}+\varepsilon_{i t}\tag{65}
\]</span>
　　这种变换可以是一阶差分，也可以是垂直离差。Different GMM的逻辑是，如果是垂直离差变换，用</p>
<p><span class="math inline">\(Y_{i, t-2}\)</span>作为 <span class="math inline">\(Y_{i, t-1}^{*}\)</span>的工具变量；如果是一阶差分变换，用<span class="math inline">\(\Delta Y_{i, t-2}\)</span>作为 <span class="math inline">\(Y_{i, t-1}^{*}\)</span>的工具变量，此时 <span class="math inline">\(Y_{i, t-1}^{*}=\Delta Y_{i, t-2}\)</span>。<span class="math inline">\(X_{i, t}^{*}\)</span>对应的工具变量也类似，如果是垂直离差，就用滞后一阶的，如果是差分就用滞后一阶的差分作为工具变量。在实现的时候，为了提高估计的有效性，通常还会加入更高阶的滞后项（滞后差分）作为工具变量。这些变量的加入利用了更多的信息，然而也会带来麻烦，让工具变量的数量随T平方成比例增加。为了控制工具变量的数量，一个选择就是采用collapse选项把这些工具变量变成一列。</p>
<p>　　如果因变量的变化过程接近随机游走，那么Difference GMM的估计量会有较大偏差。</p>
<p>　　system GMM的方法和Different GMM完全不同，它不需要对自变量和因变量进行数据变换。它假定工具变量的差分，即 <span class="math inline">\(\Delta w_{i t}=w_{i t}-w_{i, t-1}\)</span>，应该外生于固定效应： <span class="math inline">\(E\left(\Delta w_{i t}u_{i}\right)=0\)</span>。如果 <span class="math inline">\(w\)</span>是内生的，<span class="math inline">\(\Delta w_{i t-1}\)</span>就可以作为工具变量，更高阶的差分也可以做工具变量。如果<span class="math inline">\(w\)</span>是前定的但不是完全外生的， <span class="math inline">\(\Delta w_{i t}\)</span>可以作为工具变量，更高阶的差分也可以做工具变量。当然，更高阶差分加入后，还是会增加工具变量数量，需要在具体计算时想办法控制。</p>
</div>
<div id="使用gmm方法的注意事项" class="section level3">
<h3>使用GMM方法的注意事项</h3>
<p>　　可以尝试先做（2）式的OLS，再做（3）式的固定效应。当然这两个估计都是有偏误的，然而这两个估计的系数应该是真实系数的上限和下限，可以给最后的 GMM 估计限定参考范围。</p>
<p>　　大 N小T，如果N太小了，则估计出来的标准差可能不太靠谱。实际上如果用省际面板去做的话，不满足大N小T个条件，但中文文献中充斥着这样的研究。如果样本的 N较小，但还可以接受（比如 N=70），然而又想用此方法，那么加上small选项。</p>
<p>　　解释变量中，放入时间虚拟变量。比如，数据有 10 年，则放入 9 个虚拟变量。加入后，可以让误差项 <span class="math inline">\(\varepsilon_{i,t}\)</span>和<span class="math inline">\(\varepsilon_{j,t}\)</span>不会相关这个条件更容易满足。</p>
<p>　　如果数据中间有间隙，尽量利用垂直离差（对于每个变量，包括自变量和因变量， 减去它未来值的平均值，就是加上 orthogonal 选项，见 Roodman（2009）），这会减少样本量的损失。因为数据中间缺一行，一阶差分（<span class="math inline">\(w_{i,t}-w_{i,t-1}\)</span>）后就会缺两行数据。但对平衡面板数据，两种数据变换方法结果一样。</p>
<p>　　通常，每个自变量都要出现两次（除了系统外的工具变量）。先作为自变量出现在在xtabond2 命令中逗号的左边，再以某种形式作为工具变量出现在逗号右边。如果变量是完全外生的，那么放到 ivstyle(w)（表示直接作为工具变量）；如果是前定的，但不是完全外生的，则放到 gmmstyle(w)（表示从滞后一期开始都作为工具变量）;如果是内生的，则放到 gmmstyle(L.w)（表示从滞后两期开始都作为工具变量）。</p>
<p>　　报告工具变量的数量。如果按照上一条的做法，工具变量的数量会很多。这样会导致overidentification test不准确，【一个标志就是 Hansen 统计量的 p 值变为 1，Hansen test的 p 值在（0.1,0.25）之外都要小心，太小表明拒绝工具变量有效的假设，太大表明选的工具变量太多，hansen检验变弱了】。通常，需要限制工具变量数量，可以用collapse选项，也可以用 laglimits()选项。习惯做法是，选择不同数量的工具变量以显示估计系数的稳健性。工具变量数量的上限就是模型中个体的数量（也就是 N），超出此上限，xtabond2 命令会报警。</p>
<p>　　使用 system GMM 的时候要注意，能使用该模型的前提是，工具变量的变化<span class="math inline">\(w_{i,t}-w_{i,t-1}\)</span>要和固定效应垂直。因此数据应该在稳态附近，否则这些变量的变化就会和固定效应关系比较大，从而不满足 system GMM 适用的条件。</p>
<p>　　由于 GMM 方法有很多设定选项，在报告结果时，报告你的选项。System GMM 还是Difference GMM；是用垂直离差还是一阶差分；选用什么工具变量，滞后几期；选择什么样的 robust 标准差，等等。</p>
<p>　</p>
</div>
</div>
<div id="gmm在动态面板估计中的案例" class="section level2">
<h2>GMM在动态面板估计中的案例</h2>
<p>　　动态面板GMM常用的Stata命令：</p>
<ul>
<li><p><code>xtabond</code>命令实现了 Arellano 和 Bond Roodman在1991年所提出的一阶差分矩估计法（FD-GMM），此时它的矩条件是将因变量的滞后和外生变量的一阶差分作为一阶差分方程的工具。</p></li>
<li><p><code>xtdpdsys</code>实现了Arellano、Bover/Blundell 和 Bond在1998年提出的系统 GMM 估计（SYS-GMM） ，它使用了<code>xtabond</code>的矩条件，同时又将因变量滞后第一差分作为水平方程的工具。</p></li>
<li><p><code>xtdpd</code>则是一种更加灵活的替代方法，它可以用比<code>xtabond</code>和<code>xtdpdsys</code>更复杂的结构来拟合在特殊误差和预定变量中具有低阶移动平均关联的模型。</p></li>
<li><p><code>estat bond</code>允许您在一阶差分残差中测试序列相关性，并测试过度识别限。</p></li>
<li><p><code>estat overid</code>允许您在估计后进行过度识别检验。</p></li>
</ul>
<div id="fd-gmm" class="section level3">
<h3>FD-GMM</h3>
<blockquote>
<p>　　例子：<br />
　　基于Layard和Nickell(1986)的工作，Arellano和Bond(1991)将劳动力需求的动态模型拟合到位于英国的一个具有不平衡面板的公司上。首先，我们根据 工资(wages)、资本存量(capital stock)、行业产出(industry output)、年度虚拟变量(year dummies) 以及 一个时间趋势(a time trend )对就业率(employment) 进行建模，其中包括就业，工资和资本存量的滞后。我们将使用xtabond命令</p>
</blockquote>
<ul>
<li>我们可以使用<code>xtabond</code>命令来实现FD-GMM估计，这里我们使用数据<code>abdata</code></li>
</ul>
<pre class="stata"><code>use E:\Mirror\StataLearn\StataData\abdata.dta
xtabond n L(0/2).(w k) yr1980-yr1984 year, vce(robust)</code></pre>
<pre><code>## 
## 
## . use E:\Mirror\StataLearn\StataData\abdata.. xtabond n L(0/2).(w k) yr1980-yr1984 year, vce(robust)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     40                  Wald chi2(13)     =    1318.68
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |               Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6286618   .1161942     5.41   0.000     .4009254    .8563983
##              |
##            w |
##          --. |  -.5104249   .1904292    -2.68   0.007    -.8836592   -.1371906
##          L1. |   .2891446    .140946     2.05   0.040     .0128954    .5653937
##          L2. |  -.0443653   .0768135    -0.58   0.564     -.194917    .1061865
##              |
##            k |
##          --. |   .3556923   .0603274     5.90   0.000     .2374528    .4739318
##          L1. |  -.0457102   .0699732    -0.65   0.514    -.1828552    .0914348
##          L2. |  -.0619721   .0328589    -1.89   0.059    -.1263743    .0024301
##              |
##       yr1980 |  -.0282422   .0166363    -1.70   0.090    -.0608488    .0043643
##       yr1981 |  -.0694052    .028961    -2.40   0.017    -.1261677   -.0126426
##       yr1982 |  -.0523678   .0423433    -1.24   0.216    -.1353591    .0306235
##       yr1983 |  -.0256599   .0533747    -0.48   0.631    -.1302723    .0789525
##       yr1984 |  -.0093229   .0696241    -0.13   0.893    -.1457837    .1271379
##         year |   .0019575   .0119481     0.16   0.870    -.0214604    .0253754
##        _cons |  -2.543221   23.97919    -0.11   0.916    -49.54158    44.45514
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w L2D.w D.k LD.k L2D.k D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984 D.year
## Instruments for level equation
##         Standard: _cons</code></pre>
<p>　　 <code>GMM</code>命令与<code>xtabond</code>命令的比较。</p>
<pre class="stata"><code>use E:\Mirror\StataLearn\StataData\abdata.dta,clear
xtabond n L(0/1).w L(0/1).k, lags(1) noconstant vce(robust)
</code></pre>
<pre><code>## 
## 
## . use E:\Mirror\StataLearn\StataData\abdata.dta,cl. xtabond n L(0/1).w L(0/1).k, lags(1) noconstant vce(robust)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     32                  Wald chi2(5)      =     658.83
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |               Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .8041712   .1199819     6.70   0.000     .5690111    1.039331
##              |
##            w |
##          --. |  -.5600476   .1619472    -3.46   0.001    -.8774583    -.242637
##          L1. |   .3946699   .1092229     3.61   0.000     .1805969    .6087429
##              |
##            k |
##          --. |   .3520286   .0536546     6.56   0.000     .2468676    .4571897
##          L1. |  -.2160435   .0679689    -3.18   0.001    -.3492601   -.0828269
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k
## 
## .</code></pre>
<p>　　 也可以用GMM 的形式估计动态面板，表示为：
　　</p>
<pre class="stata"><code>use E:\Mirror\StataLearn\StataData\abdata.dta,clear
gmm (D.n - {rho}*LD.n - {xb:D.w LD.w D.k LD.k}),  ///
   xtinstruments(n, lags(2/.)) ///
   instruments(D.w LD.w D.k LD.k, noconstant) ///
   deriv(/rho = -1*LD.n) deriv(/xb = -1) winitial(xt D) onestep</code></pre>
<pre><code>## 
## 
## . use E:\Mirror\StataLearn\StataData\abdata.dta,cl. gmm (D.n - {rho}*LD.n - {xb:D.w LD.w D.k LD.k}),  ///
## &gt;    xtinstruments(n, lags(2/.)) ///
## &gt;    instruments(D.w LD.w D.k LD.k, noconstant) ///
## &gt;    deriv(/rho = -1*LD.n) deriv(/xb = -1) winitial(xt D) onestep
## 
## Step 1
## Iteration 0:   GMM criterion Q(b) =   .0011455  
## Iteration 1:   GMM criterion Q(b) =  .00009103  
## Iteration 2:   GMM criterion Q(b) =  .00009103  
## 
## GMM estimation 
## 
## Number of parameters =   5
## Number of moments    =  32
## Initial weight matrix: XT D                       Number of obs   =        751
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |               Robust
##              |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
## rho          |
##        _cons |   .8041712   .1199819     6.70   0.000     .5690111    1.039331
## -------------+----------------------------------------------------------------
## xb           |
##            w |
##          D1. |  -.5600476   .1619472    -3.46   0.001    -.8774583    -.242637
##          LD. |   .3946699   .1092229     3.61   0.000     .1805969    .6087429
##              |
##            k |
##          D1. |   .3520286   .0536546     6.56   0.000     .2468676    .4571897
##          LD. |  -.2160435   .0679689    -3.18   0.001    -.3492601   -.0828269
## ------------------------------------------------------------------------------
## Instruments for equation 1:
##         XT-style: L(2/.).n
##         Standard: D.w LD.w D.k LD.k</code></pre>
<p>　　由于我们的回归模型中包含一个n的滞后，<code>xtabond</code>使用滞后2期和back作为工具。外生变量的差分也可以作为工具。接下来，我们使用<code>xtdpdsys</code>来重新定义模型。 　　　</p>
</div>
<div id="sys-gmm" class="section level3">
<h3>SYS-GMM</h3>
<ul>
<li>下面用<code>xtdpdsys</code>命令来实现SYS-GMM估计</li>
</ul>
<pre class="stata"><code>use E:\Mirror\StataLearn\StataData\abdata.dta,clear
xtdpdsys n L(0/2).(w k) yr1980-yr1984 year, vce(robust)</code></pre>
<pre><code>## 
## 
## . use E:\Mirror\StataLearn\StataData\abdata.dta,cl. xtdpdsys n L(0/2).(w k) yr1980-yr1984 year, vce(robust)
## 
## System dynamic panel-data estimation            Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     47                  Wald chi2(13)     =    2579.96
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
## ------------------------------------------------------------------------------
##              |               Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .8221535    .093387     8.80   0.000     .6391184    1.005189
##              |
##            w |
##          --. |  -.5427935   .1881721    -2.88   0.004     -.911604   -.1739831
##          L1. |   .3703602   .1656364     2.24   0.025     .0457189    .6950015
##          L2. |  -.0726314   .0907148    -0.80   0.423    -.2504292    .1051664
##              |
##            k |
##          --. |   .3638069   .0657524     5.53   0.000     .2349346    .4926792
##          L1. |  -.1222996   .0701521    -1.74   0.081    -.2597951     .015196
##          L2. |  -.0901355   .0344142    -2.62   0.009    -.1575862   -.0226849
##              |
##       yr1980 |  -.0308622    .016946    -1.82   0.069    -.0640757    .0023512
##       yr1981 |  -.0718417   .0293223    -2.45   0.014    -.1293123    -.014371
##       yr1982 |  -.0384806   .0373631    -1.03   0.303    -.1117111    .0347498
##       yr1983 |  -.0121768   .0498519    -0.24   0.807    -.1098847    .0855311
##       yr1984 |  -.0050903   .0655011    -0.08   0.938    -.1334701    .1232895
##         year |   .0058631   .0119867     0.49   0.625    -.0176304    .0293566
##        _cons |  -10.59198   23.92087    -0.44   0.658    -57.47602    36.29207
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w L2D.w D.k LD.k L2D.k D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984 D.year
## Instruments for level equation
##         GMM-type: LD.n
##         Standard: _cons</code></pre>
<p>　　 比较这两个命令输出的页脚说明了这两个估计器之间的关键区别。<code>xtdpdsys</code>将n的滞后差也作为工具纳入水平方程，而<code>xtabond</code>没有。<code>xtdpdsys</code>的工具变量变多了，但是模型的标准误降低了。　　　　</p>
<p>　　 这些GMM估计量的矩条件只有在特征误差不存在序列相关性的情况下才有效。由于白噪声的第一个差异必然是自相关的，我们只需要关注第二个和更高的自相关。我们可以使用<code>estat abond</code>测试自相关:　　　</p>
<blockquote>
<p><code>xtdpd</code>则是一种更加灵活的替代方法，它可以用比<code>xtabond</code>和<code>xtdpdsys</code>更复杂的结构来拟合在特殊误差和预定变量中具有低阶移动平均关联的模型。</p>
</blockquote>
</div>
<div id="假设检验" class="section level3">
<h3>假设检验</h3>
<div id="序列相关检验" class="section level4">
<h4>序列相关检验</h4>
<p>　　 可以看出 Arellano–Bond估计工具变量的设定的关键点在于
<span class="math display">\[
E\left(\Delta y_{i(t-j)} \Delta \varepsilon_{i t}\right)=0 \quad j \geq 2\tag{66}
\]</span><br />
　　 我们可以在 Stata 中使用<code>estat abond</code>命令来测试这些条件。
　　 从本质上来说，一般未观测到的的差分项<span class="math inline">\(\Delta y_{it}\)</span>应与其因变量的第二期滞后<span class="math inline">\(y_{i,t-2}\)</span>和之后的滞后项都无关。如果不是这样，我们又回到了一开始的问题，内生性。所以我们主要关心的是有没有2阶或者更高阶的序列相关性。
　　 下面我们用<code>estat bond</code>命令来测试我们上述的例子：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta,clear
qui xtdpdsys n L(0/2).(w k) yr1980-yr1984 year, vce(robust)
*序列相关检验
estat abond, artests(4)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta,clear
## 
## . qui xtdpdsys n L(0/2).(w k) yr1980-yr1984 year, vce(robust)
## 
## . *序列相关检验
## . estat abond, artests(4)
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     47                  Wald chi2(13)     =    2579.96
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |               Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .8221535    .093387     8.80   0.000     .6391184    1.005189
##              |
##            w |
##          --. |  -.5427935   .1881721    -2.88   0.004     -.911604   -.1739831
##          L1. |   .3703602   .1656364     2.24   0.025     .0457189    .6950015
##          L2. |  -.0726314   .0907148    -0.80   0.423    -.2504292    .1051664
##              |
##            k |
##          --. |   .3638069   .0657524     5.53   0.000     .2349346    .4926792
##          L1. |  -.1222996   .0701521    -1.74   0.081    -.2597951     .015196
##          L2. |  -.0901355   .0344142    -2.62   0.009    -.1575862   -.0226849
##              |
##       yr1980 |  -.0308622    .016946    -1.82   0.069    -.0640757    .0023512
##       yr1981 |  -.0718417   .0293223    -2.45   0.014    -.1293123    -.014371
##       yr1982 |  -.0384806   .0373631    -1.03   0.303    -.1117111    .0347498
##       yr1983 |  -.0121768   .0498519    -0.24   0.807    -.1098847    .0855311
##       yr1984 |  -.0050903   .0655011    -0.08   0.938    -.1334701    .1232895
##         year |   .0058631   .0119867     0.49   0.625    -.0176304    .0293566
##        _cons |  -10.59198   23.92087    -0.44   0.658    -57.47602    36.29207
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w L2D.w D.k LD.k L2D.k D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984 D.year
## Instruments for level equation
##         GMM-type: LD.n
##         Standard: _cons
## 
## Arellano-Bond test for zero autocorrelation in first-differenced errors
##   +-----------------------+
##   |Order |  z     Prob &gt; z|
##   |------+----------------|
##   |   1  |-4.6414  0.0000 |
##   |   2  |-1.0572  0.2904 |
##   |   3  |-.19492  0.8455 |
##   |   4  | .04472  0.9643 |
##   +-----------------------+
##    H0: no autocorrelation</code></pre>
<p>　　可以看到的是，我们可以拒绝一阶序列相关的原假设，但是不能拒绝2、3、4阶序列相关的原假设。所以原模型是合理的。</p>
</div>
<div id="过度识别检验estat-overid" class="section level4">
<h4>过度识别检验（estat overid）</h4>
<p>　　检验工具变量是否是与干扰项相关，也就是工具变量是否为外生变量。
　　</p>
<p>　　原假设是：所有工具变量都是外生。其中包含 <code>hansen</code> 检验和<code>sargan</code> 检验，可以用 Stata 中的<code>xtabond2</code>命令实现。</p>
</div>
</div>
</div>
</div>
<div id="关于动态面板模型估计的-stata-命令" class="section level1">
<h1>关于动态面板模型估计的 Stata 命令</h1>
<div id="stata实操陷阱动态面板数据模型" class="section level2">
<h2>Stata实操陷阱：动态面板数据模型</h2>
<div id="问题背景" class="section level3">
<h3>问题背景</h3>
<p>　　关于动态面板数据模型 (dynamic panel data，DPD)，我们常常会遇到如下问题<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>：</p>
<ul>
<li>如何在一阶差分 GMM 和系统 GMM 间选择；<br />
</li>
<li>该用 Stata 哪个命令对模型进行估计；<br />
</li>
<li>当解释变量中含有内生变量时，应该如何对模型进行估计；<br />
</li>
<li>干扰项序列相关检验无法通过怎么办；<br />
</li>
<li>过度识别检验无法通过怎么办；<br />
</li>
<li>大 T 小 N 型面板能否用 GMM 进行估计。</li>
</ul>
<p>　　接下来，本文将对上述问题提出对应的解决方案。</p>
</div>
<div id="fd-gmm-还是-sys-gmm" class="section level3">
<h3>FD-GMM 还是 SYS-GMM</h3>
<p>　　需要强调的是，无论一阶差分GMM (FD-GMM)还是系统 GMM (SYS-GMM)，模型设定是不受影响的，并且二者仅在计量估计方法上不一样，即矩条件不同。SYS-GMM 使用的矩条件多，利用的信息也多，估计也更有效率，但其受到的限制也多，如假定被解释变量的一阶差分项与个体效应变量不相关。更多细节参考IV-GMM<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>。</p>
<p>　　<strong>那么，在估计模型时该选择哪种估计方法呢？</strong></p>
<p>　　Bond (2002) 认为当被解释变量的一阶滞后项系数 不是很大时，如 ，FD-GMM 估计结果较好，而当 时，SYS-GMM 较好。</p>
<p>　　此外，若对性别、户口、行业等不随时间变化变量感兴趣，则必须使用 SYS-GMM 估计。</p>
</div>
<div id="关于动态面板模型估计的-stata-命令-1" class="section level3">
<h3>关于动态面板模型估计的 Stata 命令</h3>
<p>　　动态面板数据模型的估计主要有4个 Stata 命令，其中官方命令为 <code>xtabond</code>、<code>xtdpdsys</code>、<code>xtdpd</code>，非官方命令为 <code>xtabond2</code>，具体如下：</p>
<ul>
<li><code>xtabond</code> 用于 FD-GMM 估计；</li>
<li><code>xtdpdsys</code> 用于 SYS-GMM 估计；</li>
<li><code>xtdpd</code> 用于 FD-GMM 和 SYS-GMM 估计；</li>
<li><code>xtabond2</code> 用于 FD-GMM 和 SYS-GMM 估计。</li>
</ul>
<p>　　其中，<code>xtabond2</code> 可以提供由异方差调整后的 Hansen 统计量。</p>
<div id="动态面板模型案例" class="section level4">
<h4>动态面板模型案例</h4>
<p>　　接下来，我们将使用 Arellano and Bond (1991)在研究企业雇佣员工数量的影响因素时的数据 <code>abdata.dta</code>，来说明 GMM 相关命令的应用。其中，模型设定如下：</p>
<p><span class="math display">\[
n_{i t}=\alpha_{1} n_{i(t-1)}+\alpha_{2} n_{i(t-2)}+\beta^{\prime}(L) x_{i t}+\lambda_{t} \dashv \eta_{i}+v_{i t}  \tag{67}
\]</span></p>
<ul>
<li><p><span class="math inline">\(n_{i t}\)</span>企业<span class="math inline">\(i\)</span>在第<span class="math inline">\(t\)</span>年末雇佣员工数量的对数值；</p></li>
<li><p><span class="math inline">\(n_{i t-1}\)</span>企业<span class="math inline">\(i\)</span>在第<span class="math inline">\(t-1\)</span>年末雇佣员工数量的对数值；</p></li>
<li><p><span class="math inline">\((L) x_{i t}\)</span>表示解释变量<span class="math inline">\(x\)</span>及其滞后项，具体包括：</p>
<ul>
<li><span class="math inline">\(w_{i t}\)</span>和<span class="math inline">\(w_{i t-1}\)</span> (即企业<span class="math inline">\(i\)</span>在第<span class="math inline">\(t\)</span>和<span class="math inline">\(t-1\)</span>年实际工资的对数)；</li>
<li><span class="math inline">\(k_{i t}\)</span>、<span class="math inline">\(k_{i t-1}\)</span>和<span class="math inline">\(k_{i t-2}\)</span>(即企业<span class="math inline">\(i\)</span>在第<span class="math inline">\(t\)</span>、<span class="math inline">\(t-1\)</span>和<span class="math inline">\(t-2\)</span> 年资本存量的对数)；</li>
<li><span class="math inline">\(ys_{i t}\)</span>、<span class="math inline">\(ys_{i t-1}\)</span>和<span class="math inline">\(ys_{i t-2}\)</span>(即企业<span class="math inline">\(i\)</span>在第<span class="math inline">\(t\)</span>、<span class="math inline">\(t-1\)</span>和<span class="math inline">\(t-2\)</span> 年总产出的对数)；</li>
</ul></li>
<li><p><span class="math inline">\(\lambda{t}\)</span>为年份虚拟变量，其含义为总需求每年受到的外部冲击，也可表示为<code>i.yr1979-yr1984</code>。</p></li>
</ul>
</div>
<div id="fd-gmm-的实现" class="section level4">
<h4>FD-GMM 的实现</h4>
<div id="采用xtabond命令进行fd-gmm估计" class="section level5">
<h5>采用xtabond命令进行FD-GMM估计</h5>
<p>　　<code>xtabond</code> 命令语法格式:</p>
<pre><code>xtabond depvar [indepvars] [if] [in] [,options]</code></pre>
<p>　　主要选项的含义为：</p>
<ul>
<li><code>depvar</code>：被解释变量；<br />
</li>
<li><code>indepvars</code>：严格外生的解释变量；<br />
</li>
<li><code>noconstant</code>：无常数项；<br />
</li>
<li><code>lags(p)</code>：表示使用被解释变量 p 阶滞后值作为解释变量，默认一阶滞后 <code>lags(1)</code>；<br />
</li>
<li><code>maxldep(q)</code>：表示最多使用 q阶被解释变量的滞后值作为工具变量，默认使用所有可能的滞后值；<br />
</li>
<li><code>endogenous()</code>：内生解释变量，可使用多次；<br />
</li>
<li><code>twostep</code>：两阶段估计，可修正 Sargan 统计量；<br />
</li>
<li><code>inst()</code>：其他的工具变量 (除解释变量滞后项以外)；<br />
</li>
<li><code>vce()</code>：默认为 <code>vce(gmm)</code>，计算得到普通 GMM 标准误，<code>vce(robust)</code> 为异方差稳健稳健标准误。</li>
</ul>
<p>　　<code>xtabond</code> 估计命令：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
*数据下载地址
*https://gitee.com/arlionn/data/blob/master/data01/abdata.dta
*use abdata, clear   // 调用数据
*-or
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984,  ///
      lags(2) twostep vce(robust)   // L(0/1).w 表示 w 的当期值与一阶滞后</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. *数据下载地址
## . *https://gitee.com/arlionn/data/blob/master/data01/abdata.dta
## . *use abdata, clear   // 调用数据
## . *-or
## . use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984,  ///
## &gt;           lags(2) twostep vce(robust)   // L(0/1).w 表示 w 的当期值与一阶滞后
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     41                  Wald chi2(15)     =    1132.45
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
##        _cons |   .4939961   .6695478     0.74   0.461    -.8182935    1.806286
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons</code></pre>
</div>
<div id="采用xtdpd命令进行fd-gmm估计" class="section level5">
<h5>采用xtdpd命令进行FD-GMM估计</h5>
<p>　　<code>xtdpd</code> 命令语法格式:</p>
<pre><code> xtdpd depvar [indepvars] [if] [in] , dgmmiv(varlist [...]) [options]</code></pre>
<p>　　主要选项的含义为：</p>
<ul>
<li><code>dgmmiv(varlist [, lagrange(flag [llag])])</code>：指定内生的被解释变量或者内生解释变量，以及其滞后项作为差分方程的 GMM 式工具变量，默认 <code>flag</code> 为 2，比如 <code>dgmmiv(y , lagrange(2 4))</code> 将变量的 <strong>y</strong> 的 2-4 阶滞后项作为工具变量，<code>dgmmiv(y)</code> 将变量的 <strong>y</strong> 的 2-n 阶滞后项作为工具变量；<br />
</li>
<li><code>lgmmiv(varlist [, lag(#)])</code>：将被解释变量或者内生解释变量的一阶差分的 # 阶滞后作为水平方程的 GMM 型工具变量，默认阶数为 1；<br />
</li>
<li><code>iv(varlist [, nodifference])</code>：指定外生变量的一阶差分项作为差分方程的标准型的工具变量，加上 <code>nodifference</code> 后作为水平方程的标准型的工具变量；<br />
</li>
<li><code>div(varlist)</code>：为差分方程设定额外的标准型工具变量；<br />
</li>
<li><code>liv(varlist)</code>：为水平方程设定额外的标准型工具变量；<br />
</li>
<li><code>twostep</code> 和 <code>vce()</code> 含义与 <code>xtabond</code> 命令相同。</li>
</ul>
<p>　　<code>xtdpd</code> 估计命令：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtdpd n l(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
      dgmmiv(n) div(L(0/1).w L(0/2).(k ys)) ///
      div(yr1980-yr1984) twostep vce(robust)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtdpd n l(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
## &gt;       dgmmiv(n) div(L(0/1).w L(0/2).(k ys)) ///
## &gt;       div(yr1980-yr1984) twostep vce(robust)
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     41                  Wald chi2(15)     =    1132.45
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
##        _cons |   .4939961   .6695478     0.74   0.461    -.8182935    1.806286
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons</code></pre>
</div>
<div id="采用xtabond2命令进行fd-gmm估计" class="section level5">
<h5>采用xtabond2命令进行FD-GMM估计</h5>
<p>　　<code>xtabond2</code> 命令语法格式：</p>
<pre><code>xtabond2 depvar varlist [if] [in]  ///
   [, gmm(varlist [, laglimits(a b) collapse)])  ///
      iv(varlist [, equation()])   ///
      nolevel nocons twostep robust
   ]</code></pre>
<p>　　主要选项的含义为：　　　</p>
<ul>
<li><code>gmm()</code>：指定内生的被解释变量或者内生解释变量，以及其滞后项作为 GMM 式工具变量，<code>laglimits(a b)</code> 限定工具变量滞后的阶数，默认为1到n，<code>collapse</code> 系统自动删减工具变量地个数；　　　</li>
<li><code>iv(varlist [, equation()])</code>：指定 IV 式工具变量，<code>equation({diff | level | both})</code> 对差分方程和水平方程进行选择；　　</li>
<li><code>nolevel</code>：表示不估计水平方程，进行FD-GMM 估计，默认为SYS-GMM估计；</li>
<li><code>robust</code>：异方差稳健标准误。　　</li>
</ul>
<p>　　<code>xtabond2</code> 估计命令：　　　</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
*ssc install xtabond2, replace // xtabond2 是外部命令需要下载
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys)  yr1980-yr1984,      ///
         gmm(l.n) iv(l(0/1).w l(0/2).(k ys))  ///
         iv(yr1980-yr1984) ///
         nolevel twostep robust</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. *ssc install xtabond2, replace // xtabond2 是外部命令需要下载
## . use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys)  yr1980-yr1984,      ///
## &gt;          gmm(l.n) iv(l(0/1).w l(0/2).(k ys))  ///
## &gt;          iv(yr1980-yr1984) ///
## &gt;          nolevel twostep robust
## Favoring space over speed. To switch, type or click on mata: mata set matafavor
## &gt;  speed, perm.
## Warning: Two-step estimated covariance matrix of moments is singular.
##   Using a generalized inverse to calculate optimal weighting matrix for two-ste
## &gt; p estimation.
##   Difference-in-Sargan/Hansen statistics may be negative.
## 
## Dynamic panel-data estimation, two-step difference GMM
## ------------------------------------------------------------------------------
## Group variable: id                              Number of obs      =       611
## Time variable : year                            Number of groups   =       140
## Number of instruments = 40                      Obs per group: min =         4
## Wald chi2(0)  =         .                                      avg =      4.36
## Prob &gt; chi2   =         .                                      max =         6
## ------------------------------------------------------------------------------
##              |              Corrected
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
## ------------------------------------------------------------------------------
## Instruments for first differences equation
##   Standard
##     D.(yr1980 yr1981 yr1982 yr1983 yr1984)
##     D.(w L.w k L.k L2.k ys L.ys L2.ys)
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     L(1/8).L.n
## ------------------------------------------------------------------------------
## Arellano-Bond test for AR(1) in first differences: z =  -2.18  Pr &gt; z =  0.029
## Arellano-Bond test for AR(2) in first differences: z =  -0.30  Pr &gt; z =  0.762
## ------------------------------------------------------------------------------
## Sargan test of overid. restrictions: chi2(25)   =  62.91  Prob &gt; chi2 =  0.000
##   (Not robust, but not weakened by many instruments.)
## Hansen test of overid. restrictions: chi2(25)   =  29.34  Prob &gt; chi2 =  0.250
##   (Robust, but weakened by many instruments.)
## 
## Difference-in-Hansen tests of exogeneity of instrument subsets:
##   iv(w L.w k L.k L2.k ys L.ys L2.ys)
##     Hansen test excluding group:     chi2(17)   =  18.31  Prob &gt; chi2 =  0.370
##     Difference (null H = exogenous): chi2(8)    =  11.04  Prob &gt; chi2 =  0.200
##   iv(yr1980 yr1981 yr1982 yr1983 yr1984)
##     Hansen test excluding group:     chi2(20)   =  25.47  Prob &gt; chi2 =  0.184
##     Difference (null H = exogenous): chi2(5)    =   3.87  Prob &gt; chi2 =  0.568</code></pre>
</div>
</div>
<div id="sys-gmm的实现" class="section level4">
<h4>SYS-GMM的实现</h4>
<div id="采用xtdpdsys命令进行sys-gmm估计" class="section level5">
<h5>采用xtdpdsys命令进行SYS-GMM估计</h5>
<p>　　<code>xtdpdsys</code> 命令语法格式：</p>
<pre><code>xtdpdsys depvar [indepvars] [if] [in] [,options]</code></pre>
<p>　　主要选项的含义为：</p>
<ul>
<li><code>noconstant</code>：无常数项；<br />
</li>
<li><code>lags(p)</code>：表示使用被解释变量 p 阶滞后值作为解释变量，默认一阶滞后；<br />
</li>
<li><code>maxldep(q)</code>：表示最多使用 q 阶被解释变量的滞后值作为工具变量,，默认使用所有可能的滞后值；<br />
</li>
<li><code>pre()</code>：指定前定变量；<br />
</li>
<li><code>endogenous ()</code>：指定内生解释变量，可使用多次；<br />
</li>
<li><code>twostep</code> 和 <code>vce()</code>：与 <code>xtabond</code> 命令相同。</li>
</ul>
<p>　　<code>xtdpdsys</code> 估计命令：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtdpdsys n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
         lags(2) twostep vce(robust)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtdpdsys n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
## &gt;          lags(2) twostep vce(robust)
## 
## System dynamic panel-data estimation            Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     48                  Wald chi2(15)     =    1449.65
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .9767449   .1418081     6.89   0.000     .6988061    1.254684
##          L2. |  -.0836652   .0419231    -2.00   0.046     -.165833   -.0014975
##              |
##            w |
##          --. |  -.5631217    .151118    -3.73   0.000    -.8593075   -.2669358
##          L1. |   .5673231   .2123546     2.67   0.008     .1511158    .9835304
##              |
##            k |
##          --. |   .2849277   .0668521     4.26   0.000     .1539001    .4159554
##          L1. |  -.0876075   .0871276    -1.01   0.315    -.2583744    .0831595
##          L2. |  -.0961451   .0433443    -2.22   0.027    -.1810984   -.0111919
##              |
##           ys |
##          --. |   .6138593   .1781104     3.45   0.001     .2647694    .9629491
##          L1. |   -.765499   .2470081    -3.10   0.002    -1.249626   -.2813719
##          L2. |   .1140538   .1725595     0.66   0.509    -.2241566    .4522641
##              |
##       yr1980 |    .009473   .0168233     0.56   0.573    -.0235001    .0424461
##       yr1981 |  -.0248051   .0296342    -0.84   0.403    -.0828871    .0332768
##       yr1982 |  -.0303709   .0327228    -0.93   0.353    -.0945064    .0337646
##       yr1983 |  -.0097145   .0363711    -0.27   0.789    -.0810005    .0615715
##       yr1984 |  -.0214451   .0348021    -0.62   0.538     -.089656    .0467658
##        _cons |   .3246957   .6640236     0.49   0.625    -.9767666    1.626158
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n
##         Standard: _cons</code></pre>
</div>
<div id="采用xtdpd命令进行sys-gmm估计" class="section level5">
<h5>采用xtdpd命令进行SYS-GMM估计</h5>
<p>　　<code>xtdpd</code> 估计命令：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtdpd n L(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
      dgmmiv(n) lgmmiv(n) div(L(0/1).w L(0/2).(k ys))       ///
      div(yr1980-yr1984) twostep vce(robust)
est store Sysxtdpd</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtdpd n L(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
## &gt;       dgmmiv(n) lgmmiv(n) div(L(0/1).w L(0/2).(k ys))       ///
## &gt;       div(yr1980-yr1984) twostep vce(robust)
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     48                  Wald chi2(15)     =    1449.65
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .9767449   .1418081     6.89   0.000     .6988061    1.254684
##          L2. |  -.0836652   .0419231    -2.00   0.046     -.165833   -.0014975
##              |
##            w |
##          --. |  -.5631217    .151118    -3.73   0.000    -.8593075   -.2669358
##          L1. |   .5673231   .2123546     2.67   0.008     .1511158    .9835304
##              |
##            k |
##          --. |   .2849277   .0668521     4.26   0.000     .1539001    .4159554
##          L1. |  -.0876075   .0871276    -1.01   0.315    -.2583744    .0831595
##          L2. |  -.0961451   .0433443    -2.22   0.027    -.1810984   -.0111919
##              |
##           ys |
##          --. |   .6138593   .1781104     3.45   0.001     .2647694    .9629491
##          L1. |   -.765499   .2470081    -3.10   0.002    -1.249626   -.2813719
##          L2. |   .1140538   .1725595     0.66   0.509    -.2241566    .4522641
##              |
##       yr1980 |    .009473   .0168233     0.56   0.573    -.0235001    .0424461
##       yr1981 |  -.0248051   .0296342    -0.84   0.403    -.0828871    .0332768
##       yr1982 |  -.0303709   .0327228    -0.93   0.353    -.0945064    .0337646
##       yr1983 |  -.0097145   .0363711    -0.27   0.789    -.0810005    .0615715
##       yr1984 |  -.0214451   .0348021    -0.62   0.538     -.089656    .0467658
##        _cons |   .3246957   .6640236     0.49   0.625    -.9767666    1.626158
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n
##         Standard: _cons
## 
## . est store Sysxtdpd</code></pre>
</div>
<div id="采用xtabond2命令进行sys-gmm估计" class="section level5">
<h5>采用xtabond2命令进行SYS-GMM估计</h5>
<p>　　<code>xtabond2</code> 估计命令：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys) yr1980-yr1984, ///
         gmm(l.n) iv(l(0/1).w l(0/2).(k ys), eq(diff))     ///
         iv(yr1980-yr1984,eq(diff)) twostep robust</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys) yr1980-yr1984, ///
## &gt;          gmm(l.n) iv(l(0/1).w l(0/2).(k ys), eq(diff))     ///
## &gt;          iv(yr1980-yr1984,eq(diff)) twostep robust
## Favoring space over speed. To switch, type or click on mata: mata set matafavor
## &gt;  speed, perm.
## Warning: Two-step estimated covariance matrix of moments is singular.
##   Using a generalized inverse to calculate optimal weighting matrix for two-ste
## &gt; p estimation.
##   Difference-in-Sargan/Hansen statistics may be negative.
## 
## Dynamic panel-data estimation, two-step system GMM
## ------------------------------------------------------------------------------
## Group variable: id                              Number of obs      =       751
## Time variable : year                            Number of groups   =       140
## Number of instruments = 48                      Obs per group: min =         5
## Wald chi2(15) =  77616.84                                      avg =      5.36
## Prob &gt; chi2   =     0.000                                      max =         7
## ------------------------------------------------------------------------------
##              |              Corrected
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   1.056595   .0823386    12.83   0.000     .8952139    1.217975
##          L2. |   -.091112   .0444057    -2.05   0.040    -.1781455   -.0040784
##              |
##            w |
##          --. |  -.5261732   .1764455    -2.98   0.003    -.8720001   -.1803463
##          L1. |   .5580895   .2318739     2.41   0.016      .103625    1.012554
##              |
##            k |
##          --. |   .2736621   .0623234     4.39   0.000     .1515105    .3958137
##          L1. |  -.1077012   .0817974    -1.32   0.188    -.2680212    .0526189
##          L2. |  -.1137603   .0394536    -2.88   0.004    -.1910879   -.0364326
##              |
##           ys |
##          --. |   .6415435   .1719448     3.73   0.000      .304538    .9785491
##          L1. |  -.7563197    .268289    -2.82   0.005    -1.282156   -.2304829
##          L2. |   .1269893   .1909545     0.67   0.506    -.2472747    .5012532
##              |
##       yr1980 |   .0169468   .0148887     1.14   0.255    -.0122346    .0461281
##       yr1981 |  -.0165989   .0282045    -0.59   0.556    -.0718787    .0386808
##       yr1982 |  -.0186227   .0265597    -0.70   0.483    -.0706788    .0334334
##       yr1983 |   .0065109   .0270309     0.24   0.810    -.0464687    .0594905
##       yr1984 |  -.0078117   .0283787    -0.28   0.783     -.063433    .0478097
##        _cons |  -.1033136   .7528295    -0.14   0.891    -1.578832    1.372205
## ------------------------------------------------------------------------------
## Instruments for first differences equation
##   Standard
##     D.(yr1980 yr1981 yr1982 yr1983 yr1984)
##     D.(w L.w k L.k L2.k ys L.ys L2.ys)
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     L(1/8).L.n
## Instruments for levels equation
##   Standard
##     _cons
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     D.L.n
## ------------------------------------------------------------------------------
## Arellano-Bond test for AR(1) in first differences: z =  -3.64  Pr &gt; z =  0.000
## Arellano-Bond test for AR(2) in first differences: z =  -0.69  Pr &gt; z =  0.488
## ------------------------------------------------------------------------------
## Sargan test of overid. restrictions: chi2(32)   =  54.46  Prob &gt; chi2 =  0.008
##   (Not robust, but not weakened by many instruments.)
## Hansen test of overid. restrictions: chi2(32)   =  35.54  Prob &gt; chi2 =  0.305
##   (Robust, but weakened by many instruments.)
## 
## Difference-in-Hansen tests of exogeneity of instrument subsets:
##   GMM instruments for levels
##     Hansen test excluding group:     chi2(25)   =  26.99  Prob &gt; chi2 =  0.356
##     Difference (null H = exogenous): chi2(7)    =   8.55  Prob &gt; chi2 =  0.287
##   iv(w L.w k L.k L2.k ys L.ys L2.ys, eq(diff))
##     Hansen test excluding group:     chi2(24)   =  20.55  Prob &gt; chi2 =  0.665
##     Difference (null H = exogenous): chi2(8)    =  14.99  Prob &gt; chi2 =  0.059
##   iv(yr1980 yr1981 yr1982 yr1983 yr1984, eq(diff))
##     Hansen test excluding group:     chi2(27)   =  34.19  Prob &gt; chi2 =  0.161
##     Difference (null H = exogenous): chi2(5)    =   1.35  Prob &gt; chi2 =  0.930</code></pre>
</div>
<div id="模型估计结果比较" class="section level5">
<h5>模型估计结果比较</h5>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
*数据下载地址
*https://gitee.com/arlionn/data/blob/master/data01/abdata.dta
*use abdata, clear   // 调用数据
*-or
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
*---------FD-GMM
*xtabond 估计命令：
xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984,  ///
      lags(2) twostep vce(robust)   // L(0/1).w 表示 w 的当期值与一阶滞后
est store Fdxtabond

*xtdpd 估计命令：
xtdpd n l(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
      dgmmiv(n) div(L(0/1).w L(0/2).(k ys)) ///
      div(yr1980-yr1984) twostep vce(robust)
est store Fdxtdpd  

*xtabond2 估计命令：

xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys)  yr1980-yr1984,      ///
         gmm(l.n) iv(l(0/1).w l(0/2).(k ys))  ///
         iv(yr1980-yr1984) ///
         nolevel twostep robust
est store Fdxtabond2
*---------SYS-GMM
*xtabond2 估计命令
xtdpdsys n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
         lags(2) twostep vce(robust)
est store Sysxtdpdsys 

*xtdpd 估计命令：
xtdpd n L(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
      dgmmiv(n) lgmmiv(n) div(L(0/1).w L(0/2).(k ys))       ///
      div(yr1980-yr1984) twostep vce(robust)
est store Sysxtdpd

*xtabond2 估计命令：
xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys) yr1980-yr1984, ///
         gmm(l.n) iv(l(0/1).w l(0/2).(k ys), eq(diff))     ///
         iv(yr1980-yr1984,eq(diff)) twostep robust
est store Sysxtabond2

*结果汇总
local mm &quot;Fdxtabond Fdxtdpd Fdxtabond2 Sysxtdpdsys Sysxtdpd Sysxtabond2&quot;
esttab `mm&#39;, mtitle(`mm&#39;) compress star(* 0.1 ** 0.05 *** 0.01) b(%10.3f) nogap</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. *数据下载地址
## . *https://gitee.com/arlionn/data/blob/master/data01/abdata.dta
## . *use abdata, clear   // 调用数据
## . *-or
## . use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . *---------FD-GMM
## . *xtabond 估计命令：
## . xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984,  ///
## &gt;           lags(2) twostep vce(robust)   // L(0/1).w 表示 w 的当期值与一阶滞后
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     41                  Wald chi2(15)     =    1132.45
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
##        _cons |   .4939961   .6695478     0.74   0.461    -.8182935    1.806286
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . est store Fdxtabond
## 
## . 
## . *xtdpd 估计命令：
## . xtdpd n l(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
## &gt;       dgmmiv(n) div(L(0/1).w L(0/2).(k ys)) ///
## &gt;       div(yr1980-yr1984) twostep vce(robust)
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     41                  Wald chi2(15)     =    1132.45
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
##        _cons |   .4939961   .6695478     0.74   0.461    -.8182935    1.806286
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . est store Fdxtdpd  
## 
## . 
## . *xtabond2 估计命令：
## . 
## . xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys)  yr1980-yr1984,      ///
## &gt;          gmm(l.n) iv(l(0/1).w l(0/2).(k ys))  ///
## &gt;          iv(yr1980-yr1984) ///
## &gt;          nolevel twostep robust
## Favoring space over speed. To switch, type or click on mata: mata set matafavor
## &gt;  speed, perm.
## Warning: Two-step estimated covariance matrix of moments is singular.
##   Using a generalized inverse to calculate optimal weighting matrix for two-ste
## &gt; p estimation.
##   Difference-in-Sargan/Hansen statistics may be negative.
## 
## Dynamic panel-data estimation, two-step difference GMM
## ------------------------------------------------------------------------------
## Group variable: id                              Number of obs      =       611
## Time variable : year                            Number of groups   =       140
## Number of instruments = 40                      Obs per group: min =         4
## Wald chi2(0)  =         .                                      avg =      4.36
## Prob &gt; chi2   =         .                                      max =         6
## ------------------------------------------------------------------------------
##              |              Corrected
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
## ------------------------------------------------------------------------------
## Instruments for first differences equation
##   Standard
##     D.(yr1980 yr1981 yr1982 yr1983 yr1984)
##     D.(w L.w k L.k L2.k ys L.ys L2.ys)
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     L(1/8).L.n
## ------------------------------------------------------------------------------
## Arellano-Bond test for AR(1) in first differences: z =  -2.18  Pr &gt; z =  0.029
## Arellano-Bond test for AR(2) in first differences: z =  -0.30  Pr &gt; z =  0.762
## ------------------------------------------------------------------------------
## Sargan test of overid. restrictions: chi2(25)   =  62.91  Prob &gt; chi2 =  0.000
##   (Not robust, but not weakened by many instruments.)
## Hansen test of overid. restrictions: chi2(25)   =  29.34  Prob &gt; chi2 =  0.250
##   (Robust, but weakened by many instruments.)
## 
## Difference-in-Hansen tests of exogeneity of instrument subsets:
##   iv(w L.w k L.k L2.k ys L.ys L2.ys)
##     Hansen test excluding group:     chi2(17)   =  18.31  Prob &gt; chi2 =  0.370
##     Difference (null H = exogenous): chi2(8)    =  11.04  Prob &gt; chi2 =  0.200
##   iv(yr1980 yr1981 yr1982 yr1983 yr1984)
##     Hansen test excluding group:     chi2(20)   =  25.47  Prob &gt; chi2 =  0.184
##     Difference (null H = exogenous): chi2(5)    =   3.87  Prob &gt; chi2 =  0.568
## 
## 
## . est store Fdxtabond2
## 
## . *---------SYS-GMM
## . *xtabond2 估计命令
## . xtdpdsys n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
## &gt;          lags(2) twostep vce(robust)
## 
## System dynamic panel-data estimation            Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     48                  Wald chi2(15)     =    1449.65
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .9767449   .1418081     6.89   0.000     .6988061    1.254684
##          L2. |  -.0836652   .0419231    -2.00   0.046     -.165833   -.0014975
##              |
##            w |
##          --. |  -.5631217    .151118    -3.73   0.000    -.8593075   -.2669358
##          L1. |   .5673231   .2123546     2.67   0.008     .1511158    .9835304
##              |
##            k |
##          --. |   .2849277   .0668521     4.26   0.000     .1539001    .4159554
##          L1. |  -.0876075   .0871276    -1.01   0.315    -.2583744    .0831595
##          L2. |  -.0961451   .0433443    -2.22   0.027    -.1810984   -.0111919
##              |
##           ys |
##          --. |   .6138593   .1781104     3.45   0.001     .2647694    .9629491
##          L1. |   -.765499   .2470081    -3.10   0.002    -1.249626   -.2813719
##          L2. |   .1140538   .1725595     0.66   0.509    -.2241566    .4522641
##              |
##       yr1980 |    .009473   .0168233     0.56   0.573    -.0235001    .0424461
##       yr1981 |  -.0248051   .0296342    -0.84   0.403    -.0828871    .0332768
##       yr1982 |  -.0303709   .0327228    -0.93   0.353    -.0945064    .0337646
##       yr1983 |  -.0097145   .0363711    -0.27   0.789    -.0810005    .0615715
##       yr1984 |  -.0214451   .0348021    -0.62   0.538     -.089656    .0467658
##        _cons |   .3246957   .6640236     0.49   0.625    -.9767666    1.626158
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n
##         Standard: _cons
## 
## . est store Sysxtdpdsys 
## 
## . 
## . *xtdpd 估计命令：
## . xtdpd n L(1/2).n L(0/1).w L(0/2).(k ys) yr1980-yr1984, ///
## &gt;       dgmmiv(n) lgmmiv(n) div(L(0/1).w L(0/2).(k ys))       ///
## &gt;       div(yr1980-yr1984) twostep vce(robust)
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     48                  Wald chi2(15)     =    1449.65
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .9767449   .1418081     6.89   0.000     .6988061    1.254684
##          L2. |  -.0836652   .0419231    -2.00   0.046     -.165833   -.0014975
##              |
##            w |
##          --. |  -.5631217    .151118    -3.73   0.000    -.8593075   -.2669358
##          L1. |   .5673231   .2123546     2.67   0.008     .1511158    .9835304
##              |
##            k |
##          --. |   .2849277   .0668521     4.26   0.000     .1539001    .4159554
##          L1. |  -.0876075   .0871276    -1.01   0.315    -.2583744    .0831595
##          L2. |  -.0961451   .0433443    -2.22   0.027    -.1810984   -.0111919
##              |
##           ys |
##          --. |   .6138593   .1781104     3.45   0.001     .2647694    .9629491
##          L1. |   -.765499   .2470081    -3.10   0.002    -1.249626   -.2813719
##          L2. |   .1140538   .1725595     0.66   0.509    -.2241566    .4522641
##              |
##       yr1980 |    .009473   .0168233     0.56   0.573    -.0235001    .0424461
##       yr1981 |  -.0248051   .0296342    -0.84   0.403    -.0828871    .0332768
##       yr1982 |  -.0303709   .0327228    -0.93   0.353    -.0945064    .0337646
##       yr1983 |  -.0097145   .0363711    -0.27   0.789    -.0810005    .0615715
##       yr1984 |  -.0214451   .0348021    -0.62   0.538     -.089656    .0467658
##        _cons |   .3246957   .6640236     0.49   0.625    -.9767666    1.626158
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n
##         Standard: _cons
## 
## . est store Sysxtdpd
## 
## . 
## . *xtabond2 估计命令：
## . xtabond2 n l(1/2).n l(0/1).w l(0/2).(k ys) yr1980-yr1984, ///
## &gt;          gmm(l.n) iv(l(0/1).w l(0/2).(k ys), eq(diff))     ///
## &gt;          iv(yr1980-yr1984,eq(diff)) twostep robust
## Favoring space over speed. To switch, type or click on mata: mata set matafavor
## &gt;  speed, perm.
## Warning: Two-step estimated covariance matrix of moments is singular.
##   Using a generalized inverse to calculate optimal weighting matrix for two-ste
## &gt; p estimation.
##   Difference-in-Sargan/Hansen statistics may be negative.
## 
## Dynamic panel-data estimation, two-step system GMM
## ------------------------------------------------------------------------------
## Group variable: id                              Number of obs      =       751
## Time variable : year                            Number of groups   =       140
## Number of instruments = 48                      Obs per group: min =         5
## Wald chi2(15) =  77616.84                                      avg =      5.36
## Prob &gt; chi2   =     0.000                                      max =         7
## ------------------------------------------------------------------------------
##              |              Corrected
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   1.056595   .0823386    12.83   0.000     .8952139    1.217975
##          L2. |   -.091112   .0444057    -2.05   0.040    -.1781455   -.0040784
##              |
##            w |
##          --. |  -.5261732   .1764455    -2.98   0.003    -.8720001   -.1803463
##          L1. |   .5580895   .2318739     2.41   0.016      .103625    1.012554
##              |
##            k |
##          --. |   .2736621   .0623234     4.39   0.000     .1515105    .3958137
##          L1. |  -.1077012   .0817974    -1.32   0.188    -.2680212    .0526189
##          L2. |  -.1137603   .0394536    -2.88   0.004    -.1910879   -.0364326
##              |
##           ys |
##          --. |   .6415435   .1719448     3.73   0.000      .304538    .9785491
##          L1. |  -.7563197    .268289    -2.82   0.005    -1.282156   -.2304829
##          L2. |   .1269893   .1909545     0.67   0.506    -.2472747    .5012532
##              |
##       yr1980 |   .0169468   .0148887     1.14   0.255    -.0122346    .0461281
##       yr1981 |  -.0165989   .0282045    -0.59   0.556    -.0718787    .0386808
##       yr1982 |  -.0186227   .0265597    -0.70   0.483    -.0706788    .0334334
##       yr1983 |   .0065109   .0270309     0.24   0.810    -.0464687    .0594905
##       yr1984 |  -.0078117   .0283787    -0.28   0.783     -.063433    .0478097
##        _cons |  -.1033136   .7528295    -0.14   0.891    -1.578832    1.372205
## ------------------------------------------------------------------------------
## Instruments for first differences equation
##   Standard
##     D.(yr1980 yr1981 yr1982 yr1983 yr1984)
##     D.(w L.w k L.k L2.k ys L.ys L2.ys)
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     L(1/8).L.n
## Instruments for levels equation
##   Standard
##     _cons
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     D.L.n
## ------------------------------------------------------------------------------
## Arellano-Bond test for AR(1) in first differences: z =  -3.64  Pr &gt; z =  0.000
## Arellano-Bond test for AR(2) in first differences: z =  -0.69  Pr &gt; z =  0.488
## ------------------------------------------------------------------------------
## Sargan test of overid. restrictions: chi2(32)   =  54.46  Prob &gt; chi2 =  0.008
##   (Not robust, but not weakened by many instruments.)
## Hansen test of overid. restrictions: chi2(32)   =  35.54  Prob &gt; chi2 =  0.305
##   (Robust, but weakened by many instruments.)
## 
## Difference-in-Hansen tests of exogeneity of instrument subsets:
##   GMM instruments for levels
##     Hansen test excluding group:     chi2(25)   =  26.99  Prob &gt; chi2 =  0.356
##     Difference (null H = exogenous): chi2(7)    =   8.55  Prob &gt; chi2 =  0.287
##   iv(w L.w k L.k L2.k ys L.ys L2.ys, eq(diff))
##     Hansen test excluding group:     chi2(24)   =  20.55  Prob &gt; chi2 =  0.665
##     Difference (null H = exogenous): chi2(8)    =  14.99  Prob &gt; chi2 =  0.059
##   iv(yr1980 yr1981 yr1982 yr1983 yr1984, eq(diff))
##     Hansen test excluding group:     chi2(27)   =  34.19  Prob &gt; chi2 =  0.161
##     Difference (null H = exogenous): chi2(5)    =   1.35  Prob &gt; chi2 =  0.930
## 
## 
## . est store Sysxtabond2
## 
## . 
## . *结果汇总
## . local mm &quot;Fdxtabond Fdxtdpd Fdxtabond2 Sysxtdpdsys Sysxtdpd Sysxtabond2&quot;
## 
## . esttab `mm&#39;, mtitle(`mm&#39;) compress star(* 0.1 ** 0.05 *** 0.01) b(%10.3f) nog
## &gt; ap
## 
## -------------------------------------------------------------------------------
## &gt; ---------
##                  (1)          (2)          (3)          (4)          (5)       
## &gt;    (6)   
##            Fdxtabond      Fdxtdpd    Fdxtabo~2    Sysxtdp~s     Sysxtdpd    Sys
## &gt; xtab~2   
## -------------------------------------------------------------------------------
## &gt; ---------
## L.n            0.656***     0.656***     0.656***     0.977***     0.977***    
## &gt;  1.057***
##               (3.34)       (3.34)       (3.34)       (6.89)       (6.89)      (
## &gt; 12.83)   
## L2.n          -0.073       -0.073       -0.073       -0.084**     -0.084**     
## &gt; -0.091** 
##              (-1.61)      (-1.61)      (-1.61)      (-2.00)      (-2.00)      (
## &gt; -2.05)   
## w             -0.513***    -0.513***    -0.513***    -0.563***    -0.563***    
## &gt; -0.526***
##              (-3.43)      (-3.43)      (-3.43)      (-3.73)      (-3.73)      (
## &gt; -2.98)   
## L.w            0.329        0.329        0.329        0.567***     0.567***    
## &gt;  0.558** 
##               (1.59)       (1.59)       (1.59)       (2.67)       (2.67)       
## &gt; (2.41)   
## k              0.269***     0.269***     0.269***     0.285***     0.285***    
## &gt;  0.274***
##               (3.89)       (3.89)       (3.89)       (4.26)       (4.26)       
## &gt; (4.39)   
## L.k            0.022        0.022        0.022       -0.088       -0.088       
## &gt; -0.108   
##               (0.26)       (0.26)       (0.26)      (-1.01)      (-1.01)      (
## &gt; -1.32)   
## L2.k          -0.041       -0.041       -0.041       -0.096**     -0.096**     
## &gt; -0.114***
##              (-0.96)      (-0.96)      (-0.96)      (-2.22)      (-2.22)      (
## &gt; -2.88)   
## ys             0.592***     0.592***     0.592***     0.614***     0.614***    
## &gt;  0.642***
##               (3.56)       (3.56)       (3.56)       (3.45)       (3.45)       
## &gt; (3.73)   
## L.ys          -0.572**     -0.572**     -0.572**     -0.765***    -0.765***    
## &gt; -0.756***
##              (-2.23)      (-2.23)      (-2.23)      (-3.10)      (-3.10)      (
## &gt; -2.82)   
## L2.ys          0.117        0.117        0.117        0.114        0.114       
## &gt;  0.127   
##               (0.73)       (0.73)       (0.73)       (0.66)       (0.66)       
## &gt; (0.67)   
## yr1980         0.009        0.009        0.009        0.009        0.009       
## &gt;  0.017   
##               (0.65)       (0.65)       (0.65)       (0.56)       (0.56)       
## &gt; (1.14)   
## yr1981        -0.035       -0.035       -0.035       -0.025       -0.025       
## &gt; -0.017   
##              (-1.27)      (-1.27)      (-1.27)      (-0.84)      (-0.84)      (
## &gt; -0.59)   
## yr1982        -0.043       -0.043       -0.043       -0.030       -0.030       
## &gt; -0.019   
##              (-1.49)      (-1.49)      (-1.49)      (-0.93)      (-0.93)      (
## &gt; -0.70)   
## yr1983        -0.028       -0.028       -0.028       -0.010       -0.010       
## &gt;  0.007   
##              (-0.85)      (-0.85)      (-0.85)      (-0.27)      (-0.27)       
## &gt; (0.24)   
## yr1984        -0.034       -0.034       -0.034       -0.021       -0.021       
## &gt; -0.008   
##              (-1.03)      (-1.03)      (-1.03)      (-0.62)      (-0.62)      (
## &gt; -0.28)   
## _cons          0.494        0.494                     0.325        0.325       
## &gt; -0.103   
##               (0.74)       (0.74)                    (0.49)       (0.49)      (
## &gt; -0.14)   
## -------------------------------------------------------------------------------
## &gt; ---------
## N                611          751          611          751          751       
## &gt;    751   
## -------------------------------------------------------------------------------
## &gt; ---------
## t statistics in parentheses
## * p&lt;0.1, ** p&lt;0.05, *** p&lt;0.01</code></pre>
<p>　　由上表可以看出，在 FD-GMM 估计中，雇佣员工数量对数的一阶滞后项的系数在 0.6 左右，而在 SYS-GMM 估计中的系数为 0.9 左右，同时，SYS-GMM 估计结果整体偏高，并且各个系数显著性水平也更高。</p>
<p>　　对于 FD-GMM 估计，三种命令估计的结果相同，因此在做 FD-GMM 时，选择三者之中任意命令对结果没有影响，而对于 SYS-GMM 估计，<code>xtdpdsys</code> 和 <code>xtdpd</code> 的估计结果一致，而 <code>xtabond2</code> 估计结果与前面两个命令有差异。</p>
</div>
</div>
</div>
<div id="解释变量中含有内生变量" class="section level3">
<h3>解释变量中含有内生变量</h3>
<p>　　考虑如下模型：</p>
<p><span class="math display">\[
y_{i t}=a_{0} y_{i t-1}+a_{1} x_{i t}+a_{2} k_{i t}+u_{i}+v_{i t-1} \tag{68}
\]</span></p>
<p>　　其中，<span class="math inline">\(y_{i t-1}\)</span>是一个典型的内生变量，这里用<span class="math inline">\(L \cdot(2 / .) y_{i t}\)</span>作为D. <span class="math inline">\(y_{i t-1}\)</span>的工具变量，假设<span class="math inline">\(k_{i t}\)</span>为内生解释变量，使用其二阶及更高阶的滞后项<span class="math inline">\(L \cdot(2 / .) k_{i t}\)</span>作为工具变量 。</p>
<p>　　具体命令使用：</p>
<ul>
<li><code>xtabond</code>: <code>endogenous()</code> 选项来设定内生解释变量，在本例中为 <code>endogenous(k)</code>，如果限定使用<span class="math inline">\(k_{i t}\)</span> 工具变量的个数，比如只使用二阶和三阶滞后项，则可以设定为 <code>endogenous(k, lag(0 2))</code>; 如果内生变量为<span class="math inline">\(k_{i t}\)</span>的滞后一期，则可以设定为 <code>endogenous(k, lag(1 2))</code>，此时工具变量为滞后项<span class="math inline">\(k_{i t-1}\)</span>的二、三阶滞后项</li>
<li><code>xtdpd</code>：<code>dgmmiv()</code> 和 <code>lgmmiv()</code>选项来设定内生变量 (包括被解释变量和解释变量)，当使用 FD-GMM 估计时，设定为 <code>dgmmiv(y k)</code>，而使用SYS-GMM估计时，则设定为<code>dgmmiv(y k) lgmmiv(y k)</code></li>
<li><code>xtabond2</code>：<code>gmm()</code> 选项来设定内生变量 (包括被解释变量和解释变量)，对于内生被解释变量设定为 <code>gmm(l.y)</code> 或者 <code>gmm(y, lag(2 .))</code> ，为将解释变量的二阶及所有高阶滞后项作为工具变量；对于内生解释变量设定为<code>gmm(k)</code> ，其含义是将解释变量的一阶及所有高阶滞后项作为工具变量，若设定成<code>gmm(k, lag(2 3))</code>则为将解释变量的二阶和三阶滞后项作为工具变量</li>
<li><code>xtdpdsys</code>：<code>endogenous()</code> 选项来设定内生解释变量，设定为<code>endogenous(k)</code> ，表示将内生解释变量 k 的二阶及所有高阶滞后项作为工具变量；设定为<code>endogenous(k lag(0, 2))</code> ，表示将内生解释变量 k 的二阶和三阶滞后项作为工具变量，其中 0 为变量 k 的当期值作为内生变量，2 表示内生变量 k 的滞后 2 阶和 3 阶项作为工具变量； 若设定为 <code>endogenous(k, lag(1, 3))</code>表示将内生解释变量 L.k ( k 的一阶滞后项) 的二、三、四阶滞后项 (即 L(2/4).L.k) 作为工具变量。</li>
</ul>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
*以abdata.dta数据为例，假设资本存量 k 为内生变量，k 的设定如下

xtabond n L(0/1).w L(0/2).ys yr1980-yr1984, lags(2) endogenous(k) twostep vce(robust)

xtabond n L(0/1).w L(0/2).ys yr1980-yr1984, lags(2) endogenous(k, lag(0, 2)) twostep vce(robust)
// 限定内生解释变量工具变量的滞后阶数

xtabond n L(0/1).w L(0/2).ys yr1980-yr1984, lags(2) endogenous(k, lag(1, 2)) twostep vce(robust)
// 设定滞后项的内生解释变量

xtdpd n L(1/2).n L(0/1).w L(0/2).ys k yr1980-yr1984, dgmmiv(n k) div(L(0/1).w L(0/2).ys) ///
    div(yr1980-yr1984) twostep vce(robust) // FD-GMM 估计

xtdpd n L(1/2).n L(0/1).w L(0/2).ys k yr1980-yr1984, dgmmiv(n  k) lgmmiv(n  k) ///
            div(year yr1979-yr1984) nocons hascons vce(robust) // SYS-GMM 估计

xtabond2 n l(1/2).n l(0/1).w l(0/2).ys k yr1980-yr1984, ///
    gmm(l.n k) iv(l(0/1).w l(0/2).ys) iv(yr1980-yr1984) nolevel twostep robust

xtabond2 n l(1/2).n l(0/1).w l(0/2).ys k yr1980-yr1984, ///
    gmm(l.n) gmm(k, lag(2 3)) iv(l(0/1).w l(0/2).ys) iv(yr1980-yr1984) nolevel twostep robust
// 限定内生解释变量工具变量的滞后阶数

xtdpdsys n L(0/1).w L(0/2).ys k yr1980-yr1984, ///
    lags(2) endog(k) twostep vce(robust) // SYS-GMM 估计

xtdpdsys n L(0/1).w L(0/2).ys k yr1980-yr1984, ///
    lags(2) endog(k, lag(0, 2)) twostep vce(robust) // 限定内生解释变量工具变量的滞后阶数

xtdpdsys n L(0/1).w L(0/2).ys k yr1980-yr1984, ///
    lags(2) endogenous(k, lag(1, 3)) twostep vce(robust) // 设定滞后项的内生解释变量</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . *以abdata.dta数据为例，假设资本存量 k 为内生变量，k 的设定如下
## . 
## . xtabond n L(0/1).w L(0/2).ys yr1980-yr1984, lags(2) endogenous(k) twostep vce
## &gt; (robust)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     65                  Wald chi2(13)     =     918.24
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .5804812   .1178342     4.93   0.000     .3495305    .8114319
##          L2. |  -.0793705   .0575662    -1.38   0.168    -.1921983    .0334573
##              |
##            k |   .3913143   .1423268     2.75   0.006     .1123588    .6702697
##              |
##            w |
##          --. |  -.5387307   .1695913    -3.18   0.001    -.8711235    -.206338
##          L1. |   .3373366   .1323439     2.55   0.011     .0779474    .5967257
##              |
##           ys |
##          --. |    .614734   .1606496     3.83   0.000     .2998666    .9296014
##          L1. |  -.7320887   .2232148    -3.28   0.001    -1.169582   -.2945957
##          L2. |   .1361556   .1618121     0.84   0.400    -.1809903    .4533014
##              |
##       yr1980 |   .0091326   .0138669     0.66   0.510     -.018046    .0363111
##       yr1981 |   -.037165   .0263094    -1.41   0.158    -.0887305    .0144005
##       yr1982 |  -.0465421   .0278098    -1.67   0.094    -.1010482    .0079641
##       yr1983 |  -.0401863   .0329183    -1.22   0.222     -.104705    .0243324
##       yr1984 |   -.025502   .0354651    -0.72   0.472    -.0950122    .0440082
##        _cons |   1.277182   1.068719     1.20   0.232    -.8174689    3.371833
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/.).k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . 
## . xtabond n L(0/1).w L(0/2).ys yr1980-yr1984, lags(2) endogenous(k, lag(0, 2)) 
## &gt; twostep vce(robust)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     50                  Wald chi2(13)     =     918.36
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6493521   .1368221     4.75   0.000     .3811856    .9175185
##          L2. |   -.074297   .0571601    -1.30   0.194    -.1863288    .0377348
##              |
##            k |   .2600169   .1611225     1.61   0.107    -.0557774    .5758112
##              |
##            w |
##          --. |  -.5007867    .148056    -3.38   0.001    -.7909711   -.2106024
##          L1. |   .3247534   .1271729     2.55   0.011     .0754991    .5740077
##              |
##           ys |
##          --. |   .6791913   .1703572     3.99   0.000     .3452972    1.013085
##          L1. |  -.6701189   .2301264    -2.91   0.004    -1.121158   -.2190796
##          L2. |   .0686256   .1578394     0.43   0.664    -.2407339    .3779851
##              |
##       yr1980 |   .0113007    .014074     0.80   0.422    -.0162839    .0388853
##       yr1981 |  -.0353639   .0269637    -1.31   0.190    -.0882119     .017484
##       yr1982 |  -.0544872   .0270733    -2.01   0.044    -.1075499   -.0014244
##       yr1983 |   -.045471   .0296179    -1.54   0.125    -.1035209     .012579
##       yr1984 |  -.0559424   .0334137    -1.67   0.094     -.121432    .0095472
##        _cons |   .7781619    1.23262     0.63   0.528    -1.637728    3.194052
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/3).k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . // 限定内生解释变量工具变量的滞后阶数
## . 
## . xtabond n L(0/1).w L(0/2).ys yr1980-yr1984, lags(2) endogenous(k, lag(1, 2)) 
## &gt; twostep vce(robust)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     49                  Wald chi2(14)     =    1177.88
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .7180471   .1449618     4.95   0.000     .4339272    1.002167
##          L2. |   -.094648   .0451351    -2.10   0.036    -.1831112   -.0061848
##              |
##            k |
##          --. |   .4370943   .1710059     2.56   0.011     .1019288    .7722597
##          L1. |  -.1938154   .1482583    -1.31   0.191    -.4843962    .0967655
##              |
##            w |
##          --. |  -.5136192   .1331752    -3.86   0.000    -.7746378   -.2526006
##          L1. |    .407837   .1602228     2.55   0.011     .0938061    .7218679
##              |
##           ys |
##          --. |   .6639861   .1874404     3.54   0.000     .2966096    1.031363
##          L1. |  -.7441575   .2380109    -3.13   0.002     -1.21065   -.2776647
##          L2. |    .207975   .1851353     1.12   0.261    -.1548834    .5708334
##              |
##       yr1980 |   .0235048   .0158883     1.48   0.139    -.0076357    .0546453
##       yr1981 |  -.0176641   .0292265    -0.60   0.546     -.074947    .0396187
##       yr1982 |  -.0238586    .028733    -0.83   0.406    -.0801742     .032457
##       yr1983 |  -.0144695    .031028    -0.47   0.641    -.0752832    .0463442
##       yr1984 |  -.0151104   .0316981    -0.48   0.634    -.0772375    .0470168
##        _cons |   .2514928   1.069314     0.24   0.814    -1.844323    2.347309
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/3).L.k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . // 设定滞后项的内生解释变量
## . 
## . xtdpd n L(1/2).n L(0/1).w L(0/2).ys k yr1980-yr1984, dgmmiv(n k) div(L(0/1).w
## &gt;  L(0/2).ys) ///
## &gt;     div(yr1980-yr1984) twostep vce(robust) // FD-GMM 估计
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     65                  Wald chi2(13)     =     918.24
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .5804812   .1178342     4.93   0.000     .3495305    .8114319
##          L2. |  -.0793705   .0575662    -1.38   0.168    -.1921983    .0334573
##              |
##            w |
##          --. |  -.5387307   .1695913    -3.18   0.001    -.8711235    -.206338
##          L1. |   .3373366   .1323439     2.55   0.011     .0779474    .5967257
##              |
##           ys |
##          --. |    .614734   .1606496     3.83   0.000     .2998666    .9296014
##          L1. |  -.7320887   .2232148    -3.28   0.001    -1.169582   -.2945957
##          L2. |   .1361556   .1618121     0.84   0.400    -.1809903    .4533014
##              |
##            k |   .3913143   .1423268     2.75   0.006     .1123588    .6702697
##       yr1980 |   .0091326   .0138669     0.66   0.510     -.018046    .0363111
##       yr1981 |   -.037165   .0263094    -1.41   0.158    -.0887305    .0144005
##       yr1982 |  -.0465421   .0278098    -1.67   0.094    -.1010482    .0079641
##       yr1983 |  -.0401863   .0329183    -1.22   0.222     -.104705    .0243324
##       yr1984 |   -.025502   .0354651    -0.72   0.472    -.0950122    .0440082
##        _cons |   1.277182   1.068719     1.20   0.232    -.8174689    3.371833
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/.).k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . 
## . xtdpd n L(1/2).n L(0/1).w L(0/2).ys k yr1980-yr1984, dgmmiv(n  k) lgmmiv(n  k
## &gt; ) ///
## &gt;             div(year yr1979-yr1984) nocons hascons vce(robust) // SYS-GMM 估
## &gt; 计
## 
## Dynamic panel-data estimation                   Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     74                  Wald chi2(13)     =    7860.21
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |               Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .8819349   .1079841     8.17   0.000     .6702899     1.09358
##          L2. |  -.1045766   .0699896    -1.49   0.135    -.2417537    .0326005
##              |
##            w |
##          --. |  -.7442267   .1690909    -4.40   0.000    -1.075639   -.4128147
##          L1. |   .5457303   .2370424     2.30   0.021     .0811357    1.010325
##              |
##           ys |
##          --. |   .6376472   .2587641     2.46   0.014     .1304789    1.144815
##          L1. |  -.1482578   .4708311    -0.31   0.753     -1.07107    .7745542
##          L2. |  -.2890783   .4078651    -0.71   0.478    -1.088479    .5103225
##              |
##            k |   .1874109   .0488616     3.84   0.000     .0916439     .283178
##       yr1980 |   .0105488   .0203923     0.52   0.605    -.0294194     .050517
##       yr1981 |   .0107758   .0400844     0.27   0.788    -.0677883    .0893398
##       yr1982 |   .0310445   .0456801     0.68   0.497    -.0584868    .1205759
##       yr1983 |   .0266316   .0475691     0.56   0.576    -.0666023    .1198654
##       yr1984 |   .0229461   .0464018     0.49   0.621    -.0679997     .113892
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/.).k
##         Standard: D.year D.yr1979 D.yr1980 D.yr1981 D.yr1982 D.yr1983
##                   D.yr1984
## Instruments for level equation
##         GMM-type: LD.n LD.k
## 
## . 
## . xtabond2 n l(1/2).n l(0/1).w l(0/2).ys k yr1980-yr1984, ///
## &gt;     gmm(l.n k) iv(l(0/1).w l(0/2).ys) iv(yr1980-yr1984) nolevel twostep robus
## &gt; t
## Favoring space over speed. To switch, type or click on mata: mata set matafavor
## &gt;  speed, perm.
## Warning: Two-step estimated covariance matrix of moments is singular.
##   Using a generalized inverse to calculate optimal weighting matrix for two-ste
## &gt; p estimation.
##   Difference-in-Sargan/Hansen statistics may be negative.
## 
## Dynamic panel-data estimation, two-step difference GMM
## ------------------------------------------------------------------------------
## Group variable: id                              Number of obs      =       611
## Time variable : year                            Number of groups   =       140
## Number of instruments = 70                      Obs per group: min =         4
## Wald chi2(0)  =         .                                      avg =      4.36
## Prob &gt; chi2   =         .                                      max =         6
## ------------------------------------------------------------------------------
##              |              Corrected
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |    .571213   .1022498     5.59   0.000     .3708071    .7716188
##          L2. |  -.0693071   .0550457    -1.26   0.208    -.1771948    .0385806
##              |
##            w |
##          --. |  -.5652283    .162153    -3.49   0.000    -.8830423   -.2474142
##          L1. |   .3440481   .1304692     2.64   0.008     .0883333     .599763
##              |
##           ys |
##          --. |   .6135456   .1463094     4.19   0.000     .3267845    .9003068
##          L1. |  -.6974728    .216894    -3.22   0.001    -1.122577   -.2723683
##          L2. |   .1227856   .1573351     0.78   0.435    -.1855856    .4311568
##              |
##            k |   .4076464   .1004904     4.06   0.000     .2106888     .604604
##       yr1980 |   .0107822   .0136607     0.79   0.430    -.0159922    .0375566
##       yr1981 |  -.0315141   .0233716    -1.35   0.178    -.0773215    .0142933
##       yr1982 |  -.0382904   .0261097    -1.47   0.143    -.0894645    .0128838
##       yr1983 |  -.0285178   .0317355    -0.90   0.369    -.0907182    .0336826
##       yr1984 |  -.0088077   .0346201    -0.25   0.799    -.0766618    .0590465
## ------------------------------------------------------------------------------
## Instruments for first differences equation
##   Standard
##     D.(yr1980 yr1981 yr1982 yr1983 yr1984)
##     D.(w L.w ys L.ys L2.ys)
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     L(1/8).(L.n k)
## ------------------------------------------------------------------------------
## Arellano-Bond test for AR(1) in first differences: z =  -2.70  Pr &gt; z =  0.007
## Arellano-Bond test for AR(2) in first differences: z =  -0.34  Pr &gt; z =  0.733
## ------------------------------------------------------------------------------
## Sargan test of overid. restrictions: chi2(57)   = 125.17  Prob &gt; chi2 =  0.000
##   (Not robust, but not weakened by many instruments.)
## Hansen test of overid. restrictions: chi2(57)   =  67.39  Prob &gt; chi2 =  0.163
##   (Robust, but weakened by many instruments.)
## 
## Difference-in-Hansen tests of exogeneity of instrument subsets:
##   iv(w L.w ys L.ys L2.ys)
##     Hansen test excluding group:     chi2(52)   =  50.33  Prob &gt; chi2 =  0.540
##     Difference (null H = exogenous): chi2(5)    =  17.06  Prob &gt; chi2 =  0.004
##   iv(yr1980 yr1981 yr1982 yr1983 yr1984)
##     Hansen test excluding group:     chi2(52)   =  61.90  Prob &gt; chi2 =  0.164
##     Difference (null H = exogenous): chi2(5)    =   5.49  Prob &gt; chi2 =  0.359
## 
## 
## . 
## . xtabond2 n l(1/2).n l(0/1).w l(0/2).ys k yr1980-yr1984, ///
## &gt;     gmm(l.n) gmm(k, lag(2 3)) iv(l(0/1).w l(0/2).ys) iv(yr1980-yr1984) noleve
## &gt; l twostep robust
## Favoring space over speed. To switch, type or click on mata: mata set matafavor
## &gt;  speed, perm.
## Warning: Two-step estimated covariance matrix of moments is singular.
##   Using a generalized inverse to calculate optimal weighting matrix for two-ste
## &gt; p estimation.
##   Difference-in-Sargan/Hansen statistics may be negative.
## 
## Dynamic panel-data estimation, two-step difference GMM
## ------------------------------------------------------------------------------
## Group variable: id                              Number of obs      =       611
## Time variable : year                            Number of groups   =       140
## Number of instruments = 49                      Obs per group: min =         4
## Wald chi2(0)  =         .                                      avg =      4.36
## Prob &gt; chi2   =         .                                      max =         6
## ------------------------------------------------------------------------------
##              |              Corrected
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6493521   .1368221     4.75   0.000     .3811856    .9175185
##          L2. |   -.074297   .0571601    -1.30   0.194    -.1863288    .0377348
##              |
##            w |
##          --. |  -.5007867    .148056    -3.38   0.001    -.7909711   -.2106024
##          L1. |   .3247534   .1271729     2.55   0.011     .0754991    .5740077
##              |
##           ys |
##          --. |   .6791913   .1703572     3.99   0.000     .3452972    1.013085
##          L1. |  -.6701189   .2301264    -2.91   0.004    -1.121158   -.2190796
##          L2. |   .0686256   .1578394     0.43   0.664    -.2407339    .3779851
##              |
##            k |   .2600169   .1611225     1.61   0.107    -.0557774    .5758112
##       yr1980 |   .0113007    .014074     0.80   0.422    -.0162839    .0388853
##       yr1981 |  -.0353639   .0269637    -1.31   0.190    -.0882119     .017484
##       yr1982 |  -.0544872   .0270733    -2.01   0.044    -.1075499   -.0014244
##       yr1983 |   -.045471   .0296179    -1.54   0.125    -.1035209     .012579
##       yr1984 |  -.0559424   .0334137    -1.67   0.094     -.121432    .0095472
## ------------------------------------------------------------------------------
## Instruments for first differences equation
##   Standard
##     D.(yr1980 yr1981 yr1982 yr1983 yr1984)
##     D.(w L.w ys L.ys L2.ys)
##   GMM-type (missing=0, separate instruments for each period unless collapsed)
##     L(2/3).k
##     L(1/8).L.n
## ------------------------------------------------------------------------------
## Arellano-Bond test for AR(1) in first differences: z =  -2.35  Pr &gt; z =  0.019
## Arellano-Bond test for AR(2) in first differences: z =  -0.30  Pr &gt; z =  0.762
## ------------------------------------------------------------------------------
## Sargan test of overid. restrictions: chi2(36)   =  91.13  Prob &gt; chi2 =  0.000
##   (Not robust, but not weakened by many instruments.)
## Hansen test of overid. restrictions: chi2(36)   =  46.10  Prob &gt; chi2 =  0.121
##   (Robust, but weakened by many instruments.)
## 
## Difference-in-Hansen tests of exogeneity of instrument subsets:
##   gmm(L.n, lag(1 .))
##     Hansen test excluding group:     chi2(9)    =  13.21  Prob &gt; chi2 =  0.153
##     Difference (null H = exogenous): chi2(27)   =  32.89  Prob &gt; chi2 =  0.201
##   gmm(k, lag(2 3))
##     Hansen test excluding group:     chi2(24)   =  27.63  Prob &gt; chi2 =  0.276
##     Difference (null H = exogenous): chi2(12)   =  18.47  Prob &gt; chi2 =  0.102
##   iv(w L.w ys L.ys L2.ys)
##     Hansen test excluding group:     chi2(31)   =  35.92  Prob &gt; chi2 =  0.249
##     Difference (null H = exogenous): chi2(5)    =  10.18  Prob &gt; chi2 =  0.070
##   iv(yr1980 yr1981 yr1982 yr1983 yr1984)
##     Hansen test excluding group:     chi2(31)   =  34.20  Prob &gt; chi2 =  0.316
##     Difference (null H = exogenous): chi2(5)    =  11.89  Prob &gt; chi2 =  0.036
## 
## 
## . // 限定内生解释变量工具变量的滞后阶数
## . 
## . xtdpdsys n L(0/1).w L(0/2).ys k yr1980-yr1984, ///
## &gt;     lags(2) endog(k) twostep vce(robust) // SYS-GMM 估计
## note: k dropped because of collinearity
## 
## System dynamic panel-data estimation            Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     80                  Wald chi2(13)     =    1324.66
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .8059278   .1092908     7.37   0.000     .5917218    1.020134
##          L2. |  -.0882743   .0622977    -1.42   0.156    -.2103756    .0338271
##              |
##            k |   .2230706   .0543624     4.10   0.000     .1165224    .3296189
##              |
##            w |
##          --. |  -.6013881   .1809088    -3.32   0.001    -.9559629   -.2468133
##          L1. |   .4685845   .1569714     2.99   0.003     .1609262    .7762429
##              |
##           ys |
##          --. |   .7648726   .1538468     4.97   0.000     .4633384    1.066407
##          L1. |  -.8041484   .2063776    -3.90   0.000    -1.208641   -.3996556
##          L2. |   .1057626   .1812126     0.58   0.559    -.2494076    .4609328
##              |
##       yr1980 |   .0121559   .0122929     0.99   0.323    -.0119377    .0362496
##       yr1981 |  -.0210324   .0248815    -0.85   0.398    -.0697992    .0277344
##       yr1982 |  -.0279339   .0253296    -1.10   0.270     -.077579    .0217111
##       yr1983 |  -.0245982   .0304071    -0.81   0.419    -.0841949    .0349985
##       yr1984 |  -.0101288   .0321651    -0.31   0.753    -.0731712    .0529136
##        _cons |   .5155797   .6735342     0.77   0.444     -.804523    1.835682
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/.).k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.k D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n LD.k
##         Standard: _cons
## 
## . 
## . xtdpdsys n L(0/1).w L(0/2).ys k yr1980-yr1984, ///
## &gt;     lags(2) endog(k, lag(0, 2)) twostep vce(robust) // 限定内生解释变量工具变
## &gt; 量的滞后阶数
## note: k dropped because of collinearity
## 
## System dynamic panel-data estimation            Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     65                  Wald chi2(13)     =    1344.66
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |    .869979   .1035312     8.40   0.000     .6670616    1.072896
##          L2. |  -.1038468   .0611516    -1.70   0.089    -.2237018    .0160082
##              |
##            k |   .1880778   .0495546     3.80   0.000     .0909526     .285203
##              |
##            w |
##          --. |  -.5433675   .1621928    -3.35   0.001    -.8612595   -.2254756
##          L1. |   .4654813   .1577402     2.95   0.003     .1563162    .7746464
##              |
##           ys |
##          --. |   .7700252   .1705239     4.52   0.000     .4358045    1.104246
##          L1. |  -.7688653   .2067547    -3.72   0.000    -1.174097   -.3636336
##          L2. |  -.0010336   .1753493    -0.01   0.995     -.344712    .3426448
##              |
##       yr1980 |   .0126466   .0132756     0.95   0.341     -.013373    .0386662
##       yr1981 |  -.0180181   .0252568    -0.71   0.476    -.0675204    .0314843
##       yr1982 |  -.0357552   .0238105    -1.50   0.133     -.082423    .0109126
##       yr1983 |  -.0257199   .0268551    -0.96   0.338    -.0783549    .0269151
##       yr1984 |  -.0357652   .0283115    -1.26   0.206    -.0912547    .0197244
##        _cons |   .5882842   .6350368     0.93   0.354    -.6563652    1.832934
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/3).k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.k D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n LD.k
##         Standard: _cons
## 
## . 
## . xtdpdsys n L(0/1).w L(0/2).ys k yr1980-yr1984, ///
## &gt;     lags(2) endogenous(k, lag(1, 3)) twostep vce(robust) // 设定滞后项的内生
## &gt; 解释变量
## note: k dropped because of collinearity
## 
## System dynamic panel-data estimation            Number of obs     =        751
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          5
##                                                               avg =   5.364286
##                                                               max =          7
## 
## Number of instruments =     67                  Wald chi2(14)     =    4131.11
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .9773593   .0840325    11.63   0.000     .8126586     1.14206
##          L2. |  -.1161997   .0424579    -2.74   0.006    -.1994156   -.0329838
##              |
##            k |
##          --. |   .3332624   .0861638     3.87   0.000     .1643844    .5021405
##          L1. |  -.2198623   .0843498    -2.61   0.009     -.385185   -.0545397
##              |
##            w |
##          --. |  -.6079922   .1665407    -3.65   0.000    -.9344059   -.2815785
##          L1. |   .5141789   .2104303     2.44   0.015      .101743    .9266148
##              |
##           ys |
##          --. |   .7190688   .1547517     4.65   0.000     .4157611    1.022377
##          L1. |  -.8328024   .2410054    -3.46   0.001    -1.305164   -.3604406
##          L2. |   .1031441   .1801786     0.57   0.567    -.2499993    .4562876
##              |
##       yr1980 |   .0242851   .0165859     1.46   0.143    -.0082227     .056793
##       yr1981 |  -.0047477   .0291573    -0.16   0.871     -.061895    .0523996
##       yr1982 |  -.0141118   .0293496    -0.48   0.631     -.071636    .0434124
##       yr1983 |   .0012104   .0294811     0.04   0.967    -.0565716    .0589924
##       yr1984 |  -.0068118   .0271514    -0.25   0.802    -.0600276    .0464041
##        _cons |   .5416495   .5703022     0.95   0.342    -.5761223    1.659421
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n L(2/4).L.k
##         Standard: D.w LD.w D.ys LD.ys L2D.ys D.k D.yr1980 D.yr1981 D.yr1982
##                   D.yr1983 D.yr1984
## Instruments for level equation
##         GMM-type: LD.n L2D.k
##         Standard: _cons</code></pre>
</div>
<div id="干扰项序列相关检验无法通过" class="section level3">
<h3>干扰项序列相关检验无法通过</h3>
<p>　　Arellano and Bond (1991) 估计工具变量的设定关键点：</p>
<p><span class="math display">\[
E\left(\Delta y_{i(t-j)} \Delta \varepsilon_{i t}\right)=0 \quad j \geq 2 \tag{69}
\]</span></p>
<p>　　换言之，FD-GMM 和 SYS-GMM 成立的前提是扰动项 <span class="math inline">\(\epsilon_{i t}\)</span> 不存在序列相关，否则就会导致内生性问题。因此，需要对扰动项序列相关进行检验，具体如下：</p>
<p>　　原假设：扰动项不存在序列相关；</p>
<ul>
<li>“扰动项的一阶差分” 存在自相关：</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\operatorname{Cov}\left(\Delta \varepsilon_{i t}, \Delta \varepsilon_{i, t-1}\right) &amp;=\operatorname{Cov}\left(\varepsilon_{i t}-\varepsilon_{i, t-1}, \varepsilon_{i, t-1}-\varepsilon_{i, t-2}\right) \\
&amp;=\operatorname{Cov}\left(\varepsilon_{i, t-1},-\varepsilon_{i, t-1}\right) \\
&amp;=-\operatorname{Var}\left(\varepsilon_{i, t-1}\right) \neq 0
\end{aligned}   \tag{70}
\]</span></p>
<ul>
<li>扰动项的差分不存在二阶或更高的自相关：</li>
</ul>
<p><span class="math display">\[
\operatorname{Cov}\left(\Delta \varepsilon_{i t}, \Delta \varepsilon_{i, t-k}\right)=0, k \geqslant 2 \tag{71}
\]</span></p>
<p>　　故可通过检验扰动项的差分是否存在二阶 (或更高阶) 的自相关来检验原假设。</p>
<p>　　Stata 命令为 <code>estat abond</code>。</p>
<pre class="stata"><code>use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, lags(2) twostep vce(robust)
estat abond</code></pre>
<pre><code>## 
## 
## . use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stat&gt; 能无法执行
## 
## . xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, lags(2) twostep vce(robust)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     41                  Wald chi2(15)     =    1132.45
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
##                                      (Std. Err. adjusted for clustering on id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667   .1963928     3.34   0.001     .2710439     1.04089
##          L2. |  -.0729992   .0454283    -1.61   0.108     -.162037    .0160385
##              |
##            w |
##          --. |  -.5132088   .1495341    -3.43   0.001    -.8062903   -.2201272
##          L1. |   .3289685     .20637     1.59   0.111    -.0755093    .7334463
##              |
##            k |
##          --. |   .2694384   .0692685     3.89   0.000     .1336745    .4052022
##          L1. |   .0216493   .0845409     0.26   0.798    -.1440478    .1873463
##          L2. |  -.0409021   .0427003    -0.96   0.338    -.1245932    .0427889
##              |
##           ys |
##          --. |   .5917429   .1659892     3.56   0.000     .2664101    .9170757
##          L1. |   -.572021   .2566893    -2.23   0.026    -1.075123   -.0689192
##          L2. |   .1172642   .1599951     0.73   0.464    -.1963204    .4308488
##              |
##       yr1980 |   .0092621   .0143316     0.65   0.518    -.0188273    .0373515
##       yr1981 |  -.0347086   .0272711    -1.27   0.203     -.088159    .0187418
##       yr1982 |  -.0432807   .0290662    -1.49   0.136    -.1002494    .0136879
##       yr1983 |  -.0277604   .0325707    -0.85   0.394    -.0915979    .0360771
##       yr1984 |  -.0335613   .0327381    -1.03   0.305    -.0977269    .0306042
##        _cons |   .4939961   .6695478     0.74   0.461    -.8182935    1.806286
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons
## 
## . estat abond
## 
## Arellano-Bond test for zero autocorrelation in first-differenced errors
##   +-----------------------+
##   |Order |  z     Prob &gt; z|
##   |------+----------------|
##   |   1  |-2.1783  0.0294 |
##   |   2  |-.30351  0.7615 |
##   +-----------------------+
##    H0: no autocorrelation</code></pre>
<p>　　可以看出，在 5% 的显著性水平下，扰动项的差分存在一阶自相关，但不存在二阶自相关，故不拒绝原假设。</p>
<p>　　<font color=blue >如果无法通过序列相关检验，主要原因可能是干扰项中包含了一些序列相关特征较为明显的变量。此时，我们可以通过增加解释变量，以使干扰项变得更「干净」。</font>具体设定如下：</p>
<ul>
<li>加入时间虚拟变量；</li>
<li>加入部分解释变量的滞后项 (要有一定的理论依据)；</li>
<li>加入被解释变量的滞后项，可以通过 <code>xtabond</code> 命令的 <code>lag(#)</code> 选项来设定。</li>
</ul>
<p>　　需要特别说明的是，序列相关检验和过度识别检验往往要同步进行。因为，如果选择的工具变量不妥 (表现为过度识别检验无法通过)，序列相关检验也就没有了根基。</p>
</div>
<div id="过度识别检验无法通过" class="section level3">
<h3>过度识别检验无法通过</h3>
<p>　　在工具变量大于内生变量个数时，需要进行过度识别检验。基本原理是检验工具变量是否是与干扰项相关，即工具变量是否为外生变量。具体如下：</p>
<p>　　原假设：所有工具变量都是外生；</p>
<p>　　方法：在 <code>xtabond</code> 命令以后，使用 <code>estat sargan</code> 命令。</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
quietly xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, lags(2)  // 不使用 VCE(robust)
estat sargan  // 过度识别检验</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . quietly xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, lags(2)  // 不使用 VC
## &gt; E(robust)
## 
## . estat sargan  // 过度识别检验
## Sargan test of overidentifying restrictions
##         H0: overidentifying restrictions are valid
## 
##         chi2(25)     =  61.26444
##         Prob &gt; chi2  =    0.0001</code></pre>
<p>　　可以看出，该结果拒绝了原假设，即认为存在工具变量和干扰项是相关。 但是 Arellano and Bond (1991) 指出，当干扰项存在异方差时， Sargan检验倾向于过度拒绝原假设，因此得到的结论并不可信。建议采用两阶段估计，再执行 Sargan 检验比较稳妥。</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
quietly xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, twostep lags(2)   // 不使用 VCE(robust)
estat sargan  // 使用两阶段估计后的过度识别检验</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . quietly xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, twostep lags(2)   // 
## &gt; 不使用 VCE(robust)
## 
## . estat sargan  // 使用两阶段估计后的过度识别检验
## Sargan test of overidentifying restrictions
##         H0: overidentifying restrictions are valid
## 
##         chi2(25)     =  29.34445
##         Prob &gt; chi2  =    0.2498</code></pre>
<p>　　可以看出，结果没有拒绝原假设，即工具变量与扰动项不相关。</p>
<p>　　实际上，Sargan 检验是联合检验：(1) 模型的设定正确 (2) 工具变量合理。因此，若拒绝原假设，则说明前面两个假设至少有一个存在问题。此时，应该先考虑模型的设定是否有问题，进而分析工具变量的设定是否合理。</p>
<p>　　关于工具变量，通常使用<span class="math inline">\(y_{t-s}(s \geq 2)\)</span>作为<span class="math inline">\(\Delta y_{i t-1}\)</span>的工具变量，但当<span class="math inline">\(T\)</span> 较大时，就会有很多个工具变量。显然，随着<span class="math inline">\(s\)</span>的增加，<span class="math inline">\(\rho_{s}=\operatorname{corr}\left(\Delta y_{i t-1}, y_{t-s}\right)\)</span>会越来越小。一般而言，当<span class="math inline">\(s&gt;6\)</span>以后，对应的工具变量很可能是弱工具变量，即<span class="math inline">\(y_{t-7}\)</span>与<span class="math inline">\(\Delta y_{i t-1}\)</span>的相关性很低。</p>
<p>　　通过减少工具变量的使用，一定程度上可以避免弱工具变量问题。在 <code>xtabond</code> 命令中，可以使用 <code>maxldep(#)</code> 来限制工具变量的最大滞后阶数，进而达到限制工具变量总数的目的。例如，<code>xtabond y x, maxldep(5)</code> 意味着最多只用五个滞后项 (注意：不是五阶滞后)，即用<span class="math inline">\(y_{t-2}, \cdots y_{t-6}\)</span>作为的工具变量。</p>
<p>　　未使用 <code>maxldep()</code> 选项，GMM 式工具变量为 L(2/.).n，具体如下：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, twostep  lags(2)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, twostep  lags(2)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     41                  Wald chi2(15)     =    2282.22
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .6559667    .090028     7.29   0.000      .479515    .8324184
##          L2. |  -.0729992   .0270121    -2.70   0.007    -.1259419   -.0200566
##              |
##            w |
##          --. |  -.5132088   .0537642    -9.55   0.000    -.6185847   -.4078329
##          L1. |   .3289685   .0961446     3.42   0.001     .1405285    .5174085
##              |
##            k |
##          --. |   .2694384   .0438193     6.15   0.000     .1835541    .3553226
##          L1. |   .0216493    .050406     0.43   0.668    -.0771447    .1204432
##          L2. |  -.0409021   .0258317    -1.58   0.113    -.0915314    .0097271
##              |
##           ys |
##          --. |   .5917429   .1152412     5.13   0.000     .3658743    .8176115
##          L1. |   -.572021   .1396141    -4.10   0.000    -.8456596   -.2983825
##          L2. |   .1172642   .1136713     1.03   0.302    -.1055273    .3400558
##              |
##       yr1980 |   .0092621   .0107871     0.86   0.391    -.0118802    .0304044
##       yr1981 |  -.0347086   .0198697    -1.75   0.081    -.0736524    .0042352
##       yr1982 |  -.0432807   .0210895    -2.05   0.040    -.0846155    -.001946
##       yr1983 |  -.0277604   .0214655    -1.29   0.196     -.069832    .0143112
##       yr1984 |  -.0335613   .0224111    -1.50   0.134    -.0774862    .0103636
##        _cons |   .4939961   .4692208     1.05   0.292    -.4256597    1.413652
## ------------------------------------------------------------------------------
## Warning: gmm two-step standard errors are biased; robust standard 
##          errors are recommended.
## Instruments for differenced equation
##         GMM-type: L(2/.).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons</code></pre>
<p>　　使用 <code>maxldep()</code> 选项，GMM 式工具变量为 L(2/6).n，具体如下：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可能无法执行
xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, twostep lags(2) maxldep(5)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta, clear  // 部分版本的 Stata 可
## &gt; 能无法执行
## 
## . xtabond n L(0/1).w L(0/2).(k ys) yr1980-yr1984, twostep lags(2) maxldep(5)
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        611
## Group variable: id                              Number of groups  =        140
## Time variable: year
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =   4.364286
##                                                               max =          6
## 
## Number of instruments =     38                  Wald chi2(15)     =    1843.96
##                                                 Prob &gt; chi2       =     0.0000
## Two-step results
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .5854843   .1062933     5.51   0.000     .3771534    .7938153
##          L2. |  -.0805184   .0288507    -2.79   0.005    -.1370648   -.0239721
##              |
##            w |
##          --. |  -.4369707   .0760305    -5.75   0.000    -.5859878   -.2879537
##          L1. |   .2528305   .0959151     2.64   0.008     .0648403    .4408206
##              |
##            k |
##          --. |   .2659076   .0450423     5.90   0.000     .1776262     .354189
##          L1. |   .0394752   .0497403     0.79   0.427     -.058014    .1369644
##          L2. |   -.017932   .0258467    -0.69   0.488    -.0685906    .0327267
##              |
##           ys |
##          --. |   .5715325   .1117376     5.11   0.000     .3525308    .7905342
##          L1. |  -.4604796   .1366239    -3.37   0.001    -.7282576   -.1927017
##          L2. |   .0547907   .1124724     0.49   0.626    -.1656511    .2752325
##              |
##       yr1980 |   .0097911   .0105767     0.93   0.355    -.0109388     .030521
##       yr1981 |  -.0336555   .0196558    -1.71   0.087    -.0721802    .0048692
##       yr1982 |  -.0479059   .0222387    -2.15   0.031     -.091493   -.0043188
##       yr1983 |  -.0350422   .0237936    -1.47   0.141    -.0816767    .0115924
##       yr1984 |  -.0417783    .024778    -1.69   0.092    -.0903423    .0067857
##        _cons |   .4618009   .5413447     0.85   0.394    -.5992152    1.522817
## ------------------------------------------------------------------------------
## Warning: gmm two-step standard errors are biased; robust standard 
##          errors are recommended.
## Instruments for differenced equation
##         GMM-type: L(2/6).n
##         Standard: D.w LD.w D.k LD.k L2D.k D.ys LD.ys L2D.ys D.yr1980
##                   D.yr1981 D.yr1982 D.yr1983 D.yr1984
## Instruments for level equation
##         Standard: _cons</code></pre>
<p>　　使用其他动态面板回归命令的方法：</p>
<ul>
<li><code>xtdpd</code> 命令：使用 <code>dgmmiv(n, lagrange(2 5))</code>，将被解释变量的 2-5 阶滞后项作为 的工具变量；<br />
</li>
<li><code>xtabond2</code> 命令：使用 <code>gmm(l.n, laglimits(2 5) collapse))</code>，<code>laglimits()</code> 限制滞后项的阶数，<code>collapse</code> 系统自动删减工具变量；<br />
</li>
<li><code>xtdpdsys</code> 命令：使用 <code>maxldep(5)</code>，表示最多使用被解释变量的 5 阶滞后作为工具变量。</li>
</ul>
</div>
<div id="大t小n型面板数据" class="section level3">
<h3>大T小N型面板数据</h3>
<p>　　上面介绍的 FD-GMM 和 SYS-GMM 适用于 大 N 小 T 的短面板数据，当研究样本为长面板数据 (大 T 小 N) 时，比如省级面板数据，GMM 估计可能不是最有效的。根据 Bruno(2005) 的做法，基于 Bootstrap 偏差纠正的 LSDV 估计可以在一定程度上克服 N 较小的问题。</p>
<p>　　下面，将通过一个模拟例子，来对 FD-GMM、SYS-GMM 和 bias corrected LSDV 的估计效果进行比较。</p>
<p>　　<strong>数据生成过程 (DPG)</strong>。该面板数据包含 10 个个体的 60 期数据，即<span class="math inline">\(N=10\)</span>，<span class="math inline">\(T=60\)</span>，变量具体构造如下：<br />
　　
<span class="math display">\[
\begin{array}{c}
y_{i t}=0.9 y_{i t-1}+0.8 x_{i, t}+u_{i}+u_{t}+e_{i t-1} \\
\cot \alpha\left(x_{i t}, u_{i}\right) \neq 0 \\
x_{i t}=0.2 x_{i t-1}+v_{i t}
\end{array}  \tag{72}
\]</span></p>
<p>　　对应 Stata 命令：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
clear all
*help xtarsim //  xtarsim 是模拟生成面板数据的命令
xtarsim y x eta, n(10) t(60) gamma(0.9) beta(0.8) rho(0.2) one(corr 1) sn(9) seed(1234)

*模型估计

*用 xtabond 和 xtdpdsys 命令进行 FD-GMM 和 SYS-GMM 估计：

xtabond y x
est store FdGMM
xtdpdsys y x
est store SysGMM

*用 xtlsdvc 命令进行 bias corrected LSDV 估计：
*help xtlsdvc // 外部命令，需要下载安装词命令
xtlsdvc y x, initial(ab)  vcov(50)  // vcov(50) 计算标准误、显著性，需要较长等待时间
*initial(ab) 表示选择 Arellano 和 Bond (1991) 提出的 FD-GMM 估计为偏差纠正的初始量
est store LSDVab
xtlsdvc y x, initial(bb)  vcov(50)  // vcov(50) 计算标准误、显著性，需要较长等待时间
*initial(ab) 表示选择 Blundell 和 Bond (1998) 提出的 Sys-GMM 估计为偏差纠正的初始量
est store LSDVbb

local mm &quot;FdGMM SysGMM LSDVab LSDVbb&quot;
esttab `mm&#39;, mtitle(`mm&#39;) compress star(* 0.1 ** 0.05 *** 0.01)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. clear all
## 
## . *help xtarsim //  xtarsim 是模拟生成面板数据的命令
## . xtarsim y x eta, n(10) t(60) gamma(0.9) beta(0.8) rho(0.2) one(corr 1) sn(9) 
## &gt; seed(1234)
## 
## . 
## . *模型估计
## . 
## . *用 xtabond 和 xtdpdsys 命令进行 FD-GMM 和 SYS-GMM 估计：
## . 
## . xtabond y x
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        580
## Group variable: ivar                            Number of groups  =         10
## Time variable: tvar
##                                                 Obs per group:
##                                                               min =         58
##                                                               avg =         58
##                                                               max =         58
## 
## Number of instruments =    537                  Wald chi2(2)      =    2875.59
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .8736185      .0173    50.50   0.000     .8397111    .9075259
##              |
##            x |    .841614   .0438233    19.20   0.000     .7557218    .9275061
##        _cons |   .1054184   .0453136     2.33   0.020     .0166054    .1942313
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).y
##         Standard: D.x
## Instruments for level equation
##         Standard: _cons
## 
## . est store FdGMM
## 
## . xtdpdsys y x
## 
## System dynamic panel-data estimation            Number of obs     =        590
## Group variable: ivar                            Number of groups  =         10
## Time variable: tvar
##                                                 Obs per group:
##                                                               min =         59
##                                                               avg =         59
##                                                               max =         59
## 
## Number of instruments =    595                  Wald chi2(2)      =    3598.90
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .8703406   .0156014    55.79   0.000     .8397624    .9009187
##              |
##            x |   .8632184   .0412096    20.95   0.000      .782449    .9439877
##        _cons |   .1086252    .044803     2.42   0.015     .0208131    .1964374
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).y
##         Standard: D.x
## Instruments for level equation
##         GMM-type: LD.y
##         Standard: _cons
## 
## . est store SysGMM
## 
## . 
## . *用 xtlsdvc 命令进行 bias corrected LSDV 估计：
## . *help xtlsdvc // 外部命令，需要下载安装词命令
## . xtlsdvc y x, initial(ab)  vcov(50)  // vcov(50) 计算标准误、显著性，需要较长
## &gt; 等待时间
## Note: Bias correction initialized by Arellano and Bond estimator
## note: Bias correction up to order O(1/T)
## 
## LSDVC dynamic regression
## (bootstrapped SE)
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .8943684   .0163129    54.83   0.000     .8623957    .9263411
##              |
##            x |   .8357753   .0384893    21.71   0.000     .7603377    .9112128
## ------------------------------------------------------------------------------
## 
## . *initial(ab) 表示选择 Arellano 和 Bond (1991) 提出的 FD-GMM 估计为偏差纠正的
## &gt; 初始量
## . est store LSDVab
## 
## . xtlsdvc y x, initial(bb)  vcov(50)  // vcov(50) 计算标准误、显著性，需要较长
## &gt; 等待时间
## Note: Bias correction initialized by Blundell and Bond estimator
## 
## Note: Blundell and Bond estimator is implemented through
##       the user-written Stata command -xtabond2- by David Roodman,
##       Center for Global Development, Washington, DC droodman@cgdev.org
## note: Bias correction up to order O(1/T)
## 
## LSDVC dynamic regression
## (bootstrapped SE)
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .8958639   .0161953    55.32   0.000     .8641218    .9276061
##              |
##            x |   .8367735   .0384765    21.75   0.000     .7613609     .912186
## ------------------------------------------------------------------------------
## 
## . *initial(ab) 表示选择 Blundell 和 Bond (1998) 提出的 Sys-GMM 估计为偏差纠正的
## &gt; 初始量
## . est store LSDVbb
## 
## . 
## . local mm &quot;FdGMM SysGMM LSDVab LSDVbb&quot;
## 
## . esttab `mm&#39;, mtitle(`mm&#39;) compress star(* 0.1 ** 0.05 *** 0.01)
## 
## --------------------------------------------------------------
##                  (1)          (2)          (3)          (4)   
##                FdGMM       SysGMM       LSDVab       LSDVbb   
## --------------------------------------------------------------
## L.y            0.874***     0.870***     0.894***     0.896***
##              (50.50)      (55.79)      (54.83)      (55.32)   
## 
## x              0.842***     0.863***     0.836***     0.837***
##              (19.20)      (20.95)      (21.71)      (21.75)   
## 
## _cons          0.105**      0.109**                           
##               (2.33)       (2.42)                             
## --------------------------------------------------------------
## N                580          590          590          590   
## --------------------------------------------------------------
## t statistics in parentheses
## * p&lt;0.1, ** p&lt;0.05, *** p&lt;0.01</code></pre>
<p>　　把数据模拟中的<span class="math inline">\(y_{i t-1}\)</span>的系数由0.9变为0.4，重复上述过程，再对估计结果进行比较。</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
clear all
xtarsim y x eta, n(10) t(60) gamma(0.4) beta(0.8) rho(0.2) one(corr 1) sn(9) seed(1234)
xtabond y x
est store FdGMM
xtdpdsys y x
est store SysGMM
xtlsdvc y x, initial(ab)  vcov(50)  
est store LSDVab
xtlsdvc y x, initial(bb)  vcov(50)
est store LSDVbb
local mm &quot;FdGMM SysGMM LSDVab LSDVbb&quot;
esttab `mm&#39;, mtitle(`mm&#39;) compress star(* 0.1 ** 0.05 *** 0.01)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. clear all
## 
## . xtarsim y x eta, n(10) t(60) gamma(0.4) beta(0.8) rho(0.2) one(corr 1) sn(9) 
## &gt; seed(1234)
## 
## . xtabond y x
## 
## Arellano-Bond dynamic panel-data estimation     Number of obs     =        580
## Group variable: ivar                            Number of groups  =         10
## Time variable: tvar
##                                                 Obs per group:
##                                                               min =         58
##                                                               avg =         58
##                                                               max =         58
## 
## Number of instruments =    537                  Wald chi2(2)      =    4463.34
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .3932585   .0141851    27.72   0.000     .3654562    .4210608
##              |
##            x |   .8121598    .013978    58.10   0.000     .7847635    .8395562
##        _cons |   .5892885   .0452181    13.03   0.000     .5006628    .6779143
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).y
##         Standard: D.x
## Instruments for level equation
##         Standard: _cons
## 
## . est store FdGMM
## 
## . xtdpdsys y x
## 
## System dynamic panel-data estimation            Number of obs     =        590
## Group variable: ivar                            Number of groups  =         10
## Time variable: tvar
##                                                 Obs per group:
##                                                               min =         59
##                                                               avg =         59
##                                                               max =         59
## 
## Number of instruments =    595                  Wald chi2(2)      =    5416.17
##                                                 Prob &gt; chi2       =     0.0000
## One-step results
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .3897831   .0121452    32.09   0.000      .365979    .4135872
##              |
##            x |   .8124574   .0131089    61.98   0.000     .7867644    .8381503
##        _cons |    .592581   .0446175    13.28   0.000     .5051323    .6800296
## ------------------------------------------------------------------------------
## Instruments for differenced equation
##         GMM-type: L(2/.).y
##         Standard: D.x
## Instruments for level equation
##         GMM-type: LD.y
##         Standard: _cons
## 
## . est store SysGMM
## 
## . xtlsdvc y x, initial(ab)  vcov(50)  
## Note: Bias correction initialized by Arellano and Bond estimator
## note: Bias correction up to order O(1/T)
## 
## LSDVC dynamic regression
## (bootstrapped SE)
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .3958392    .014853    26.65   0.000     .3667278    .4249506
##              |
##            x |   .8119327   .0120082    67.61   0.000      .788397    .8354683
## ------------------------------------------------------------------------------
## 
## . est store LSDVab
## 
## . xtlsdvc y x, initial(bb)  vcov(50)
## Note: Bias correction initialized by Blundell and Bond estimator
## 
## Note: Blundell and Bond estimator is implemented through
##       the user-written Stata command -xtabond2- by David Roodman,
##       Center for Global Development, Washington, DC droodman@cgdev.org
## note: Bias correction up to order O(1/T)
## 
## LSDVC dynamic regression
## (bootstrapped SE)
## ------------------------------------------------------------------------------
##            y |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            y |
##          L1. |   .3960718   .0151407    26.16   0.000     .3663967     .425747
##              |
##            x |   .8119087   .0122909    66.06   0.000     .7878189    .8359984
## ------------------------------------------------------------------------------
## 
## . est store LSDVbb
## 
## . local mm &quot;FdGMM SysGMM LSDVab LSDVbb&quot;
## 
## . esttab `mm&#39;, mtitle(`mm&#39;) compress star(* 0.1 ** 0.05 *** 0.01)
## 
## --------------------------------------------------------------
##                  (1)          (2)          (3)          (4)   
##                FdGMM       SysGMM       LSDVab       LSDVbb   
## --------------------------------------------------------------
## L.y            0.393***     0.390***     0.396***     0.396***
##              (27.72)      (32.09)      (26.65)      (26.16)   
## 
## x              0.812***     0.812***     0.812***     0.812***
##              (58.10)      (61.98)      (67.61)      (66.06)   
## 
## _cons          0.589***     0.593***                          
##              (13.03)      (13.28)                             
## --------------------------------------------------------------
## N                580          590          590          590   
## --------------------------------------------------------------
## t statistics in parentheses
## * p&lt;0.1, ** p&lt;0.05, *** p&lt;0.01</code></pre>
<p>　　可以看出，当<span class="math inline">\(y_{i t-1}\)</span>的系数为 0.4， <code>XTLSDVC</code> 的优势非常有限；而当<span class="math inline">\(y_{i t-1}\)</span>的系数为 0.9 时，<code>XTLSDVC</code> 的优势比较明显。</p>
</div>
</div>
<div id="xtdpdgmm动态面板数据模型一网打尽" class="section level2">
<h2>xtdpdgmm：动态面板数据模型一网打尽</h2>
<div id="简介" class="section level3">
<h3>简介</h3>
<p>　　对于动态面板数据模型 (Dynamic Panel Data, DPD)，直接用最小二乘法估计是有偏的，为解决这一问题，Arellano 和 Bond (1991)、 Arellano 和 Bover (1995)、以及 Blundell 和 Bond (1998) 等提出了「一阶差分 GMM (FD-GMM)」和「系统 GMM (SYS-GMM)」估计法。</p>
<p>　　相应地，Stata 也提供了 <code>xtabond</code>、<code>xtdpdsys</code>、以及 <code>xtabond2</code> 等早期估计 GMM 的命令。Kripfganz (2019) 在此基础上，编写了 <code>xtdpdgmm</code> 命令，该命令解决了 <code>xtabond2</code> 等命令的一些缺陷，并使估计更加灵活。特别的，该命令整合了 Ahn 和 Schmidt (1995) 非线性矩条件、更好解决了高度自相关问题、以及提供了 Hansen 等 (1996) 的迭代 GMM 估计。</p>
<p>　　本文的主要目的是介绍动态面板数据模型的两种估计方法，以及 <code>xtdpdgmm</code> 命令的应用<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>。</p>
</div>
<div id="估计方法-1" class="section level3">
<h3>估计方法</h3>
<div id="差分-gmm" class="section level4">
<h4>差分 GMM</h4>
<p>　　考虑以下动态面板模型：<br />
　　
<span class="math display">\[
y_{i t}=\alpha+\rho y_{i, t-1}+\boldsymbol{x}_{i i}^{\prime} \boldsymbol{\beta}+z_{i}^{\prime} \boldsymbol{\delta}+u_{i}+\varepsilon_{i t} \quad(t=2, \cdots, T)  \tag{73}
\]</span></p>
<p>　　通过一阶差分消去个体效应<span class="math inline">\(u_{i}\)</span>，可得：</p>
<p><span class="math display">\[
\Delta y_{i t}=\rho \Delta y_{i, t-1}+\Delta x_{i t}^{\prime} \beta+\Delta \varepsilon_{i t} \quad(t=2, \cdots, T)  \tag{74}
\]</span></p>
<p>　　然而，由于<span class="math inline">\(y_{i, t-1}\)</span>与<span class="math inline">\(\varepsilon_{i t-1}\)</span>相关， 使得<span class="math inline">\(\Delta y_{i, t-1} \equiv y_{i, t-1}-y_{i, t-2}\)</span>与<span class="math inline">\(\Delta \varepsilon_{i, t} \equiv \varepsilon_{i, t}-\varepsilon_{i, t-1}\)</span>相关。也因此， 为内生变量，我们需要为其找到适当的工具变量才能得到一致估计。</p>
<p>　　为此，Anderson 和 Hsiao (1981) 认为由于<span class="math inline">\(y_{i, t-2}\)</span>与<span class="math inline">\(\Delta y_{i, t-1} \equiv y_{i, t-1}-y_{i, t-2}\)</span>相关，若<span class="math inline">\(\varepsilon_{i}\)</span>不存在自相关，则<span class="math inline">\(y_{i, t-2}\)</span>与<span class="math inline">\(\Delta \varepsilon_{i, t} \equiv \varepsilon_{i, t}-\varepsilon_{i, t-1}\)</span>不相关，故<span class="math inline">\(y_{i, t-2}\)</span>是<span class="math inline">\(\Delta y_{i, t-1}\)</span> 的有效工具变量。根据这一思想，更高阶的滞后变量<span class="math inline">\({y_{i, t-3},y_{i, t-4},...}\)</span> 也是有效工具变量，但是Anderson 和 Hsiao (1981) 估计并未加以利用，所以估计并非最有效。</p>
<p>　　Arellano 和 Bond (1991) 使用所有可能的滞后变量作为工具变量 (工具变量个数可能多于内生变量) 进行估计，这一方法又被称为「差分 GMM」。值得注意的是，在使用差分 GMM 时，扰动项<span class="math inline">\(\varepsilon_{i}\)</span>不存在自相关，即 <span class="math inline">\(Cov(\varepsilon_{it},\varepsilon_{is})=0\)</span>。</p>
<p>　　<strong>差分 GMM 注意事项：</strong></p>
<ul>
<li><p>如果<span class="math inline">\(x_{it}\)</span>非严格外生，即虽然<span class="math inline">\(x_{it}\)</span>与当期<span class="math inline">\(\varepsilon_{it}\)</span>不相关，但与 <span class="math inline">\(\varepsilon_{it-1}\)</span>相关，则<span class="math inline">\(\Delta x_{i, t} \equiv x_{i, t}-x_{i, t-1}\)</span>与 <span class="math inline">\(\Delta \varepsilon_{i, t} \equiv \varepsilon_{i, t}-\varepsilon_{i, t-1}\)</span>相关，使得<span class="math inline">\(\Delta x_{i, t}\)</span>为内生变量。此时，可以使用<span class="math inline">\({x_{i, t-1},x_{i, t-2},...}\)</span>作为<span class="math inline">\(\Delta x_{i, t}\)</span>的工具变量。</p></li>
<li><p>如果T很大，则会有很多工具变量，进而容易产生弱工具变量问题。同时，也会弱化 Hansen 统计量，甚至出现p值等于1的不可信结果。解决方法一是在使用 <code>xtabond</code> 命令时，限制最多使用q阶滞后变量作为工具变量。方法二是使用折叠的 Ⅳ 式工具变量，而不使用展开的 GMM 式工具变量。</p></li>
<li><p>不随时间变化的变量<span class="math inline">\(z_{i}\)</span>被消掉了，故差分 GMM 无法估计<span class="math inline">\(z_{i}\)</span>的系数。</p></li>
<li><p>如果序列<span class="math inline">\(y_{i}\)</span>具有很强的持续性，即一阶自回归系数接近于1，则<span class="math inline">\(y_{i, t-2}\)</span>与<span class="math inline">\(\Delta y_{i, t-1} \equiv y_{i, t-1}-y_{i, t-2}\)</span> 的相关性可能很弱，进而导致弱工具变量问题。</p></li>
</ul>
</div>
<div id="水平-gmm" class="section level4">
<h4>水平 GMM</h4>
<p>　　为克服上述差分 GMM 将不随时间变化的变量<span class="math inline">\(z_{i}\)</span>消掉、以及序列具有很强的持续性等问题，Arellano 和 Bover(1995)重新回到了差分之前的水平方程，并使用<span class="math inline">\({\Delta{y_{i, t-1},\Delta y_{i, t-2},...}}\)</span>作为<span class="math inline">\(y_{i, t-1}\)</span>的工具变量。但前提是需假设<span class="math inline">\(\varepsilon_{i}\)</span> 不存在自相关，以及<span class="math inline">\({\Delta{y_{i, t-1},\Delta y_{i, t-2},...}}\)</span>与个体效应<span class="math inline">\(u_{i}\)</span>不相关。上述过程也被称为「水平 GMM」。</p>
</div>
<div id="系统-gmm" class="section level4">
<h4>系统 GMM</h4>
<p>　　Blundell 和 Bond (1998) 将差分GMM与水平GMM联合进行GMM估计，即「系统GMM」。与差分GMM相比，系统 GMM的优点是，可以提高估计的效率，并且可以估计不随时间变化的变量的系数。其缺点是，必须假定以及<span class="math inline">\({\Delta{y_{i, t-1},\Delta y_{i, t-2},...}}\)</span>与个体效应<span class="math inline">\(u_{i}\)</span>无关。</p>
</div>
</div>
<div id="xtdpdgmm-命令介绍" class="section level3">
<h3>xtdpdgmm 命令介绍</h3>
<div id="xtdpdgmm-命令语法" class="section level4">
<h4>xtdpdgmm 命令语法</h4>
<p><code>xtdpdgmm</code> 命令的安装：</p>
<pre><code>ssc install xtdpdgmm, replace  </code></pre>
<p><code>xtdpdgmm</code> 命令的语法：</p>
<pre><code> xtdpdgmm depvar [indepvars] [if] [in] [, options]</code></pre>
<p>　　其中，<code>option</code> 具体选项如下：</p>
<ul>
<li><code>iv(iv_spec)</code>：指定标准式工具变量，并可指定任意多次；</li>
<li><code>gmmiv(gmmiv_spec)</code>：指定 GMM 式工具变量，并可指定任意多次；</li>
<li><code>nl (nl_spec)</code>：添加由误差协方差结构得出的非线性矩条件；</li>
<li><code>collapse</code>：折叠式工具变量为标准式工具变量；</li>
<li><code>model(model_spec)</code>：设置工具变量的默认形式及标准误；</li>
<li><code>norescale</code>：不重新缩放转换后的矩条件；</li>
<li><code>wmatrix(wmat_spec)</code>：指定用于获得一阶 GMM 估计或两步 GMM估计的初始估计的加权矩阵；</li>
<li><code>onestep|twostep</code>：确定一步估计或两步估计；</li>
<li><code>igmm</code>：使用迭代 GMM 估计;</li>
<li><code>teffects</code>：模型增加时间效应；</li>
<li><code>overid</code>：计算简化模型的过度识别统计信息；</li>
<li><code>noconstant</code>：无常数项；</li>
<li><code>vce(vce_spec)</code>：设置聚类标准误的估计方式进行稳健标准误估计；</li>
<li><code>auxiliary</code>：显示所有系数作为辅助参数；</li>
<li><code>level(#)</code>：设置置信区间，默认为水平为 95%；</li>
<li><code>small</code>：进行自由度调整并报告小样本统计数据；</li>
<li><code>coeflegend</code>：显示图例而不是统计信息；</li>
<li><code>noheader</code>：不显示输出表头；</li>
<li><code>notable</code>：不显示输出系数表；</li>
<li><code>nofootnote</code>：不显示系数表下脚注；</li>
<li><code>display_options</code>：控制列和列的格式，行间距，行宽，需要省略的变量以及基础空白单元格、因子变量的标记；</li>
<li><code>noanalytic</code>：不使用解析封闭解。</li>
<li><code>from(init_spec)</code>：确定系数的初始值；</li>
<li><code>nodots</code>：在迭代 GMM 估计中的每个步骤中显示迭代日志，而不是点；</li>
<li><code>igmm_options</code>：控制迭代的 GMM 过程；</li>
<li><code>minimize_options</code>：控制最小化过程。</li>
</ul>
</div>
<div id="xtdpdgmm-命令实操" class="section level4">
<h4>xtdpdgmm 命令实操</h4>
<p>　　以 abdata.dta 数据集为例，该数据集是 140 个国家 1976 年到 1984 年的各种宏观指标的面板数据。<strong>id</strong> 代表每个国家的标号，<strong>year</strong> 代表年份，其他变量包括就业率 <strong>emp</strong>、平均工资 <strong>wage</strong>、投资占 GDP 的百分比 <strong>cap</strong> 等。</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
describe          //数据结构
sum               //描述性统计
xtset id year     //声明面板数据
</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . describe          //数据结构
## 
## Contains data from E:\Mirror\StataLearn\StataData\abdata.dta
##   obs:         1,031                          
##  vars:            30                          1 Dec 2020 15:57
## -------------------------------------------------------------------------------
##               storage   display    value
## variable name   type    format     label      variable label
## -------------------------------------------------------------------------------
## c1              str9    %9s                   
## ind             float   %9.0g                 
## year            float   %9.0g                 
## emp             float   %9.0g                 
## wage            float   %9.0g                 
## cap             float   %9.0g                 
## indoutpt        float   %9.0g                 
## n               float   %9.0g                 
## w               float   %9.0g                 
## k               float   %9.0g                 
## ys              float   %9.0g                 
## rec             float   %9.0g                 
## yearm1          float   %9.0g                 
## id              float   %9.0g                 
## nL1             float   %9.0g                 
## nL2             float   %9.0g                 
## wL1             float   %9.0g                 
## kL1             float   %9.0g                 
## kL2             float   %9.0g                 
## ysL1            float   %9.0g                 
## ysL2            float   %9.0g                 
## yr1976          byte    %8.0g                 year==1976
## yr1977          byte    %8.0g                 year==1977
## yr1978          byte    %8.0g                 year==1978
## yr1979          byte    %8.0g                 year==1979
## yr1980          byte    %8.0g                 year==1980
## yr1981          byte    %8.0g                 year==1981
## yr1982          byte    %8.0g                 year==1982
## yr1983          byte    %8.0g                 year==1983
## yr1984          byte    %8.0g                 year==1984
## -------------------------------------------------------------------------------
## Sorted by: id  year
## 
## . sum               //描述性统计
## 
##     Variable |        Obs        Mean    Std. Dev.       Min        Max
## -------------+---------------------------------------------------------
##           c1 |          0
##          ind |      1,031    5.123181    2.678095          1          9
##         year |      1,031    1979.651     2.21607       1976       1984
##          emp |      1,031    7.891677    15.93492       .104    108.562
##         wage |      1,031     23.9188    5.648418     8.0171    45.2318
## -------------+---------------------------------------------------------
##          cap |      1,031    2.507432    6.248712      .0119    47.1079
##     indoutpt |      1,031    103.8012    9.938008       86.9   128.3653
##            n |      1,031    1.056002    1.341506  -2.263364   4.687321
##            w |      1,031    3.142988    .2630081   2.081577     3.8118
##            k |      1,031   -.4415775    1.514132  -4.431217   3.852441
## -------------+---------------------------------------------------------
##           ys |      1,031    4.638015    .0939611   4.464758    4.85488
##          rec |      1,031         516    297.7684          1       1031
##       yearm1 |      1,031    1979.644    2.213454       1976       1984
##           id |      1,031    73.20369    41.23333          1        140
##          nL1 |        891    1.083518    1.338469  -2.095571   4.687321
## -------------+---------------------------------------------------------
##          nL2 |        751    1.107716    1.333478  -2.079442   4.687321
##          wL1 |        891    3.132166    .2639638   2.081577     3.8118
##          kL1 |        891   -.4131872    1.501461  -4.431217   3.852441
##          kL2 |        751    -.392113    1.486371  -4.431217   3.852441
##         ysL1 |        891    4.651039    .0923352   4.464758    4.85488
## -------------+---------------------------------------------------------
##         ysL2 |        751     4.67097        .085   4.490414    4.85488
##       yr1976 |      1,031    .0775946    .2676624          0          1
##       yr1977 |      1,031    .1338506     .340657          0          1
##       yr1978 |      1,031    .1357905    .3427322          0          1
##       yr1979 |      1,031    .1357905    .3427322          0          1
## -------------+---------------------------------------------------------
##       yr1980 |      1,031    .1357905    .3427322          0          1
##       yr1981 |      1,031    .1357905    .3427322          0          1
##       yr1982 |      1,031    .1357905    .3427322          0          1
##       yr1983 |      1,031    .0756547    .2645732          0          1
##       yr1984 |      1,031    .0339476    .1811823          0          1
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## .</code></pre>
</div>
<div id="一阶差分-gmm-估计" class="section level4">
<h4>一阶差分 GMM 估计：</h4>
<p>　　差分 GMM 一步估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, model(diff) gmm(n, lag(2 .)) gmm(w, lag(1 .)) gmm(k, lag(. .)) nocons </code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, model(diff) gmm(n, lag(2 .)) gmm(w, lag(1 .)) gmm(k, l
## &gt; ag(. .)) nocons 
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  .01960406
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =     126      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =     126                        max =         8
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .4144164   .0341502    12.14   0.000     .3474833    .4813495
##              |
##            w |  -.8292293   .0588914   -14.08   0.000    -.9446543   -.7138042
##            k |   .3929936   .0223829    17.56   0.000     .3491239    .4368634
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    1978:L2.n 1979:L2.n 1980:L2.n 1981:L2.n 1982:L2.n 1983:L2.n 1984:L2.n
##    1979:L3.n 1980:L3.n 1981:L3.n 1982:L3.n 1983:L3.n 1984:L3.n 1980:L4.n
##    1981:L4.n 1982:L4.n 1983:L4.n 1984:L4.n 1981:L5.n 1982:L5.n 1983:L5.n
##    1984:L5.n 1982:L6.n 1983:L6.n 1984:L6.n 1983:L7.n 1984:L7.n 1984:L8.n
##  2, model(diff):
##    1978:L1.w 1979:L1.w 1980:L1.w 1981:L1.w 1982:L1.w 1983:L1.w 1984:L1.w
##    1978:L2.w 1979:L2.w 1980:L2.w 1981:L2.w 1982:L2.w 1983:L2.w 1984:L2.w
##    1979:L3.w 1980:L3.w 1981:L3.w 1982:L3.w 1983:L3.w 1984:L3.w 1980:L4.w
##    1981:L4.w 1982:L4.w 1983:L4.w 1984:L4.w 1981:L5.w 1982:L5.w 1983:L5.w
##    1984:L5.w 1982:L6.w 1983:L6.w 1984:L6.w 1983:L7.w 1984:L7.w 1984:L8.w
##  3, model(diff):
##    1978:F6.k 1978:F5.k 1979:F5.k 1978:F4.k 1979:F4.k 1980:F4.k 1978:F3.k
##    1979:F3.k 1980:F3.k 1981:F3.k 1978:F2.k 1979:F2.k 1980:F2.k 1981:F2.k
##    1982:F2.k 1978:F1.k 1979:F1.k 1980:F1.k 1981:F1.k 1982:F1.k 1983:F1.k
##    1978:k 1979:k 1980:k 1981:k 1982:k 1983:k 1984:k 1978:L1.k 1979:L1.k
##    1980:L1.k 1981:L1.k 1982:L1.k 1983:L1.k 1984:L1.k 1978:L2.k 1979:L2.k
##    1980:L2.k 1981:L2.k 1982:L2.k 1983:L2.k 1984:L2.k 1979:L3.k 1980:L3.k
##    1981:L3.k 1982:L3.k 1983:L3.k 1984:L3.k 1980:L4.k 1981:L4.k 1982:L4.k
##    1983:L4.k 1984:L4.k 1981:L5.k 1982:L5.k 1983:L5.k 1984:L5.k 1982:L6.k
##    1983:L6.k 1984:L6.k 1983:L7.k 1984:L7.k 1984:L8.k</code></pre>
<p>　　差分 GMM 两步估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, model(diff) gmm(n, lag(2 .)) gmm(w, lag(1 .)) gmm(k, lag(. .)) nocons two vce(r) 
*序列相关检验
estat serial
*过度识别检验
estat overid</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, model(diff) gmm(n, lag(2 .)) gmm(w, lag(1 .)) gmm(k, l
## &gt; ag(. .)) nocons two vce(r) 
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  .01960406
## Step 2         f(b) =  .90967907
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =     126      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =     126                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .4126102   .0740255     5.57   0.000     .2675228    .5576976
##              |
##            w |  -.8271943   .0944749    -8.76   0.000    -1.012362   -.6420268
##            k |   .3931545   .0484993     8.11   0.000     .2980975    .4882114
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    1978:L2.n 1979:L2.n 1980:L2.n 1981:L2.n 1982:L2.n 1983:L2.n 1984:L2.n
##    1979:L3.n 1980:L3.n 1981:L3.n 1982:L3.n 1983:L3.n 1984:L3.n 1980:L4.n
##    1981:L4.n 1982:L4.n 1983:L4.n 1984:L4.n 1981:L5.n 1982:L5.n 1983:L5.n
##    1984:L5.n 1982:L6.n 1983:L6.n 1984:L6.n 1983:L7.n 1984:L7.n 1984:L8.n
##  2, model(diff):
##    1978:L1.w 1979:L1.w 1980:L1.w 1981:L1.w 1982:L1.w 1983:L1.w 1984:L1.w
##    1978:L2.w 1979:L2.w 1980:L2.w 1981:L2.w 1982:L2.w 1983:L2.w 1984:L2.w
##    1979:L3.w 1980:L3.w 1981:L3.w 1982:L3.w 1983:L3.w 1984:L3.w 1980:L4.w
##    1981:L4.w 1982:L4.w 1983:L4.w 1984:L4.w 1981:L5.w 1982:L5.w 1983:L5.w
##    1984:L5.w 1982:L6.w 1983:L6.w 1984:L6.w 1983:L7.w 1984:L7.w 1984:L8.w
##  3, model(diff):
##    1978:F6.k 1978:F5.k 1979:F5.k 1978:F4.k 1979:F4.k 1980:F4.k 1978:F3.k
##    1979:F3.k 1980:F3.k 1981:F3.k 1978:F2.k 1979:F2.k 1980:F2.k 1981:F2.k
##    1982:F2.k 1978:F1.k 1979:F1.k 1980:F1.k 1981:F1.k 1982:F1.k 1983:F1.k
##    1978:k 1979:k 1980:k 1981:k 1982:k 1983:k 1984:k 1978:L1.k 1979:L1.k
##    1980:L1.k 1981:L1.k 1982:L1.k 1983:L1.k 1984:L1.k 1978:L2.k 1979:L2.k
##    1980:L2.k 1981:L2.k 1982:L2.k 1983:L2.k 1984:L2.k 1979:L3.k 1980:L3.k
##    1981:L3.k 1982:L3.k 1983:L3.k 1984:L3.k 1980:L4.k 1981:L4.k 1982:L4.k
##    1983:L4.k 1984:L4.k 1981:L5.k 1982:L5.k 1983:L5.k 1984:L5.k 1982:L6.k
##    1983:L6.k 1984:L6.k 1983:L7.k 1984:L7.k 1984:L8.k
## 
## . *序列相关检验
## . estat serial
## 
## Arellano-Bond test for autocorrelation of the first-differenced residuals
## H0: no autocorrelation of order 1:     z =   -3.8127   Prob &gt; |z|  =    0.0001
## H0: no autocorrelation of order 2:     z =   -0.8686   Prob &gt; |z|  =    0.3851
## 
## . *过度识别检验
## . estat overid
## 
## Sargan-Hansen test of the overidentifying restrictions
## H0: overidentifying restrictions are valid
## 
## 2-step moment functions, 2-step weighting matrix       chi2(123)   =  127.3551
##                                                        Prob &gt; chi2 =    0.3757
## 
## 2-step moment functions, 3-step weighting matrix       chi2(123)   =  127.6358
##                                                        Prob &gt; chi2 =    0.3691</code></pre>
</div>
</div>
<div id="差分-gmm-与系统-gmm-对比" class="section level3">
<h3>差分 GMM 与系统 GMM 对比</h3>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
*差分 GMM
xtdpdgmm L(0/1).n w k, model(diff) collapse gmm(n, lag(2 4)) gmm(w, lag(1 3))  gmm(k, lag(0 2)) nocons two vce(r)
estat serial, ar(1/3)
estat overid

*系统 GMM
xtdpdgmm L(0/1).n w k, model(diff) collapse gmm(n, lag(2 4)) gmm(w k, lag(1 3))  gmm(n, lag(1 1) diff model(level)) gmm(w k, lag(0 0) diff model(level)) two vce(r)
estat serial, ar(1/3)
estat overid</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . *差分 GMM
## . xtdpdgmm L(0/1).n w k, model(diff) collapse gmm(n, lag(2 4)) gmm(w, lag(1 3))
## &gt;   gmm(k, lag(0 2)) nocons two vce(r)
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =   .0006272
## Step 2         f(b) =  .08562737
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       9      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =       9                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .3564619   .1074848     3.32   0.001     .1457956    .5671281
##              |
##            w |  -1.432958   .2141048    -6.69   0.000    -1.852595    -1.01332
##            k |   .2860594   .0541221     5.29   0.000     .1799821    .3921367
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    L2.n L3.n L4.n
##  2, model(diff):
##    L1.w L2.w L3.w
##  3, model(diff):
##    k L1.k L2.k
## 
## . estat serial, ar(1/3)
## 
## Arellano-Bond test for autocorrelation of the first-differenced residuals
## H0: no autocorrelation of order 1:     z =   -2.6865   Prob &gt; |z|  =    0.0072
## H0: no autocorrelation of order 2:     z =   -0.9414   Prob &gt; |z|  =    0.3465
## H0: no autocorrelation of order 3:     z =   -0.3256   Prob &gt; |z|  =    0.7447
## 
## . estat overid
## 
## Sargan-Hansen test of the overidentifying restrictions
## H0: overidentifying restrictions are valid
## 
## 2-step moment functions, 2-step weighting matrix       chi2(6)     =   11.9878
##                                                        Prob &gt; chi2 =    0.0622
## 
## 2-step moment functions, 3-step weighting matrix       chi2(6)     =   12.8283
##                                                        Prob &gt; chi2 =    0.0458
## 
## . 
## . *系统 GMM
## . xtdpdgmm L(0/1).n w k, model(diff) collapse gmm(n, lag(2 4)) gmm(w k, lag(1 3
## &gt; ))  gmm(n, lag(1 1) diff model(level)) gmm(w k, lag(0 0) diff model(level)) t
## &gt; wo vce(r)
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  .00285146
## Step 2         f(b) =  .11568719
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =      13      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =      13                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .5117523   .1208484     4.23   0.000     .2748937    .7486109
##              |
##            w |  -1.323125   .2383451    -5.55   0.000    -1.790273    -.855977
##            k |   .1931365   .0941343     2.05   0.040     .0086367    .3776363
##        _cons |   4.698425   .7943584     5.91   0.000     3.141511    6.255339
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    L2.n L3.n L4.n
##  2, model(diff):
##    L1.w L2.w L3.w L1.k L2.k L3.k
##  3, model(level):
##    L1.D.n
##  4, model(level):
##    D.w D.k
##  5, model(level):
##    _cons
## 
## . estat serial, ar(1/3)
## 
## Arellano-Bond test for autocorrelation of the first-differenced residuals
## H0: no autocorrelation of order 1:     z =   -3.3341   Prob &gt; |z|  =    0.0009
## H0: no autocorrelation of order 2:     z =   -1.2436   Prob &gt; |z|  =    0.2136
## H0: no autocorrelation of order 3:     z =   -0.1939   Prob &gt; |z|  =    0.8462
## 
## . estat overid
## 
## Sargan-Hansen test of the overidentifying restrictions
## H0: overidentifying restrictions are valid
## 
## 2-step moment functions, 2-step weighting matrix       chi2(9)     =   16.1962
##                                                        Prob &gt; chi2 =    0.0629
## 
## 2-step moment functions, 3-step weighting matrix       chi2(9)     =   13.8077
##                                                        Prob &gt; chi2 =    0.1293</code></pre>
<div id="各估计方式呈现" class="section level4">
<h4>各估计方式呈现</h4>
<p>　　具有严格外生变量的 Anderson-Hsiao IV 估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, iv(L2.n w k, d) m(d) nocons
xtdpdgmm L(0/1).n w k, iv(L2.n) iv(w k, d) m(d) nocons</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, iv(L2.n w k, d) m(d) nocons
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  1.000e-32
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       3      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =       3                        max =         8
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .1512874   .1313926     1.15   0.250    -.1062374    .4088122
##              |
##            w |  -.5149142   .0512699   -10.04   0.000    -.6154013   -.4144271
##            k |   .4141651   .0468689     8.84   0.000     .3223038    .5060264
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    D.L2.n D.w D.k
## 
## . xtdpdgmm L(0/1).n w k, iv(L2.n) iv(w k, d) m(d) nocons
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  3.096e-32
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       3      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =       3                        max =         8
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   1.093635   .1414757     7.73   0.000      .816348    1.370922
##              |
##            w |  -.5565656   .0762891    -7.30   0.000    -.7060895   -.4070417
##            k |   .1353903   .0560407     2.42   0.016     .0255525    .2452282
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    L2.n
##  2, model(diff):
##    D.w D.k</code></pre>
<p>　　具有严格外生变量和工具变量约束的 Arellano-Bond 一步 GMM 估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, gmm(L.n, l(1 4) c) iv(w k, d) m(d) nocons</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, gmm(L.n, l(1 4) c) iv(w k, d) m(d) nocons
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  .00130087
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       6      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =       6                        max =         8
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .8602906   .0979689     8.78   0.000     .6682752    1.052306
##              |
##            w |  -.5922287    .065327    -9.07   0.000    -.7202672   -.4641902
##            k |   .2072601   .0434627     4.77   0.000     .1220748    .2924454
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    L1.L.n L2.L.n L3.L.n L4.L.n
##  2, model(diff):
##    D.w D.k</code></pre>
<p>　　具有前定变量和工具变量约束的 Arellano-Bover 两步 GMM 估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(0 3) c) m(fod) two vce(r)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(0 3) c) m(fod) two vce(r)
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  .00317868
## Step 2         f(b) =  .11805918
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =      13      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =      13                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .4582898   .1314203     3.49   0.000     .2007107    .7158688
##              |
##            w |  -1.607401   .3437998    -4.68   0.000    -2.281237   -.9335663
##            k |   .0878702   .1647289     0.53   0.594    -.2349925    .4107329
##        _cons |   5.644924   1.001522     5.64   0.000     3.681976    7.607871
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(fodev):
##    L.n L1.L.n L2.L.n L3.L.n w L1.w L2.w L3.w k L1.k L2.k L3.k
##  2, model(level):
##    _cons</code></pre>
<p>　　具有前定变量和工具变量约束的 Ahn-Schmidt 两步 GMM 估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(1 4) c) m(d) nl(noser) two vce(r)
xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(1 4) c) m(d) nl(iid) two vce(r)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(1 4) c) m(d) nl(noser) two vce(r)
## (140 missing values generated)
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## 
## Step 1:
## initial:       f(b) =  6.9689895
## alternative:   f(b) =  1.9358147
## rescale:       f(b) =  .09404104
## Iteration 0:   f(b) =  .09404104  
## Iteration 1:   f(b) =  .00092528  
## Iteration 2:   f(b) =  .00073988  
## Iteration 3:   f(b) =  .00073977  
## Iteration 4:   f(b) =  .00073977  
## 
## Step 2:
## Iteration 0:   f(b) =   .1213722  
## Iteration 1:   f(b) =  .10323966  
## Iteration 2:   f(b) =  .10315659  
## Iteration 3:   f(b) =    .103154  
## Iteration 4:   f(b) =   .1031539  
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =      13      Obs per group:    min =         6
##                     nonlinear =       6                        avg =  6.364286
##                         total =      19                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .4304133   .1198004     3.59   0.000     .1956088    .6652178
##              |
##            w |   -1.41989   .2825341    -5.03   0.000    -1.973647   -.8661332
##            k |   .1917874   .1248583     1.54   0.125    -.0529303    .4365051
##        _cons |   5.112359   .8521958     6.00   0.000     3.442086    6.782632
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    L1.L.n L2.L.n L3.L.n L4.L.n L1.w L2.w L3.w L4.w L1.k L2.k L3.k L4.k
##  2, model(level):
##    _cons
## 
## . xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(1 4) c) m(d) nl(iid) two vce(r)
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## 
## Step 1:
## initial:       f(b) =  7.1763841
## alternative:   f(b) =  2.0088687
## rescale:       f(b) =  .10682203
## Iteration 0:   f(b) =  .10682203  
## Iteration 1:   f(b) =  .00313745  
## Iteration 2:   f(b) =  .00214453  
## Iteration 3:   f(b) =  .00213797  
## Iteration 4:   f(b) =  .00213795  
## 
## Step 2:
## Iteration 0:   f(b) =  .22634011  
## Iteration 1:   f(b) =  .18572491  
## Iteration 2:   f(b) =  .18339137  
## Iteration 3:   f(b) =  .18323575  
## Iteration 4:   f(b) =  .18322289  
## Iteration 5:   f(b) =  .18322171  
## Iteration 6:   f(b) =   .1832216  
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =      19      Obs per group:    min =         6
##                     nonlinear =       7                        avg =  6.364286
##                         total =      26                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .3162345   .1040268     3.04   0.002     .1123458    .5201233
##              |
##            w |  -1.225117   .2050917    -5.97   0.000     -1.62709   -.8231451
##            k |   .3370022   .1265224     2.66   0.008     .0890228    .5849816
##        _cons |   4.729435   .6060333     7.80   0.000     3.541632    5.917239
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(iid):
##    1978:L.n 1979:L.n 1980:L.n 1981:L.n 1982:L.n 1983:L.n
##  2, model(diff):
##    L1.L.n L2.L.n L3.L.n L4.L.n L1.w L2.w L3.w L4.w L1.k L2.k L3.k L4.k
##  3, model(level):
##    _cons</code></pre>
<p>　　具有前定变量和工具变量约束的 Blundell-Bond 两步 GMM 估计:</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(1 4) c m(d)) iv(L.n w k, d) two vce(r)</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, gmm(L.n w k, l(1 4) c m(d)) iv(L.n w k, d) two vce(r)
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  .00329575
## Step 2         f(b) =  .16391388
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =      16      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =      16                        max =         8
## 
##                                    (Std. Err. adjusted for 140 clusters in id)
## ------------------------------------------------------------------------------
##              |              WC-Robust
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .4695086   .1167909     4.02   0.000     .2406028    .6984145
##              |
##            w |  -1.287266   .2672931    -4.82   0.000    -1.811151   -.7633817
##            k |   .2172426   .0913599     2.38   0.017     .0381805    .3963046
##        _cons |   4.633068   .8721846     5.31   0.000     2.923618    6.342518
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(diff):
##    L1.L.n L2.L.n L3.L.n L4.L.n L1.w L2.w L3.w L4.w L1.k L2.k L3.k L4.k
##  2, model(level):
##    D.L.n D.w D.k
##  3, model(level):
##    _cons</code></pre>
<p>　　具有前定变量的 Hayakawa-Qi-Breitung IV 估计量：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm L(0/1).n w k, iv(L.n w k, bod) m(fod) nocons</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm L(0/1).n w k, iv(L.n w k, bod) m(fod) nocons
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  1.737e-33
## 
## Group variable: id                           Number of obs         =       891
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       3      Obs per group:    min =         6
##                     nonlinear =       0                        avg =  6.364286
##                         total =       3                        max =         8
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            n |
##          L1. |   .4698431   .1508717     3.11   0.002     .1741401    .7655461
##              |
##            w |   -.682973   .3756931    -1.82   0.069    -1.419318    .0533719
##            k |  -.1261108    .339384    -0.37   0.710    -.7912913    .5390696
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(fodev):
##    B.L.n B.w B.k</code></pre>
<p>　　复制静态 (加权) 固定效应估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm n w k, iv(w k) m(md)
by id: egen weight = count(e(sample))
replace weight = sqrt(weight/(weight-1))
xtreg n w k [aw=weight], fe</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm n w k, iv(w k) m(md)
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  2.557e-25
## 
## Group variable: id                           Number of obs         =      1031
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       3      Obs per group:    min =         7
##                     nonlinear =       0                        avg =  7.364286
##                         total =       3                        max =         9
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            w |  -.3666355   .0522024    -7.02   0.000    -.4689504   -.2643207
##            k |   .6407201   .0200955    31.88   0.000     .6013336    .6801065
##        _cons |   2.491261   .1627504    15.31   0.000     2.172276    2.810246
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(mdev):
##    w k
##  2, model(level):
##    _cons
## 
## . by id: egen weight = count(e(sample))
## 
## . replace weight = sqrt(weight/(weight-1))
## (1,031 real changes made)
## 
## . xtreg n w k [aw=weight], fe
## 
## Fixed-effects (within) regression               Number of obs     =      1,031
## Group variable: id                              Number of groups  =        140
## 
## R-sq:                                           Obs per group:
##      within  = 0.5707                                         min =          7
##      between = 0.8466                                         avg =        7.4
##      overall = 0.8341                                         max =          9
## 
##                                                 F(2,889)          =     590.79
## corr(u_i, Xb)  = 0.4345                         Prob &gt; F          =     0.0000
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            w |  -.3666355   .0522948    -7.01   0.000    -.4692711   -.2639999
##            k |   .6407201   .0201368    31.82   0.000     .6011988    .6802413
##        _cons |   2.492481    .163067    15.29   0.000      2.17244    2.812523
## -------------+----------------------------------------------------------------
##      sigma_u |  .58858668
##      sigma_e |  .13719403
##          rho |  .94846853   (fraction of variance due to u_i)
## ------------------------------------------------------------------------------
## F test that all u_i=0: F(139, 889) = 110.65                  Prob &gt; F = 0.0000</code></pre>
<p>　　复制静态 (未加权) 固定效应估计：</p>
<pre class="stata"><code>sysdir set PLUS &quot;D:\soft\stata\ado\plus&quot;
use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
xtset id year     //声明面板数据
xtdpdgmm n w k, iv(w k) m(md) nores
xtreg n w k, fe</code></pre>
<pre><code>## 
## 
## . sysdir set PLUS &quot;D:\soft\stata\ado\pl. use E:\Mirror\StataLearn\StataData\abdata.dta     //调用网络数据
## 
## . xtset id year     //声明面板数据
##        panel variable:  id (unbalanced)
##         time variable:  year, 1976 to 1984
##                 delta:  1 unit
## 
## . xtdpdgmm n w k, iv(w k) m(md) nores
## note: standard errors may not be valid
## 
## Generalized method of moments estimation
## 
## Fitting full model:
## Step 1         f(b) =  4.270e-25
## 
## Group variable: id                           Number of obs         =      1031
## Time variable: year                          Number of groups      =       140
## 
## Moment conditions:     linear =       3      Obs per group:    min =         7
##                     nonlinear =       0                        avg =  7.364286
##                         total =       3                        max =         9
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            w |   -.367774   .0522015    -7.05   0.000     -.470087   -.2654611
##            k |   .6403675    .020095    31.87   0.000     .6009819     .679753
##        _cons |   2.494684   .1627475    15.33   0.000     2.175704    2.813663
## ------------------------------------------------------------------------------
## Instruments corresponding to the linear moment conditions:
##  1, model(mdev):
##    w k
##  2, model(level):
##    _cons
## 
## . xtreg n w k, fe
## 
## Fixed-effects (within) regression               Number of obs     =      1,031
## Group variable: id                              Number of groups  =        140
## 
## R-sq:                                           Obs per group:
##      within  = 0.5704                                         min =          7
##      between = 0.8466                                         avg =        7.4
##      overall = 0.8341                                         max =          9
## 
##                                                 F(2,889)          =     590.13
## corr(u_i, Xb)  = 0.4352                         Prob &gt; F          =     0.0000
## 
## ------------------------------------------------------------------------------
##            n |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##            w |   -.367774   .0523227    -7.03   0.000    -.4704645   -.2650835
##            k |   .6403675   .0201417    31.79   0.000     .6008366    .6798984
##        _cons |   2.494684   .1631256    15.29   0.000     2.174527     2.81484
## -------------+----------------------------------------------------------------
##      sigma_u |  .58883268
##      sigma_e |   .1372825
##          rho |  .94844636   (fraction of variance due to u_i)
## ------------------------------------------------------------------------------
## F test that all u_i=0: F(139, 889) = 110.72                  Prob &gt; F = 0.0000</code></pre>
<p></font></p>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><img src="https://i.loli.net/2021/04/22/RlQO7Wt9BcTXYEJ.jpg" /><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><img src="https://i.loli.net/2021/04/22/1pmr8Vfy4JQWwM7.jpg" /><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><img src="https://i.loli.net/2021/04/22/i7b6NDvqWkzOhVx.jpg" /><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p><img src="https://i.loli.net/2021/04/22/i7b6NDvqWkzOhVx.jpg" /><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p><img src="https://gitee.com/shao818/Figure/raw/master/20210422191915.png" /><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><div class="figure">
<img src="https://gitee.com/shao818/Figure/raw/master/20210421184457.png" alt="" />
<p class="caption">Hansen</p>
</div>
<a href="#fnref6" class="footnote-back">↩︎</a></li>
<li id="fn7"><p><a href="https://mp.weixin.qq.com/s/aSbHlvAlcWiT6CnCpW1L6Q">工具变量法（四）：GMM</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p><a href="https://www.lianxh.cn/news/56e2f8913175e.html">Stata：GMM-简介及实现范例</a><a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p><a href="https://mp.weixin.qq.com/s/CxzYLg3kNzp_WGCZhWtUYg">工具变量法（一）：2SLS</a><a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p><a href="https://www.lianxh.cn/news/56e2f8913175e.html">Stata：GMM-简介及实现范例</a><a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p><a href="https://mp.weixin.qq.com/s/aSbHlvAlcWiT6CnCpW1L6Q">工具变量法（四）：GMM</a><a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><div class="figure">
<img src="https://gitee.com/shao818/Figure/raw/master/null/image-20201118160559634.png" alt="" />
<p class="caption">矩条件的强弱</p>
</div>
<a href="#fnref12" class="footnote-back">↩︎</a></li>
<li id="fn13"><p><a href="https://www.jianshu.com/p/3767ee0ed284">动态面板简介</a><a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p><a href="https://www.lianxh.cn/news/cc6c5ea80d70c.html">Stata实操陷阱：动态面板数据模型</a><a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p><a href="https://www.lianxh.cn/blogs/38.html">IV-GMM</a><a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p><a href="https://www.lianxh.cn/news/b6713ec0cfa7a.html">xtdpdgmm</a><a href="#fnref16" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
